<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ketu Kakahala - Rental Management</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: #f5f5f5;
        }

        :root {
            --primary-teal: #1a7a8a;
            --primary-orange: #ff8c42;
            --dark-teal: #145663;
            --light-teal: #e8f4f6;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: var(--dark-teal);
            color: white;
            padding: 0;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .logo-section {
            padding: 30px 20px;
            text-align: center;
            background: var(--primary-teal);
            border-bottom: 3px solid var(--primary-orange);
        }

        .logo-section h1 {
            font-size: 24px;
            margin-top: 10px;
            color: white;
        }

        .logo-section p {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--primary-orange);
        }

        .nav-item.active {
            background: var(--primary-teal);
            border-left-color: var(--primary-orange);
        }

        .nav-item-icon {
            font-size: 20px;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            background: white;
            padding: 25px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .header h2 {
            color: var(--text-dark);
            font-size: 28px;
        }

        .header p {
            color: var(--text-light);
            margin-top: 5px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card-title {
            font-size: 20px;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-teal);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-teal);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark-teal);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 122, 138, 0.3);
        }

        .btn-secondary {
            background: var(--primary-orange);
            color: white;
        }

        .btn-secondary:hover {
            background: #e67a2e;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-weight: 500;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-teal);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th {
            background: var(--light-teal);
            color: var(--dark-teal);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            color: var(--text-dark);
        }

        .table tbody tr:hover {
            background: #f9f9f9;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-available {
            background: #d4edda;
            color: #155724;
        }

        .badge-rented {
            background: #fff3cd;
            color: #856404;
        }

        .badge-maintenance {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-active {
            background: #d4edda;
            color: #155724;
        }

        .badge-completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-teal);
        }

        .modal-header h3 {
            color: var(--text-dark);
            font-size: 22px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-light);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--text-dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary-teal);
        }

        .stat-card.orange {
            border-left-color: var(--primary-orange);
        }

        .stat-card h3 {
            color: var(--text-light);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: var(--text-dark);
            font-size: 32px;
            font-weight: 700;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .search-box {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            font-size: 14px;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .file-upload {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary-teal);
            background: var(--light-teal);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-day:hover {
            background: var(--light-teal);
            border-color: var(--primary-teal);
        }

        .calendar-day.has-booking {
            background: var(--light-teal);
            border-color: var(--primary-teal);
        }

        select.form-control {
            cursor: pointer;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .vehicle-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .logo-section h1,
            .logo-section p {
                display: none;
            }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 16px 20px;
            min-width: 300px;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid;
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast.info {
            border-left-color: var(--primary-teal);
        }

        .toast-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-dark);
        }

        .toast-message {
            font-size: 14px;
            color: var(--text-light);
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-light);
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .toast-close:hover {
            background: rgba(0,0,0,0.05);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Form Validation Styles */
        .form-control.error {
            border-color: var(--danger);
        }

        .form-error {
            color: var(--danger);
            font-size: 12px;
            margin-top: 4px;
            display: block;
        }

        .form-info {
            color: var(--text-light);
            font-size: 13px;
            margin-top: 4px;
            display: block;
        }

        .form-success {
            color: var(--success);
            font-size: 13px;
            margin-top: 4px;
            display: block;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial, sans-serif; background: #f5f5f5;">
            <div style="text-align: center; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h2 style="color: #1a7a8a; margin-bottom: 15px;">üöó Ketu Kakahala Rental System</h2>
                <p style="color: #666; margin-bottom: 20px;">Loading application...</p>
                <div style="width: 200px; height: 4px; background: #e0e0e0; border-radius: 2px; overflow: hidden; margin: 0 auto;">
                    <div style="width: 30%; height: 100%; background: #1a7a8a; animation: loading 1.5s infinite;"></div>
                </div>
            </div>
        </div>
    </div>
    <style>
        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(400%); }
        }
    </style>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Ketu Kakahala Logo (base64 encoded)
        const KETU_LOGO = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/4QLoRXhpZgAATU0AKgAAAAgABAE7AAIAAAAKAAABSodpAAQAAAABAAABVJydAAEAAAAUAAACzOocAAcAAAEMAAAAPgAAAAAc6gAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUzJCIEdyb3VwAAAFkAMAAgAAABQAAAKikAQAAgAAABQAAAK2kpEAAgAAAAM2NAAAkpIAAgAAAAM2NAAA6hwABwAAAQwAAAGWAAAAABzqAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAyMDI1OjAyOjI3IDE4OjI3OjA0ADIwMjU6MDI6MjcgMTg6Mjc6MDQAAABTADIAQgAgAEcAcgBvAHUAcAAAAP/iDFhJQ0NfUFJPRklMRQABAQAADEhMaW5vAhAAAG1udHJSR0IgWFlaIAfOAAIACQAGADEAAGFjc3BNU0ZUAAAAAElFQyBzUkdCAAAAAAAAAAAAAAAAAAD21gABAAAAANMtSFAgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEWNwcnQAAAFQAAAAM2Rlc2MAAAGEAAAAbHd0cHQAAAHwAAAAFGJrcHQAAAIEAAAAFHJYWVoAAAIYAAAAFGdYWVoAAAIsAAAAFGJYWVoAAAJAAAAAFGRtbmQAAAJUAAAAcGRtZGQAAALEAAAAiHZ1ZWQAAANMAAAAhnZpZXcAAAPUAAAAJGx1bWkAAAP4AAAAFG1lYXMAAAQMAAAAJHRlY2gAAAQwAAAADHJUUkMAAAQ8AAAIDGdUUkMAAAQ8AAAIDGJUUkMAAAQ8AAAIDHRleHQAAAAAQ29weXJpZ2h0IChjKSAxOTk4IEhld2xldHQtUGFja2FyZCBDb21wYW55AABkZXNjAAAAAAAAABJzUkdCIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAEnNSR0IgSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYWVogAAAAAAAA81EAAQAAAAEWzFhZWiAAAAAAAAAAAAAAAAAAAAAAWFlaIAAAAAAAAG+iAAA49QAAA5BYWVogAAAAAAAAYpkAALeFAAAY2lhZWiAAAAAAAAAkoAAAD4QAALbPZGVzYwAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGRlc2MAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAAAAAAAAAAAAAAAABkZXNjAAAAAAAAACxSZWZlcmVuY2UgVmlld2luZyBDb25kaXRpb24gaW4gSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAsUmVmZXJlbmNlIFZpZXdpbmcgQ29uZGl0aW9uIGluIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdmlldwAAAAAAE6T+ABRfLgAQzxQAA+3MAAQTCwADXJ4AAAABWFlaIAAAAAAATAlWAFAAAABXH+dtZWFzAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAACjwAAAAJzaWcgAAAAAENSVCBjdXJ2AAAAAAAABAAAAAAFAAoADwAUABkAHgAjACgALQAyADcAOwBAAEUASgBPAFQAWQBeAGMAaABtAHIAdwB8AIEAhgCLAJAAlQCaAJ8ApACpAK4AsgC3ALwAwQDGAMsA0ADVANsA4ADlAOsA8AD2APsBAQEHAQ0BEwEZAR8BJQErATIBOAE+AUUBTAFSAVkBYAFnAW4BdQF8AYMBiwGSAZoBoQGpAbEBuQHBAckB0QHZAeEB6QHyAfoCAwIMAhQCHQImAi8COAJBAksCVAJdAmcCcQJ6AoQCjgKYAqICrAK2AsECywLVAuAC6wL1AwADCwMWAyEDLQM4A0MDTwNaA2YDcgN+A4oDlgOiA64DugPHA9MD4APsA/kEBgQTBCAELQQ7BEgEVQRjBHEEfgSMBJoEqAS2BMQE0wThBPAE/gUNBRwFKwU6BUkFWAVnBXcFhgWWBaYFtQXFBdUF5QX2BgYGFgYnBjcGSAZZBmoGewaMBp0GrwbABtEG4wb1BwcHGQcrBz0HTwdhB3QHhgeZB6wHvwfSB+UH+AgLCB8IMghGCFoIbgiCCJYIqgi+CNII5wj7CRAJJQk6CU8JZAl5CY8JpAm6Cc8J5Qn7ChEKJwo9ClQKagqBCpgKrgrFCtwK8wsLCyILOQtRC2kLgAuYC7ALyAvhC/kMEgwqDEMMXAx1DI4MpwzADNkM8w0NDSYNQA1aDXQNjg2pDcMN3g34DhMOLg5JDmQOfw6bDrYO0g7uDwkPJQ9BD14Peg+WD7MPzw/sEAkQJhBDEGEQfhCbELkQ1xD1ERMRMRFPEW0RjBGqEckR6BIHEiYSRRJkEoQSoxLDEuMTAxMjE0MTYxODE6QTxRPlFAYUJxRJFGoUixStFM4U8BUSFTQVVhV4FZsVvRXgFgMWJhZJFmwWjxayFtYW+hcdF0EXZReJF64X0hf3GBsYQBhlGIoYrxjVGPoZIBlFGWsZkRm3Gd0aBBoqGlEadxqeGsUa7BsUGzsbYxuKG7Ib2hwCHCocUhx7HKMczBz1HR4dRx1wHZkdwx3sHhYeQB5qHpQevh7pHxMfPh9pH5Qfvx/qIBUgQSBsIJggxCDwIRwhSCF1IaEhziH7IiciVSKCIq8i3SMKIzgjZiOUI8Ij8CQfJE0kfCSrJNolCSU4JWgllyXHJfcmJyZXJocmtyboJxgnSSd6J6sn3CgNKD8ocSiiKNQpBik4KWspnSnQKgIqNSpoKpsqzysCKzYraSudK9EsBSw5LG4soizXLQwtQS12Last4S4WLkwugi63Lu4vJC9aL5Evxy/+MDUwbDCkMNsxEjFKMYIxujHyMioyYzKbMtQzDTNGM38zuDPxNCs0ZTSeNNg1EzVNNYc1wjX9Njc2cjauNuk3JDdgN5w31zgUOFA4jDjIOQU5Qjl/Obw5+To2OnQ6sjrvOy07azuqO+g8JzxlPKQ84z0iPWE9oT3gPiA+YD6gPuA/IT9hP6I/4kAjQGRApkDnQSlBakGsQe5CMEJyQrVC90M6Q31DwEQDREdEikTORRJFVUWaRd5GIkZnRqtG8Ec1R3tHwEgFSEtIkUjXSR1JY0mpSfBKN0p9SsRLDEtTS5pL4kwqTHJMuk0CTUpNk03cTiVObk63TwBPSU+TT91QJ1BxULtRBlFQUZtR5lIxUnxSx1MTU19TqlP2VEJUj1TbVShVdVXCVg9WXFapVvdXRFeSV+BYL1h9WMtZGllpWbhaB1pWWqZa9VtFW5Vb5Vw1XIZc1l0nXXhdyV4aXmxevV8PX2Ffs2AFYFdgqmD8YU9homH1YklinGLwY0Njl2PrZEBklGTpZT1lkmXnZj1mkmboZz1nk2fpaD9olmjsaUNpmmnxakhqn2r3a09rp2v/bFdsr20IbWBtuW4SbmtuxG8eb3hv0XArcIZw4HE6cZVx8HJLcqZzAXNdc7h0FHRwdMx1KHWFdeF2Pnabdvh3VnezeBF4bnjMeSp5iXnnekZ6pXsEe2N7wnwhfIF84X1BfaF+AX5ifsJ/I3+Ef+WAR4CogQqBa4HNgjCCkoL0g1eDuoQdhICE44VHhauGDoZyhteHO4efiASIaYjOiTOJmYn+imSKyoswi5aL/IxjjMqNMY2Yjf+OZo7OjzaPnpAGkG6Q1pE/kaiSEZJ6kuOTTZO2lCCUipT0lV+VyZY0lp+XCpd1l+CYTJi4mSSZkJn8mmia1ZtCm6+cHJyJnPedZJ3SnkCerp8dn4uf+qBpoNihR6G2oiailqMGo3aj5qRWpMelOKWpphqmi6b9p26n4KhSqMSpN6mpqhyqj6sCq3Wr6axcrNCtRK24ri2uoa8Wr4uwALB1sOqxYLHWskuywrM4s660JbSctRO1irYBtnm28Ldot+C4WbjRuUq5wro7urW7LrunvCG8m70VvY++Cr6Evv+/er/1wHDA7MFnwePCX8Lbw1jD1MRRxM7FS8XIxkbGw8dBx7/IPci8yTrJuco4yrfLNsu2zDXMtc01zbXONs62zzfPuNA50LrRPNG+0j/SwdNE08bUSdTL1U7V0dZV1tjXXNfg2GTY6Nls2fHadtr724DcBdyK3RDdlt4c3qLfKd+v4DbgveFE4cziU+Lb42Pj6+Rz5PzlhOYN5pbnH+ep6DLovOlG6dDqW+rl63Dr++yG7RHtnO4o7rTvQO/M8Fjw5fFy8f/yjPMZ86f0NPTC9VD13vZt9vv3ivgZ+Kj5OPnH+lf65/t3/Af8mP0p/br+S/7c/23////hA7hodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvADw/eHBhY2tldCBiZWdpbj0n77u/JyBpZD0nVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkJz8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIj48cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPjxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSJ1dWlkOmZhZjViZGQ1LWJhM2QtMTFkYS1hZDMxLWQzM2Q3NTE4MmYxYiIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj48ZGM6Y3JlYXRvcj48cmRmOlNlcSB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPjxyZGY6bGk+UzJCIEdyb3VwPC9yZGY6bGk+PC9yZGY6U2VxPg0KCQkJPC9kYzpjcmVhdG9yPjwvcmRmOkRlc2NyaXB0aW9uPjxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSJ1dWlkOmZhZjViZGQ1LWJhM2QtMTFkYS1hZDMxLWQzM2Q3NTE4MmYxYiIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPjxleGlmOkRhdGVUaW1lT3JpZ2luYWw+MjAyNS0wMi0yN1QxODoyNzowNC42NDI8L2V4aWY6RGF0ZVRpbWVPcmlnaW5hbD48L3JkZjpEZXNjcmlwdGlvbj48L3JkZjpSREY+PC94OnhtcG1ldGE+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0ndyc/Pv/bAEMAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/bAEMBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAQ4CbgMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AP78KKKKACiiigAooooAKKKKACiivzq/av8A+Co37Jf7JY1DRPE3jZfH/wAS7ISxD4X/AA0ez8ReI7W9TKi38S6gt1D4f8IeVIYzdW2u6pb62ttJ9psNE1HaIm68FgMbmNeOGwGFr4uvLanQpyqSSvbmm0lCnBN6zqTpwXWXR+Ln3EeS8L5fVzXiPOMuyXLqV1LFZjiqWGpymouSpUYzk62JrySfJh8LQxWIn9mjb3l+iteL/GT9ov4Ffs96N/bvxq+K3gn4cWMkTzWkPiTW7W21fVUj3b10Lw9E0+v6/Mu1ybbRdMv7jCOfKwjEfyB/tLf8Fvf2vfjVdalpXwx1Kx/Z38CXBkgttN8Csmo+OZ7RixQ6p8RNSs01K3vlyCLrwfp/hAoqrGyy4kkl/IXxF4k8ReLtZvvEXizX9a8T+INUmNxqWu+ItVvta1nUZyADPfanqU9ze3cxAAMlxPI5AALV+mZT4WY2soVc4x1PBQdnLC4RRxOJtvyzrS5cLTl0fIsQ09m2j+S+M/picP4CVfCcDcP4rPq8XOEM2zqc8pypyV0qtHAUfa5viqd1zR9vPLYzja8YKVl/YJ8Xv+C/37Jng0XVp8KfBvxN+M2pRb/st6unW3w88I3W3IXOq+JjP4qt95wRv8CPtQ5bDjyz+YPxQ+K/i34y/EnxX8U/HGp/2l418ceIdT8S+ILvYkEL6nq13JdTW1nApxZ6ZpcT2ukaZbrhdP0yws7MBII8/Gdfbf8AwTx/4KT/ALVP7C3iY6DofiK61v4a6teC41v4P+Ob+XxF8PtWSQhbj+yEl36p4N1l0VYh4g8NzabJNIZINUF3Y+Raye7n3hxluex+v5XWjk+aWUp1adOLwWNknpzYOc7UqklyxdfCTpOUlze25o0z+ZuAfo48V8B4r+zFxLLGZ/wlUko08LiMZL+1eH5Sm51f7Mx2GUKWFdN+9LK8yoYim4w9pFYjGxjX/wA1eur+G/7S/wC0r8CrtNY+EPxj+Jfws1BI1SGbwr451HRYrkphg1/4elube51gkknzr1rhsjBwa8Bor+gsrzDL8zwmHx+W4zBZjg8RCNWhicHiaGKw9emr8tenWoVKkKkb/HF2n/EtT/HPMuH81yHNM2yTN8mzPK82y2vUw2Ox+W4zEYDGYXERSccRhMThKdOrRq8qlCXNGUIVEpU6kavLT/fH/g3+/aa/4a/+Akvwe8c61/bfxK/Zu1uH4fa5I0t5cz678NIri18YeD9Unlm825vPCep2cfhnwlcTvj/hCdC0+OKKzs7KCB/6YBX8hv8AwT7/AOCpvwx/Yt+P0vxL8ffE3UP2ffip4tF7c+JdWi1PT5vBvxAurCTzf7S1T4b+Jv7S0/w1HrDoBFpekeHPEXhPUJPNih0S/1LyLYj/AEAv2X/+Ci37Lv8AwUB+D8Xxj+A3ilrqCCWLTfHnwy15LPQvij8P9ReKS4bTPE3h+fUJYbmxvhBJLovifRr7UvC3iG3iefw74i1S3WeIV+e+IXBGYcO04cTcLJzweIqexzLLZyUsszGatySqb+RZdhskrWdVYZYUuSnTxOGh/wAg/SQ+jDxj4H0MXx/4Xx+v8N5fhYx41y+nUdTN+G0p1cNSzbHwXL9bylZtTqYLG16VGGPwksjz58kauZfWqOIh/oqUV/Bl/wAEkf8Agsf48/YX1Cy+APxh1TxV8UP2fYbt4fBPiK+R/GHi/wCFscqpbRWviLUrSHTfEPiTwwAEjHirTrfTl0+BWTxTofiaKJ2i/ujr+OMy4bzvh/GM4xj/AGllmLfsMbh4pwqxv8CqRu6eJw81+/w9ZqFaF/dkqlKUYkUquIw2x/of9CzxT4bxdFeFHiPjocM8V0owxmSY6d1w/wAV0FeFWdKNSFPK+II0YRWZZLUk4YpOWOyqaoY9wxU8PiIFFFFfnp/Ux/Ob/wAHF/xa/tP4vfAX4K21z5th4B8G+N/iTJC0hK23jnxncW3gnTrhQcpLN4e8Dx6lcRsD5sM+l+UdrOh/DWva/wBuf9qXxp+3f+1h8Qfj74rs7PTPEHjqa1sdL8N6fez6hodh4Y8PWg0XwX4b/tF7bT7rU00DTJ/J1DUrex06+1i5uL3VHs9MsbiLTxj+grxM+CkPwi+FPw1+DltdW2oSeAfBvh/wrcXttIZbO9v9IsmOvanYuwDSWGr6zLc+I9RgbH2rS9U1C0Y/6Riv6RpY+jSy+ng2pPEQgsVUrxsqaqVY3vZ3fMqULct1FM/838cMnx+fcTZ9ms4RwtXGZhWxFGg5TnOFKq1TowlKVoxdTk5pWu+SSXvRjL/RL/gh5+0S/wC3j/wTL/ZZ+LmrXS6l4507wBpvgDx5cBl83W/HXw9X/hGvFl1cMCWef+0LJdC8RStgPPr+qTgqE+SPIv5O/wDg3K/ao/4ZA/4KZfCaLVLz+yvB3x9ufEXwB8bC4kyNG/tdmuPA+s38eQBF4f8AihYfDLVWLEoqaNO8mxQ1fDftzft3fGf9vv8Aah+InxW+Jmu+bH4h1aJPCfgKyluJNI8G/DnwwtxH4b8G+HdPh8uOzi+xKzaprU8avqnitNS1OV/s09zFHH5R4e8YeIvh94x8P/EDwd4i1rwt4x8Lat/aOheJPD1/JpusaRqX2a4s/PsryA+ZFIba6urWSQDdBd29xbTr5lvMrfieF4XznMMyxHDuVYGpjsywcZVsTQoTwmEnTpe2hQlVqYrG4ajGxeIwtFz9tUnCUP31ZezH/QPiV4q+GHh1wVlXiZxVnnDeQ5Bn2a0Mvw+YY+pmmKrV8TDKsVm9bA4WjDK8HjMXWu6eXY7EVY4fBUaFXD4erWxeKji8Lg6/9h3xG/4K1fsgfBrxRqnhX4x/EjU/ht4p0eyj1O50P4keG9e8C3ejafc7lGu+GdT8QaNoCapo72s0X9p6TrOqWv2axun1jSb22W1v50X5O/bU/wDgqF+xT+yLDqujat4kl+Nnxn0+Pzj8M/hZeafa634dZRIVHij4gap9o0H4cW7vHteeyOuav4mjdxbxaJBMJVhX/P6+N/7Q/wAe/wBpPxo3jr4+/FLxh8VfEjQ/Zxq/jDVrjUG0vT/Mt4Uk0nw1pkCaT4R8OQLa28P2Hw7ouk6Vb7YXubqBJ7ma5kb1b9kr9tz49/8ABPX4vP8AE34H6t4b/wCEntx0ebQvF+naRqmkDxH4Y8WaNqEniPwL480vVo9R8OeIfDGpS+Xqulf2Vqumag1jb6t4et9Rt4/7akLufl/Esh4lzHP5VcThcFeq1G9aXLShRjdN0lL+LJOSvGTc3b3ddD+lvDXM+AOCuF8oyrIcxzfiPF4OjP2ka2EwNGFLFV6kLQnSxdfkoYinTUJVG4U6cEpzUnKyf90f7Mn7Zn7Pv7bmjS+I/gd49tvFGpWkTT6r4P1qGDRfHfgi5UExRa54SvFmv9OW6aIPbahapdafcskj2k1wkTtF9GV+J37Cv/BJvwl+xt8SPCvxx0r43fE3xn8SvC+qrqvh251PXPD+t+EfBXjWISR/8JV4J8IeVp2m+FtW+w3jHTNZ0y58Vax5du7z+I9TaaMyf0RV+b8R5LhMqxKpUWpYeuleE07VIStp7y2krWUlrGVmm1qf3ZwZxvnXFuV08diqMcPisLUVXB4zDyjUo16Tb54KV4yw+IptOFai7SjezjOEpwkgooor5k/fgooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAPjv8Aav8A2uP2f/2J/AN/49+Pnj/TfCOnBZYdB0O0aHVvGnjvUoQDH4e8D+EbWS31bxBq0zKyyCyi+x6LbP8A2n4gvtL0+OW4r/NI/wCCl//AAFH+1V8Xr3xd8OPhd47+Gf7HPhS/kkttE8N2+meEPiP+0P4ktLiSSO98Y/F/Rrf7FofhTV9Y/dt4I+HXh+5jmltjB4j+J2sWSyeEr39WP+CwH/BR/SvEOoap+wr+zr4z1S6svDl9NDc/FWw1hbfXD4mvI1hu4PheviS5itdX+FfhTU1kXzEhu7P4hcXImuPB2rWbvqf8zmsaprGua1q/iDxDq+qa9r+v315rGsa7rmoXmp6vrGr30732oanrGp3s0t5f6lqN7NOz19/Rb4Vy6hj8PxBisbWyqrh8FSoVMDisPHH06WMq4rEzoS/s+NGk5YnCuNKUq1ZQdGcKc/2h0cOrfi37VX7YH7P/AOxV8A/Gv7S/x+8WeHtI8J/Dfw9qPirxvrupX1jbyazeeH7CZr+20aysriK88R+Mb7VLy00nwX4T0+5l1Hxr4svLLQ7K0uPtk97p8f8AES/8F5v+Ci2/zP8AgrP+3kq7sbb9p/4xD5c4x/xN84x6cda+3P8Agk/4r+G/jL/g3d/4KR/tBeHviB4O1zQ/h/8ADTxF8E/EWpa94g8KXWn+GviR408Wa7q/wW8S+CdH1uPT9c8X+HH+Ef8AxTHi2aTTptO1a/8AD3jLVPBqN/wnEyWH8q/i/wAK+JvA+v6r4a8WeHdY8O+IdDvJtP1jQ9e0y80/VNLv7d2iure+sL2GG5tLqJ1aSKeB0ljkVZFYhga+44DzrLVl8cuxklhq9fCOUE7OinWcJpJWfwqOvNZJOF7Ox/J3j/wdxW+Osi4m4fw08xxmTZ6sPiI3jCvQjkHs8ROnUnJqMITrzSULuU6lGcUlyyeh/r2f8EZv2o2/aS/4JgfBbXNQvRfa5+zudS+A3iOaS4NxdHU/hpdR+HvD93cXDu0ktxqvgWbwXpF7K2ZtU0+3vpW3yyyvL/NB/wAHCP7Vfin49f8ABRHx98JNQkuJvAP7MWg+D/hf4M0yK4edLDxTqPhqz8T/ABJ1uGMHyo59Xv8Aw1oLXKqHY6Z4Qtl+RZXdv6PP+Dfj49fBjxH/AME8/wBnnwF4V+KPwt8aeJP2Yvgv4R0zxz4B8PfEr4d+KvGGg+IPBfhXw/pdh4g0m98P3+rNeafqUmgWVxZSf2f5iQXEdzEssaSqq/5onxO+I3j/AOLnjjxt8SfiFr134h8ZfErxzqPjnx5rN7BDb3Go+JvFWrT6rrsyWtqkdvYaWmo3VxJp2k2USW+n6dE1pY28dvaQwRR/XcL5fUznNI4vFUvZ4PCUaletJq7qTcmpU4Wtf3Y6u/wuatpf+RvjpxzT4J4ExuS5XiVVz7ijGYPKoKPMoYbAYR0sVmmIdRqKbdB8uGptRkpKvJ3koqk/86yiiiv179m/0AKKKKACiiigAr+rv/g3Y/azf9sr/gnx4L8C+IdRTVPiF+yd/Y/7Pfiq5nk85L/S/BunRWfg3WGnb53vtZ+FOoeD7ppEzJqR01wTszj+Uev1X/4NxPj54o+EP7fusfBazvbnTdB+NHwi8afD/wAV2vmvFHfeKNG1bw143+HEcs48uS5m0fUPhbrEBg/eOum+I2kATYoJ8fxBwGKzTh7+z8NgaeZY3AZngc2nQrVJUYQwNepUdZuamqUqcHQnVklzU4JNO73/AE/6OPFWT8I+IfDfEHE+dzybJMw4dzfhqWYYShQxWMnmcKGDi8JGnSqRxlXEVaVbCYWjVdGriozbp0ZR53dL/Tcr+Fz/AIO2fjx/w0f/AMFFvCPwXsdQXUvCf7M3ww8H+CNVs7YyLaTXXxX1PxFrnjGD/ynKTz6B/wAG2v7VUvwG/wCCi914V17U5dN+Hn7VfhDw58BNStrq8n03Szri+JNR8YfDO+1/+05WttJ0FfF2leNf7B1LUL9NL0vxFp/iL+0WtrPWNGguGv8Ahi8Qa14h8Uaxrfibxdr/AIg8R+INauL3VNZ8Q6/rGqa94g1nU7qVZpb7VtY1e81LVNUvrpy8ss91d3M87u0kjs7V/PfDmVZvQrQxEnCFOD9nCSalG/L8XNZ3u9V6pfqeOcR5Jisuq5LGFStPFUKzrxlGNKVClPD2p2g5e0hzNwtLW3Vq1j/Qe/4IP/t4n9qf9mC4+BvxD1i31P8AaF/ZTn8O+B9Wmvb+a31TX/hPd31lc+AvElrcz3c01wnhnT7i+8A+Ig6JPD4f0zwpqt3G/wDwjt8wj/YGv8gP4XfEHxt8GfG3h744/Dnxdrvw/wDiN4Fvo9X8MeMvD13JaanpN/EyyxZdGSS0vra5SK4t7yzmkt7uB1SZUw6v/oL/APBL7/grR8K/+ClXwwj03V5LH4Q/tM+Fbe1s/ip8JYHhhtbwqsTxeKvBJuprm+8W/DbUZh5uneJEie70uRrHxNo0VhqEDxQX/wBR4uZRkWMydVssj7Gsq8HTjUSqRn7Jxl7sW4cvMpbS1T0Vz+DfCHOMFw7h8dBT9rCpgKk8NLkVP97RlL+HUWM76WUrOydrKx/VRX8s//BTf/gqVrf7bniS6+GHgO/vsNP+C3gvXfAfjrU4pfDD+I/h58YU+IfjHV9S/sq5S2h1vxR4Q8VfBLwh8OvCljqRnvLHQ/iHcXEcen/2fD5v7M/7Qvj79n74pa38UPAVr4U1DXp7WPTp9I8Xada+J/DF/o0VxBqP9n6vpuqjULFbu2lv0udJ1RYo9U027udP1SK2uIJ3iP43/ET/AIOq/gjoXxk1fQPAHwZ+LvxJ+BvhfVXsdA1vXINN0TxT4r03fMulzeJ7aK/k0nwhrF1Z+ReX9j4au/Ecc2lTWWia1pfheKa90M2HjWV8K5jknDuMxuIyutSy3Fx5cJSxlOpWjKP7ynNS+rQpqpFpVYxlGVozabvqv9B+jTx5nXiVwTisgx+H/iZXOGBpYipi8RioUqtSjCmnWr4fCVp0k/3dTnpzklF1XFe4r/1lvGv7SPwC+FqXJ8X/ABH8N6TNZxtLdaNp19D4m8RrGEYCe08L+EH1TWb63lICQXENhJazs2xJCxFfgjrX/Bwp+yBq0ktz4c+FX7QGt2kjE2WsCy+F0OnXKk7ozqWm+J/FOuTQROMLeyeCjKoYFk3oXX5L+O37Qvx0/aY1k678c/il4++Knjdo2jTUPGniS8vNO0mJl2i38P8AhGGSDw34etYwA1rbaT4ftbS1+WW3twZC7fLlfoXDvBmX5HVhi6+IpcQY2Gqq14W+r0p7e1o4eThKa1tCtOsktJJ6v/MP6Q/iTn3E2Ap8M5YqH9k5TisNm2KlUp+0jm+KpRqRlhY+1jGX1anOpzOqlBN88LcqT/0UP2b/APgqp+xT+2jBa2/wM+M3hfxD4w1N4oV+HniD+0Ph58WNRW8ZI7WT/hW/j3+xfEltcefcpDAb/Tf7H1k3EkcGh6veSNHH+kHjbxR4e8D+EfFHjvxLcfYPDvhHS77XNeu/IunWy0rTYGu7+7+y2cFxeSrBap5TQWtpLcz/AOqRXkr27K/+P3rHinxf4p1S61rxL4h1nxFrOoGJ9R1jXdU1PWdY1GW1ghtLS41HU9TubzUbyW2s4La1tbea4kFvaQpDEFjQAfeX7CHw/wDD/wATP29/2YPAviTUYdK0PxH8StG/tK8uJlt4jJ4RNh408NeJo5rhliV/D/xG8J+CfHmkM5PlS+EdOuFC+alfrGc8WZJkmT1sDg68cZjcRUSo4ihjHjlhUtJNShGn7Gq4uF50XVpS5uWU7x1X+CPAnjrxpxjxTlea51gP7KwXDeXVq88I8HlMspxWMxLgq1HBxeP+r1sRSp4hU40sVGg6tOE/a06EM3I5L/aor/Or/wCCz/8AwVp+Ifh/4y+Hf2A/g54p8Q+H9E0u4gm+PnxL0c3mjXev/EWS7ksLr4UfCjW7KVZ/CnhPQ7jWdH0L4p+OdKRdV8SyXmjeA9P1bRND0vxw2tS/kp8MP2g/2h/2d/EKeKfgl8UviL8LfEqStNFqPgrxLrXh3+0Jti+ZPq2j21xa2/iW1LxxqmjeI7W41W0+Z7a1jJJz+D8XYijleTznjo1P7Qo18Pi41vslVmpP7pU5csWm2rSdr7f6bfRuWe1vFzBYfhurg6OV1srxeY45UKjp1MYo4a2BcLJLFUMO8XUqQi5Qj9XjLmSqQs79P8ZP+Cwf/BQ346fEDxF498I/GHUPhR4V1+/l07wb8K/g9deMPhD4V8EadM0YttY8SeHvh/rGleJv+EluopGF3qPiTVo9Yku2c3Esa+Wq/kpqmu694i1LUte8R63ruv61qk0l7qus69rGq6vrep3k7c3FxrObf/GOiivw6hh6FONOyb5Xf7Tf9WP+m+acUZ5j6lZ1a+OrQi6uBwkoUaXspctrUYSnGKl7z5pXbvufFNFFFbHhBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB/n+/8AByr/AMq3P2wf+xZ8C/8AqceCq/l/r+oD/g5V/wCVbn7YP/Ys+Bf/AFOPBVfy/wBf1H4a/wDItPpLN/loj/jI8c/+Shj/ANg3D/66Zn//0Pv+iiiv0Q/AgooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAPkv8Aap/Zs+Df7Yfwm1r4E/Hzwva+LvCWr7bjT9SGr3Wk6zoPiHSp1k0rxN4J8TaUE1Lwnqttcmb+ztRsY5/D+tLBBq+hXWrafb3tspj/AIjf2q/2cfH37Gv7RPxO/Zu+IRk/sbx14Iv7Tw34gms5rbQvHXgnWxJrPw+8faObi5ur3SdK8UeE/sepa7ottdXS6Z4gtoL2KW70zVUt7x/+uJv2e/2avG+teMte8ffs8/BT4g+J/iJqFnrfxC8V+L/hX4E8ba38R/EWn6VoXhdpdV8RayyfaTNY+FPBPQ0UVuuIs1x0ZUKeJqKE5OUqca1WnCco8vLUjRlOEJx5eeKnGMlFzjzaOx8Dwvw1knDf10Zbi4TxNenCjVrTw2FxGKhSVRznRjiZ0adSEKjUISdOUlFUpyjeUU0fwt/8Fnv+CZvin/gnv+0jcfFD4bw3Gi/s2/Gq+fxT8KNVimI0zwB4suZGu/FXwY1R13wNf+E9SliuPCmoao1vd6/pXh+61rU2d9U8T6nCP5gq/wBN/wDbk/Y/+Ef7dv7OnjL4LfEzQbfUoNTs7rUvBfjBIra38TfC7xfdW8lj4f8AHHhq7ml/svXoI5YU0u/voJLXXrBbCXTJnvLKMQ3n/N/+0b8DPiT+zD+0r8Y/2cviBaXS+L/gn8TfFHw6u9VntDbDxRp+g6nJa6XrgjiWz0nS9W0OW20HXoLG3e00+61LT5Y7YmFmiM3o8KZ29Fw9t+/iudKK5lVSdt3d+9fb3vdfT+OfpA+D1KKw/i5wpSpf2pUp0aMcy+r0ss4ljVclGngMViIezyzO5RipqvRp0smxknT9rLKq+IxGEl/Or4a8V+JPBmvab4q8Ha7rPhnxNo15Fqmja/oOpX2k6vpOp27borqxv9Puree2mAZlEm0SQy7JoJY5EVWH91H/AASJ/wCCz0niqS2/Z0/bQ8Xz+GfEU720Pwx+NWqahFp3hjVXlZItO8KfFu9nD2Ol3d1aLY6P4M+IkdnY28HkWXhPxfa2kVxoWmWv5e/tNfsd/tAfs1az/a3jfw4vifwprNuZdG+J/gu7u9Z+HfipI2eWK1Gqaaxm8P6veQxGT/hHvFtoNF8TwRs1pJYztIs3jb8QPqzg3gKni/Z5zXnR9g0pUpwhOVVr4pN05uMIau0VOopcyblHRu/+GXjT9JqOCjitB4qMKb5sPRniqVPDqpo+aWGowlU5Wta0HKUZ3cYwpSnKfE8P+tFFFftx/n8FFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9k=';

        // Storage utility
        const storage = {
            save: (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (error) {
                    console.error('LocalStorage save error:', error);
                    if (error.name === 'QuotaExceededError' || error.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
                        alert('Storage quota exceeded! Please reduce the number of photos in inspections or clear old data.');
                        throw error;
                    }
                }
            },
            load: (key) => {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('LocalStorage load error:', error);
                    return null;
                }
            },
            remove: (key) => {
                try {
                    localStorage.removeItem(key);
                } catch (error) {
                    console.error('LocalStorage remove error:', error);
                }
            }
        };

        // Vehicle Classes
        const VEHICLE_CLASSES = [
            'Economic Manual',
            'Economic Automatic',
            'Premium',
            'SUV',
            'Luxury',
            'Van'
        ];

        // Main App Component
        function App() {
            const [activeView, setActiveView] = useState('dashboard');
            const [vehicles, setVehicles] = useState([]);
            const [bookings, setBookings] = useState([]);
            const [transfers, setTransfers] = useState([]);
            const [quotes, setQuotes] = useState([]);
            const [customers, setCustomers] = useState([]);
            const [payments, setPayments] = useState([]);
            const [maintenance, setMaintenance] = useState([]);
            const [documents, setDocuments] = useState([]);
            const [settings, setSettings] = useState({});
            const [users, setUsers] = useState([]);
            const [userRoles, setUserRoles] = useState([]);
            const [expandedMenu, setExpandedMenu] = useState(null);
            const [toasts, setToasts] = useState([]);
            const [notifications, setNotifications] = useState([]);
            const [showNotificationCenter, setShowNotificationCenter] = useState(false);
            const [inspections, setInspections] = useState([]);
            const [contracts, setContracts] = useState([]);

            // Toast notification function
            const showToast = (type, title, message) => {
                const id = Date.now();
                const newToast = { id, type, title, message };
                setToasts(prev => [...prev, newToast]);

                setTimeout(() => {
                    setToasts(prev => prev.filter(t => t.id !== id));
                }, 4000);
            };

            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };

            // Notification system
            const sendNotification = (type, recipient, subject, message, bookingId = null) => {
                const notification = {
                    id: Date.now(),
                    type, // 'email', 'sms', or 'both'
                    category: subject.includes('Confirmation') ? 'booking' :
                             subject.includes('Payment') ? 'payment' :
                             subject.includes('Reminder') ? 'reminder' :
                             subject.includes('Late') ? 'alert' : 'general',
                    recipient,
                    subject,
                    message,
                    bookingId,
                    timestamp: new Date().toISOString(),
                    status: 'sent',
                    read: false
                };

                setNotifications(prev => [notification, ...prev]);
                showToast('success', 'Notification Sent', `${type.toUpperCase()} sent to ${recipient.name || recipient.email || recipient.phone}`);

                return notification;
            };

            const markNotificationAsRead = (id) => {
                setNotifications(prev => prev.map(n =>
                    n.id === id ? { ...n, read: true } : n
                ));
            };

            // Load data on mount
            useEffect(() => {
                setVehicles(storage.load('vehicles') || []);
                setBookings(storage.load('bookings') || []);
                setTransfers(storage.load('transfers') || []);
                setQuotes(storage.load('quotes') || []);
                setCustomers(storage.load('customers') || []);
                setPayments(storage.load('payments') || []);
                setMaintenance(storage.load('maintenance') || []);
                setDocuments(storage.load('documents') || []);
                setContracts(storage.load('contracts') || []);
                setSettings(storage.load('settings') || {
                    companyName: 'Ketu Kakahala Trading Enterprises',
                    country: 'Namibia',
                    timezone: 'Africa/Windhoek (CAT +02:00)',
                    language: 'English',
                    dateFormat: '16-12-2025 11:49 (eu)',
                    currency: 'N$',
                    supportedLanguages: ['English', 'Spanish', 'Portuguese']
                });
                setUsers(storage.load('users') || [
                    {
                        id: 20278,
                        fullName: 'Antonio Ketu Kakahala Trading Enterprises',
                        username: '7.gg',
                        email: 'emmzmanuel90@gmail.com',
                        mobileNumber: '',
                        roles: ['Administrator'],
                        enabled: true,
                        lastActivity: '16-12-2025 11:53'
                    }
                ]);
                setUserRoles(storage.load('userRoles') || [
                    { id: 5, label: 'Commission Partner', handle: 'tour_operator', active: true },
                    { id: 4, label: 'Reservations', handle: 'reservations', active: true },
                    { id: 3, label: 'Manager', handle: 'manager', active: true },
                    { id: 2, label: 'User', handle: 'user', active: true },
                    { id: 1, label: 'Administrator', handle: 'admin', active: true }
                ]);
                setNotifications(storage.load('notifications') || []);
                setInspections(storage.load('inspections') || []);
            }, []);

            // Check for late returns and send alerts (runs on load and every 5 minutes)
            useEffect(() => {
                const checkLateReturns = () => {
                    const now = new Date();
                    bookings.forEach(booking => {
                        if (booking.status === 'active') {
                            const endDate = new Date(booking.endDate);
                            const hoursDiff = (now - endDate) / (1000 * 60 * 60);

                            // If more than 2 hours late and no alert sent in last 24 hours
                            if (hoursDiff > 2) {
                                const lastAlert = notifications.find(n =>
                                    n.bookingId === booking.id &&
                                    n.category === 'alert' &&
                                    new Date(n.timestamp) > new Date(now - 24 * 60 * 60 * 1000)
                                );

                                if (!lastAlert) {
                                    const hoursLate = Math.floor(hoursDiff);
                                    sendNotification(
                                        'both',
                                        { name: booking.customerName, email: booking.customerEmail, phone: booking.customerPhone },
                                        'Late Return Alert',
                                        `URGENT: Vehicle ${booking.vehicleName} (${booking.licensePlate}) is ${hoursLate} hours late for return. Expected return: ${endDate.toLocaleString()}. Please contact the customer immediately.`,
                                        booking.id
                                    );
                                }
                            }
                        }
                    });
                };

                checkLateReturns();
                const interval = setInterval(checkLateReturns, 5 * 60 * 1000); // Check every 5 minutes

                return () => clearInterval(interval);
            }, [bookings, notifications]);

            // Save data whenever it changes
            useEffect(() => { storage.save('vehicles', vehicles); }, [vehicles]);
            useEffect(() => { storage.save('bookings', bookings); }, [bookings]);
            useEffect(() => { storage.save('transfers', transfers); }, [transfers]);
            useEffect(() => { storage.save('quotes', quotes); }, [quotes]);
            useEffect(() => { storage.save('customers', customers); }, [customers]);
            useEffect(() => { storage.save('payments', payments); }, [payments]);
            useEffect(() => { storage.save('maintenance', maintenance); }, [maintenance]);
            useEffect(() => { storage.save('documents', documents); }, [documents]);
            useEffect(() => { storage.save('settings', settings); }, [settings]);
            useEffect(() => { storage.save('users', users); }, [users]);
            useEffect(() => { storage.save('userRoles', userRoles); }, [userRoles]);
            useEffect(() => { storage.save('notifications', notifications); }, [notifications]);
            useEffect(() => { storage.save('inspections', inspections); }, [inspections]);
            useEffect(() => { storage.save('contracts', contracts); }, [contracts]);

            // Check for upcoming pickups and returns (send reminders)
            useEffect(() => {
                const checkUpcomingEvents = () => {
                    const now = new Date();
                    const tomorrow = new Date(now);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    tomorrow.setHours(0, 0, 0, 0);

                    bookings.forEach(booking => {
                        if (booking.status === 'active') {
                            const startDate = new Date(booking.startDate);
                            const endDate = new Date(booking.endDate);
                            startDate.setHours(0, 0, 0, 0);
                            endDate.setHours(0, 0, 0, 0);

                            // Check if pickup is tomorrow
                            if (startDate.getTime() === tomorrow.getTime()) {
                                const reminderExists = notifications.find(n =>
                                    n.bookingId === booking.id &&
                                    n.subject.includes('Pickup Reminder') &&
                                    new Date(n.timestamp) > new Date(now - 24 * 60 * 60 * 1000)
                                );

                                if (!reminderExists) {
                                    sendNotification(
                                        'both',
                                        { name: booking.customerName, email: booking.customerEmail, phone: booking.customerPhone },
                                        'Pickup Reminder - Tomorrow',
                                        `Hello ${booking.customerName},\n\nThis is a friendly reminder that your vehicle pickup is scheduled for tomorrow.\n\nVehicle: ${booking.vehicleName}\nPickup Date: ${startDate.toLocaleDateString()}\nBooking ID: #${booking.id}\n\nPlease bring your driver's license and payment confirmation.\n\nSee you tomorrow!\n\nKetu Kakahala Vehicle Rentals`,
                                        booking.id
                                    );
                                }
                            }

                            // Check if return is tomorrow
                            if (endDate.getTime() === tomorrow.getTime()) {
                                const reminderExists = notifications.find(n =>
                                    n.bookingId === booking.id &&
                                    n.subject.includes('Return Reminder') &&
                                    new Date(n.timestamp) > new Date(now - 24 * 60 * 60 * 1000)
                                );

                                if (!reminderExists) {
                                    sendNotification(
                                        'both',
                                        { name: booking.customerName, email: booking.customerEmail, phone: booking.customerPhone },
                                        'Return Reminder - Tomorrow',
                                        `Hello ${booking.customerName},\n\nThis is a reminder that your vehicle return is due tomorrow.\n\nVehicle: ${booking.vehicleName}\nReturn Date: ${endDate.toLocaleDateString()}\nBooking ID: #${booking.id}\n\nPlease ensure the vehicle is returned with a full tank and in the same condition.\n\nThank you for choosing Ketu Kakahala!\n\nKetu Kakahala Vehicle Rentals`,
                                        booking.id
                                    );
                                }
                            }
                        }
                    });
                };

                // Check on load and every hour
                checkUpcomingEvents();
                const interval = setInterval(checkUpcomingEvents, 60 * 60 * 1000);

                return () => clearInterval(interval);
            }, [bookings, notifications]);

            const unreadCount = notifications.filter(n => !n.read).length;

            const menuItems = [
                { id: 'dashboard', icon: 'üìä', label: 'Dashboard' },
                { id: 'vehicles', icon: 'üöó', label: 'Vehicles' },
                { id: 'bookings', icon: 'üìÖ', label: 'Reservations' },
                { id: 'calendar', icon: 'üìÜ', label: 'Calendar View' },
                { id: 'transfers', icon: 'üöê', label: 'Transfers' },
                { id: 'quotes', icon: 'üìã', label: 'Quotes' },
                { id: 'customers', icon: 'üë•', label: 'Customers' },
                { id: 'customer-portal', icon: 'üåê', label: 'Customer Portal' },
                { id: 'contracts', icon: '‚úçÔ∏è', label: 'Contracts' },
                { id: 'payments', icon: 'üí∞', label: 'Payments' },
                { id: 'notifications', icon: 'üîî', label: 'Notifications', badge: unreadCount },
                { id: 'inspections', icon: 'üîç', label: 'Inspections' },
                { id: 'reports', icon: 'üìà', label: 'Reports' },
                { id: 'maintenance', icon: 'üîß', label: 'Maintenance' },
                { id: 'documents', icon: 'üìÑ', label: 'Documents' },
                {
                    id: 'settings',
                    icon: '‚öôÔ∏è',
                    label: 'Settings',
                    submenu: [
                        { id: 'settings', label: 'General Settings' },
                        { id: 'users', label: 'Users' },
                        { id: 'user-roles', label: 'User Roles' },
                        { id: 'access-control', label: 'Access Control' }
                    ]
                },
            ];

            return (
                <div className="app-container">
                    <div className="sidebar">
                        <div className="logo-section">
                            <img src={KETU_LOGO} alt="Ketu Kakahala Logo" style={{maxWidth: '180px', height: 'auto'}} />
                        </div>
                        <div className="nav-menu">
                            {menuItems.map(item => (
                                <div key={item.id}>
                                    <div 
                                        className={`nav-item ${
                                            activeView === item.id || 
                                            (item.submenu && item.submenu.some(sub => sub.id === activeView)) 
                                            ? 'active' : ''
                                        }`}
                                        onClick={() => {
                                            if (item.submenu) {
                                                // Toggle submenu expansion
                                                if (expandedMenu === item.id) {
                                                    setExpandedMenu(null);
                                                } else {
                                                    setExpandedMenu(item.id);
                                                    // If clicking Settings, open the first submenu item
                                                    if (item.id === 'settings') {
                                                        setActiveView('settings');
                                                    }
                                                }
                                            } else {
                                                setActiveView(item.id);
                                            }
                                        }}
                                    >
                                        <span className="nav-item-icon">{item.icon}</span>
                                        <span>{item.label}</span>
                                        {item.badge > 0 && (
                                            <span style={{
                                                marginLeft: 'auto',
                                                backgroundColor: '#e74c3c',
                                                color: 'white',
                                                borderRadius: '12px',
                                                padding: '2px 8px',
                                                fontSize: '11px',
                                                fontWeight: 'bold'
                                            }}>
                                                {item.badge}
                                            </span>
                                        )}
                                        {item.submenu && (
                                            <span style={{ marginLeft: item.badge > 0 ? '8px' : 'auto', fontSize: '12px' }}>
                                                {expandedMenu === item.id ? '‚ñº' : '‚ñ∂'}
                                            </span>
                                        )}
                                    </div>
                                    {item.submenu && expandedMenu === item.id && (
                                        <div style={{ backgroundColor: 'rgba(0,0,0,0.1)' }}>
                                            {item.submenu.map(subItem => (
                                                <div
                                                    key={subItem.id}
                                                    className={`nav-item ${activeView === subItem.id ? 'active' : ''}`}
                                                    style={{ paddingLeft: '50px', fontSize: '14px' }}
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        setActiveView(subItem.id);
                                                    }}
                                                >
                                                    <span>{subItem.label}</span>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="main-content">
                        {activeView === 'dashboard' && (
                            <Dashboard
                                vehicles={vehicles}
                                bookings={bookings}
                                customers={customers}
                                payments={payments}
                                transfers={transfers}
                            />
                        )}
                        {activeView === 'vehicles' && (
                            <Vehicles 
                                vehicles={vehicles}
                                setVehicles={setVehicles}
                                bookings={bookings}
                            />
                        )}
                        {activeView === 'bookings' && (
                            <Bookings
                                bookings={bookings}
                                setBookings={setBookings}
                                vehicles={vehicles}
                                customers={customers}
                                showToast={showToast}
                                sendNotification={sendNotification}
                            />
                        )}
                        {activeView === 'transfers' && (
                            <Transfers
                                transfers={transfers}
                                setTransfers={setTransfers}
                                customers={customers}
                            />
                        )}
                        {activeView === 'quotes' && (
                            <Quotes 
                                quotes={quotes}
                                setQuotes={setQuotes}
                                vehicles={vehicles}
                                customers={customers}
                                bookings={bookings}
                                setBookings={setBookings}
                            />
                        )}
                        {activeView === 'customers' && (
                            <Customers
                                customers={customers}
                                setCustomers={setCustomers}
                                bookings={bookings}
                                showToast={showToast}
                            />
                        )}
                        {activeView === 'payments' && (
                            <Payments
                                payments={payments}
                                setPayments={setPayments}
                                bookings={bookings}
                                setBookings={setBookings}
                                showToast={showToast}
                                sendNotification={sendNotification}
                            />
                        )}
                        {activeView === 'notifications' && (
                            <NotificationCenter
                                notifications={notifications}
                                markAsRead={markNotificationAsRead}
                                bookings={bookings}
                            />
                        )}
                        {activeView === 'reports' && (
                            <Reports
                                vehicles={vehicles}
                                bookings={bookings}
                                payments={payments}
                                customers={customers}
                            />
                        )}
                        {activeView === 'inspections' && (
                            <Inspections
                                inspections={inspections}
                                setInspections={setInspections}
                                bookings={bookings}
                                vehicles={vehicles}
                                showToast={showToast}
                            />
                        )}
                        {activeView === 'maintenance' && (
                            <Maintenance
                                maintenance={maintenance}
                                setMaintenance={setMaintenance}
                                vehicles={vehicles}
                            />
                        )}
                        {activeView === 'documents' && (
                            <Documents
                                documents={documents}
                                setDocuments={setDocuments}
                                bookings={bookings}
                                customers={customers}
                                vehicles={vehicles}
                            />
                        )}
                        {activeView === 'calendar' && (
                            <CalendarView
                                bookings={bookings}
                                setBookings={setBookings}
                                vehicles={vehicles}
                                customers={customers}
                                showToast={showToast}
                            />
                        )}
                        {activeView === 'contracts' && (
                            <Contracts
                                contracts={contracts}
                                setContracts={setContracts}
                                bookings={bookings}
                                customers={customers}
                                showToast={showToast}
                            />
                        )}
                        {activeView === 'customer-portal' && (
                            <CustomerPortal
                                customers={customers}
                                bookings={bookings}
                                payments={payments}
                                vehicles={vehicles}
                                showToast={showToast}
                            />
                        )}
                        {activeView === 'settings' && (
                            <Settings 
                                settings={settings}
                                setSettings={setSettings}
                            />
                        )}
                        {activeView === 'users' && (
                            <Users 
                                users={users}
                                setUsers={setUsers}
                                userRoles={userRoles}
                            />
                        )}
                        {activeView === 'user-roles' && (
                            <UserRoles 
                                userRoles={userRoles}
                                setUserRoles={setUserRoles}
                            />
                        )}
                        {activeView === 'access-control' && (
                            <AccessControl />
                        )}
                    </div>

                    {/* Toast Notification Container */}
                    <div className="toast-container">
                        {toasts.map(toast => (
                            <Toast
                                key={toast.id}
                                {...toast}
                                onClose={() => removeToast(toast.id)}
                            />
                        ))}
                    </div>
                </div>
            );
        }

        // Toast Component
        function Toast({ id, type, title, message, onClose }) {
            const icons = {
                success: '‚úì',
                error: '‚úï',
                warning: '‚ö†',
                info: '‚Ñπ'
            };

            return (
                <div className={`toast ${type}`}>
                    <div className="toast-icon">{icons[type]}</div>
                    <div className="toast-content">
                        <div className="toast-title">{title}</div>
                        {message && <div className="toast-message">{message}</div>}
                    </div>
                    <button className="toast-close" onClick={onClose}>√ó</button>
                </div>
            );
        }

        // Inspections Component
        function Inspections({ inspections, setInspections, bookings, vehicles, showToast }) {
            const [showModal, setShowModal] = useState(false);
            const [editingInspection, setEditingInspection] = useState(null);
            const [filterType, setFilterType] = useState('all');

            // Inspection checklist template
            const INSPECTION_ITEMS = [
                { category: 'Exterior', items: [
                    { id: 'ext_front', label: 'Front Bumper', type: 'condition' },
                    { id: 'ext_rear', label: 'Rear Bumper', type: 'condition' },
                    { id: 'ext_hood', label: 'Hood', type: 'condition' },
                    { id: 'ext_roof', label: 'Roof', type: 'condition' },
                    { id: 'ext_doors', label: 'All Doors', type: 'condition' },
                    { id: 'ext_mirrors', label: 'Side Mirrors', type: 'condition' },
                    { id: 'ext_windows', label: 'Windows/Windshield', type: 'condition' },
                    { id: 'ext_lights', label: 'Lights (Front/Rear)', type: 'working' },
                    { id: 'ext_tires', label: 'Tires & Rims', type: 'condition' },
                ]},
                { category: 'Interior', items: [
                    { id: 'int_seats', label: 'Seats', type: 'condition' },
                    { id: 'int_dashboard', label: 'Dashboard', type: 'condition' },
                    { id: 'int_steering', label: 'Steering Wheel', type: 'condition' },
                    { id: 'int_carpet', label: 'Carpet/Floor Mats', type: 'condition' },
                    { id: 'int_console', label: 'Center Console', type: 'condition' },
                    { id: 'int_ac', label: 'Air Conditioning', type: 'working' },
                    { id: 'int_radio', label: 'Radio/Sound System', type: 'working' },
                    { id: 'int_cleanliness', label: 'Overall Cleanliness', type: 'condition' },
                ]},
                { category: 'Mechanical', items: [
                    { id: 'mech_engine', label: 'Engine', type: 'working' },
                    { id: 'mech_brakes', label: 'Brakes', type: 'working' },
                    { id: 'mech_transmission', label: 'Transmission', type: 'working' },
                    { id: 'mech_battery', label: 'Battery', type: 'working' },
                    { id: 'mech_fluids', label: 'Fluid Levels', type: 'check' },
                ]},
                { category: 'Safety & Equipment', items: [
                    { id: 'safe_seatbelts', label: 'Seatbelts', type: 'working' },
                    { id: 'safe_airbags', label: 'Airbag Lights', type: 'check' },
                    { id: 'safe_spare', label: 'Spare Tire', type: 'present' },
                    { id: 'safe_jack', label: 'Jack & Tools', type: 'present' },
                    { id: 'safe_triangle', label: 'Warning Triangle', type: 'present' },
                    { id: 'safe_extinguisher', label: 'Fire Extinguisher', type: 'present' },
                    { id: 'safe_firstaid', label: 'First Aid Kit', type: 'present' },
                ]},
            ];

            // Damage cost reference
            const DAMAGE_COSTS = {
                minor_scratch: { label: 'Minor Scratch', cost: 500 },
                deep_scratch: { label: 'Deep Scratch', cost: 1500 },
                small_dent: { label: 'Small Dent', cost: 2000 },
                large_dent: { label: 'Large Dent', cost: 5000 },
                cracked_glass: { label: 'Cracked Glass', cost: 3000 },
                broken_light: { label: 'Broken Light', cost: 1000 },
                tire_damage: { label: 'Tire Damage', cost: 2500 },
                rim_damage: { label: 'Rim Damage', cost: 3500 },
                interior_stain: { label: 'Interior Stain', cost: 800 },
                torn_seat: { label: 'Torn Seat', cost: 2000 },
                missing_item: { label: 'Missing Equipment', cost: 500 },
                mechanical_issue: { label: 'Mechanical Issue', cost: 0 }, // Varies
                other: { label: 'Other Damage', cost: 0 },
            };

            const filteredInspections = filterType === 'all'
                ? inspections
                : inspections.filter(i => i.type === filterType);

            const addInspection = (inspection) => {
                try {
                    if (editingInspection) {
                        setInspections(inspections.map(i => i.id === editingInspection.id ? inspection : i));
                        if (showToast) showToast('success', 'Inspection Updated', 'The inspection report has been updated.');
                    } else {
                        const newInspection = { ...inspection, id: Date.now() };
                        setInspections([...inspections, newInspection]);
                        if (showToast) showToast('success', 'Inspection Saved', 'The inspection report has been saved successfully.');
                    }
                    setShowModal(false);
                    setEditingInspection(null);
                } catch (error) {
                    console.error('Error saving inspection:', error);
                    if (showToast) showToast('error', 'Save Failed', 'Could not save inspection. Photos may be too large.');
                }
            };

            const generateInspectionPDF = (inspection) => {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                let y = 15;
                const leftMargin = 15;
                const pageWidth = 210;

                // Company Header (styled text instead of image to avoid PDF errors)
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(26, 122, 138);
                doc.text('KETU KAKAHALA', leftMargin, y);
                y += 5;
                doc.setFontSize(8);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(100, 100, 100);
                doc.text('Vehicle Rental Services', leftMargin, y);
                y += 3;
                doc.text('Mongu, Zambia | Tel: +260 XXX XXX XXX', leftMargin, y);
                y += 10;

                // Header
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(26, 122, 138);
                doc.text('VEHICLE INSPECTION REPORT', pageWidth/2, y, { align: 'center' });
                y += 10;

                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(0, 0, 0);
                doc.text(`Inspection ID: #${inspection.id}`, leftMargin, y);
                doc.text(`Date: ${new Date(inspection.date).toLocaleString()}`, 140, y);
                y += 6;
                doc.text(`Type: ${inspection.type === 'pre' ? 'Pre-Rental' : 'Post-Rental'}`, leftMargin, y);
                y += 10;

                // Vehicle & Booking Info
                doc.setFont(undefined, 'bold');
                doc.text('Vehicle Information:', leftMargin, y);
                y += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                doc.text(`Vehicle: ${inspection.vehicleName}`, leftMargin + 5, y);
                y += 5;
                doc.text(`License Plate: ${inspection.licensePlate}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Odometer: ${inspection.odometer} km`, leftMargin + 5, y);
                y += 5;
                doc.text(`Fuel Level: ${inspection.fuelLevel}`, leftMargin + 5, y);
                y += 8;

                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('Inspector:', leftMargin, y);
                y += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                doc.text(`Name: ${inspection.inspectorName}`, leftMargin + 5, y);
                y += 5;
                if (inspection.customerName) {
                    doc.text(`Customer: ${inspection.customerName}`, leftMargin + 5, y);
                    y += 5;
                }
                y += 5;

                // Inspection Checklist
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('Inspection Checklist:', leftMargin, y);
                y += 6;

                doc.setFontSize(8);
                INSPECTION_ITEMS.forEach(category => {
                    if (y > 250) {
                        doc.addPage();
                        y = 20;
                    }

                    doc.setFont(undefined, 'bold');
                    doc.text(category.category, leftMargin + 2, y);
                    y += 5;

                    doc.setFont(undefined, 'normal');
                    category.items.forEach(item => {
                        const status = inspection.checklist?.[item.id] || 'N/A';
                        const statusColor = status === 'good' || status === 'yes' ? [39, 174, 96] :
                                          status === 'damaged' || status === 'no' ? [231, 76, 60] :
                                          [127, 140, 141];

                        doc.text(item.label + ':', leftMargin + 5, y);
                        doc.setTextColor(...statusColor);
                        doc.text(status.toUpperCase(), 80, y);
                        doc.setTextColor(0, 0, 0);
                        y += 4;

                        if (y > 270) {
                            doc.addPage();
                            y = 20;
                        }
                    });
                    y += 3;
                });

                // Damages
                if (inspection.damages && inspection.damages.length > 0) {
                    if (y > 200) {
                        doc.addPage();
                        y = 20;
                    }

                    y += 5;
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(231, 76, 60);
                    doc.text('DAMAGE REPORT:', leftMargin, y);
                    y += 6;

                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont(undefined, 'normal');

                    inspection.damages.forEach((damage, index) => {
                        doc.text(`${index + 1}. ${damage.type}: ${damage.description}`, leftMargin + 2, y);
                        y += 5;
                        doc.text(`   Estimated Cost: N$${damage.cost}`, leftMargin + 2, y);
                        y += 6;
                    });

                    const totalDamageCost = inspection.damages.reduce((sum, d) => sum + parseFloat(d.cost || 0), 0);
                    doc.setFont(undefined, 'bold');
                    doc.text(`TOTAL DAMAGE COST: N$${totalDamageCost.toFixed(2)}`, leftMargin, y);
                }

                // Notes
                if (inspection.notes) {
                    if (y > 240) {
                        doc.addPage();
                        y = 20;
                    }

                    y += 10;
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.text('Additional Notes:', leftMargin, y);
                    y += 6;
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(9);
                    const lines = doc.splitTextToSize(inspection.notes, 180);
                    doc.text(lines, leftMargin, y);
                }

                    doc.save(`Inspection-Report-${inspection.id}.pdf`);
                    if (showToast) showToast('success', 'PDF Generated', 'Inspection report has been downloaded.');
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    if (showToast) showToast('error', 'PDF Generation Failed', 'Could not generate the inspection report.');
                }
            };

            return (
                <div>
                    <div className="header">
                        <div>
                            <h2>Vehicle Inspections</h2>
                            <p>Pre-rental and post-rental vehicle condition reports</p>
                        </div>
                        <button
                            className="btn btn-primary"
                            onClick={() => {
                                setEditingInspection(null);
                                setShowModal(true);
                            }}
                        >
                            ‚ûï New Inspection
                        </button>
                    </div>

                    {/* Filter Tabs */}
                    <div style={{
                        backgroundColor: 'white',
                        padding: '15px 20px',
                        borderRadius: '12px',
                        marginBottom: '20px',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                        display: 'flex',
                        gap: '10px'
                    }}>
                        {['all', 'pre', 'post'].map(type => (
                            <button
                                key={type}
                                onClick={() => setFilterType(type)}
                                style={{
                                    padding: '8px 16px',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer',
                                    backgroundColor: filterType === type ? 'var(--primary-teal)' : '#f0f0f0',
                                    color: filterType === type ? 'white' : 'var(--text-dark)',
                                    fontSize: '14px',
                                    fontWeight: filterType === type ? '500' : 'normal',
                                }}
                            >
                                {type === 'all' ? 'All Inspections' : type === 'pre' ? 'Pre-Rental' : 'Post-Rental'}
                            </button>
                        ))}
                    </div>

                    <div className="card">
                        {filteredInspections.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üîç</div>
                                <p>No inspections yet</p>
                                <small style={{color: '#999'}}>Create inspection reports for vehicle pickups and returns</small>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Vehicle</th>
                                        <th>Booking ID</th>
                                        <th>Odometer</th>
                                        <th>Fuel</th>
                                        <th>Damages</th>
                                        <th>Inspector</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredInspections.map(inspection => (
                                        <tr key={inspection.id}>
                                            <td>#{inspection.id}</td>
                                            <td>{new Date(inspection.date).toLocaleString()}</td>
                                            <td>
                                                <span className={`badge ${inspection.type === 'pre' ? 'badge-active' : 'badge-completed'}`}>
                                                    {inspection.type === 'pre' ? 'Pre-Rental' : 'Post-Rental'}
                                                </span>
                                            </td>
                                            <td>{inspection.vehicleName}<br/><small>{inspection.licensePlate}</small></td>
                                            <td>#{inspection.bookingId}</td>
                                            <td>{inspection.odometer} km</td>
                                            <td>{inspection.fuelLevel}</td>
                                            <td>
                                                {inspection.damages?.length > 0 ? (
                                                    <span style={{color: '#e74c3c', fontWeight: 'bold'}}>
                                                        {inspection.damages.length} issue(s)
                                                    </span>
                                                ) : (
                                                    <span style={{color: '#27ae60'}}>No damages</span>
                                                )}
                                            </td>
                                            <td>{inspection.inspectorName}</td>
                                            <td>
                                                <button
                                                    className="btn btn-success"
                                                    style={{ padding: '6px 10px', fontSize: '12px' }}
                                                    onClick={() => generateInspectionPDF(inspection)}
                                                    title="Generate PDF"
                                                >
                                                    üìÑ
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {showModal && (
                        <InspectionModal
                            inspection={editingInspection}
                            bookings={bookings}
                            vehicles={vehicles}
                            checklistItems={INSPECTION_ITEMS}
                            damageCosts={DAMAGE_COSTS}
                            onSave={addInspection}
                            onClose={() => {
                                setShowModal(false);
                                setEditingInspection(null);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Inspection Modal Component
        function InspectionModal({ inspection, bookings, vehicles, checklistItems, damageCosts, onSave, onClose }) {
            const [formData, setFormData] = useState(inspection || {
                type: 'pre',
                bookingId: '',
                vehicleId: '',
                vehicleName: '',
                licensePlate: '',
                customerName: '',
                inspectorName: '',
                date: new Date().toISOString().slice(0, 16),
                odometer: '',
                fuelLevel: 'full',
                checklist: {},
                damages: [],
                photos: [],
                notes: ''
            });

            const [currentTab, setCurrentTab] = useState('info');
            const [newDamage, setNewDamage] = useState({ type: '', description: '', cost: 0, location: '' });

            const handleBookingChange = (bookingId) => {
                const booking = bookings.find(b => b.id === parseInt(bookingId));
                if (booking) {
                    const vehicle = vehicles.find(v => v.id === booking.vehicleId || `${v.make} ${v.model}` === booking.vehicleName);
                    setFormData({
                        ...formData,
                        bookingId: booking.id,
                        vehicleId: vehicle?.id || '',
                        vehicleName: booking.vehicleName,
                        licensePlate: booking.licensePlate || vehicle?.licensePlate || '',
                        customerName: booking.customerName
                    });
                }
            };

            const handleChecklistChange = (itemId, value) => {
                setFormData({
                    ...formData,
                    checklist: {
                        ...formData.checklist,
                        [itemId]: value
                    }
                });
            };

            const addDamage = () => {
                if (newDamage.type && newDamage.description) {
                    const cost = newDamage.cost || (damageCosts[newDamage.type]?.cost || 0);
                    setFormData({
                        ...formData,
                        damages: [...formData.damages, { ...newDamage, cost }]
                    });
                    setNewDamage({ type: '', description: '', cost: 0, location: '' });
                }
            };

            const removeDamage = (index) => {
                setFormData({
                    ...formData,
                    damages: formData.damages.filter((_, i) => i !== index)
                });
            };

            const handlePhotoUpload = (e) => {
                const files = Array.from(e.target.files);

                // Limit to 5 photos total
                if (formData.photos.length + files.length > 5) {
                    if (showToast) showToast('warning', 'Too Many Photos', 'Maximum 5 photos allowed per inspection.');
                    return;
                }

                const readers = files.map(file => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            // Compress image
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                const MAX_WIDTH = 400;
                                const MAX_HEIGHT = 400;
                                let width = img.width;
                                let height = img.height;

                                if (width > height) {
                                    if (width > MAX_WIDTH) {
                                        height *= MAX_WIDTH / width;
                                        width = MAX_WIDTH;
                                    }
                                } else {
                                    if (height > MAX_HEIGHT) {
                                        width *= MAX_HEIGHT / height;
                                        height = MAX_HEIGHT;
                                    }
                                }

                                canvas.width = width;
                                canvas.height = height;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, width, height);

                                // Convert to base64 with compression
                                const compressed = canvas.toDataURL('image/jpeg', 0.7);
                                resolve(compressed);
                            };
                            img.onerror = () => reject(new Error('Failed to load image'));
                            img.src = event.target.result;
                        };
                        reader.onerror = () => reject(new Error('Failed to read file'));
                        reader.readAsDataURL(file);
                    });
                });

                Promise.all(readers).then(results => {
                    setFormData({
                        ...formData,
                        photos: [...formData.photos, ...results]
                    });
                }).catch(error => {
                    console.error('Photo upload error:', error);
                    if (showToast) showToast('error', 'Upload Failed', 'Could not upload photos. Please try smaller images.');
                });
            };

            const removePhoto = (index) => {
                setFormData({
                    ...formData,
                    photos: formData.photos.filter((_, i) => i !== index)
                });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            const totalDamageCost = formData.damages.reduce((sum, d) => sum + parseFloat(d.cost || 0), 0);

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" style={{maxWidth: '900px', maxHeight: '90vh', overflow: 'auto'}} onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h3>{inspection ? 'Edit Inspection' : 'New Vehicle Inspection'}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>

                        {/* Tabs */}
                        <div style={{ borderBottom: '2px solid #e0e0e0', marginBottom: '20px' }}>
                            <div style={{ display: 'flex', gap: '20px' }}>
                                {[
                                    { id: 'info', label: 'Basic Info', icon: '‚ÑπÔ∏è' },
                                    { id: 'checklist', label: 'Checklist', icon: '‚úì' },
                                    { id: 'damages', label: 'Damages', icon: '‚ö†Ô∏è' },
                                    { id: 'photos', label: 'Photos', icon: 'üì∑' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setCurrentTab(tab.id)}
                                        style={{
                                            padding: '10px 20px',
                                            border: 'none',
                                            background: 'none',
                                            borderBottom: currentTab === tab.id ? '3px solid var(--primary-teal)' : 'none',
                                            color: currentTab === tab.id ? 'var(--primary-teal)' : '#666',
                                            fontWeight: currentTab === tab.id ? 'bold' : 'normal',
                                            cursor: 'pointer',
                                            fontSize: '14px'
                                        }}
                                    >
                                        {tab.icon} {tab.label}
                                        {tab.id === 'damages' && formData.damages.length > 0 && (
                                            <span style={{
                                                marginLeft: '8px',
                                                backgroundColor: '#e74c3c',
                                                color: 'white',
                                                borderRadius: '10px',
                                                padding: '2px 6px',
                                                fontSize: '11px'
                                            }}>
                                                {formData.damages.length}
                                            </span>
                                        )}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <form onSubmit={handleSubmit}>
                            {/* Basic Info Tab */}
                            {currentTab === 'info' && (
                                <div>
                                    <div className="form-row">
                                        <div className="form-group">
                                            <label>Inspection Type *</label>
                                            <select
                                                className="form-control"
                                                value={formData.type}
                                                onChange={(e) => setFormData({...formData, type: e.target.value})}
                                                required
                                            >
                                                <option value="pre">Pre-Rental (Pickup)</option>
                                                <option value="post">Post-Rental (Return)</option>
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label>Date & Time *</label>
                                            <input
                                                type="datetime-local"
                                                className="form-control"
                                                value={formData.date}
                                                onChange={(e) => setFormData({...formData, date: e.target.value})}
                                                required
                                            />
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label>Booking *</label>
                                        <select
                                            className="form-control"
                                            value={formData.bookingId}
                                            onChange={(e) => handleBookingChange(e.target.value)}
                                            required
                                        >
                                            <option value="">Select a booking</option>
                                            {bookings.filter(b => b.status === 'active').map(booking => (
                                                <option key={booking.id} value={booking.id}>
                                                    #{booking.id} - {booking.customerName} - {booking.vehicleName}
                                                </option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="form-group">
                                        <label>Inspector Name *</label>
                                        <input
                                            type="text"
                                            className="form-control"
                                            value={formData.inspectorName}
                                            onChange={(e) => setFormData({...formData, inspectorName: e.target.value})}
                                            placeholder="Enter your name"
                                            required
                                        />
                                    </div>

                                    <div className="form-row">
                                        <div className="form-group">
                                            <label>Odometer Reading (km) *</label>
                                            <input
                                                type="number"
                                                className="form-control"
                                                value={formData.odometer}
                                                onChange={(e) => setFormData({...formData, odometer: e.target.value})}
                                                placeholder="e.g., 45000"
                                                step="0.1"
                                                required
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>Fuel Level *</label>
                                            <select
                                                className="form-control"
                                                value={formData.fuelLevel}
                                                onChange={(e) => setFormData({...formData, fuelLevel: e.target.value})}
                                                required
                                            >
                                                <option value="full">Full</option>
                                                <option value="three-quarters">3/4</option>
                                                <option value="half">1/2</option>
                                                <option value="quarter">1/4</option>
                                                <option value="empty">Empty</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label>Additional Notes</label>
                                        <textarea
                                            className="form-control"
                                            value={formData.notes}
                                            onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                            rows="4"
                                            placeholder="Any additional observations or comments..."
                                        />
                                    </div>
                                </div>
                            )}

                            {/* Checklist Tab */}
                            {currentTab === 'checklist' && (
                                <div>
                                    <p style={{marginBottom: '20px', color: '#666'}}>
                                        Check each component and select its condition
                                    </p>

                                    {checklistItems.map((category, catIndex) => (
                                        <div key={catIndex} style={{marginBottom: '25px'}}>
                                            <h4 style={{
                                                backgroundColor: '#f0f8ff',
                                                padding: '10px 15px',
                                                borderRadius: '6px',
                                                marginBottom: '15px',
                                                color: 'var(--primary-teal)'
                                            }}>
                                                {category.category}
                                            </h4>

                                            {category.items.map((item) => (
                                                <div key={item.id} style={{
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    padding: '12px 15px',
                                                    borderBottom: '1px solid #eee'
                                                }}>
                                                    <label style={{margin: 0, fontWeight: '500'}}>{item.label}</label>
                                                    <div style={{display: 'flex', gap: '10px'}}>
                                                        {item.type === 'condition' && (
                                                            <>
                                                                <button
                                                                    type="button"
                                                                    onClick={() => handleChecklistChange(item.id, 'good')}
                                                                    style={{
                                                                        padding: '6px 12px',
                                                                        border: '2px solid',
                                                                        borderColor: formData.checklist[item.id] === 'good' ? '#27ae60' : '#ddd',
                                                                        backgroundColor: formData.checklist[item.id] === 'good' ? '#27ae60' : 'white',
                                                                        color: formData.checklist[item.id] === 'good' ? 'white' : '#666',
                                                                        borderRadius: '6px',
                                                                        cursor: 'pointer',
                                                                        fontSize: '13px',
                                                                        fontWeight: '500'
                                                                    }}
                                                                >
                                                                    Good
                                                                </button>
                                                                <button
                                                                    type="button"
                                                                    onClick={() => handleChecklistChange(item.id, 'damaged')}
                                                                    style={{
                                                                        padding: '6px 12px',
                                                                        border: '2px solid',
                                                                        borderColor: formData.checklist[item.id] === 'damaged' ? '#e74c3c' : '#ddd',
                                                                        backgroundColor: formData.checklist[item.id] === 'damaged' ? '#e74c3c' : 'white',
                                                                        color: formData.checklist[item.id] === 'damaged' ? 'white' : '#666',
                                                                        borderRadius: '6px',
                                                                        cursor: 'pointer',
                                                                        fontSize: '13px',
                                                                        fontWeight: '500'
                                                                    }}
                                                                >
                                                                    Damaged
                                                                </button>
                                                            </>
                                                        )}
                                                        {item.type === 'working' && (
                                                            <>
                                                                <button
                                                                    type="button"
                                                                    onClick={() => handleChecklistChange(item.id, 'yes')}
                                                                    style={{
                                                                        padding: '6px 12px',
                                                                        border: '2px solid',
                                                                        borderColor: formData.checklist[item.id] === 'yes' ? '#27ae60' : '#ddd',
                                                                        backgroundColor: formData.checklist[item.id] === 'yes' ? '#27ae60' : 'white',
                                                                        color: formData.checklist[item.id] === 'yes' ? 'white' : '#666',
                                                                        borderRadius: '6px',
                                                                        cursor: 'pointer',
                                                                        fontSize: '13px',
                                                                        fontWeight: '500'
                                                                    }}
                                                                >
                                                                    Working
                                                                </button>
                                                                <button
                                                                    type="button"
                                                                    onClick={() => handleChecklistChange(item.id, 'no')}
                                                                    style={{
                                                                        padding: '6px 12px',
                                                                        border: '2px solid',
                                                                        borderColor: formData.checklist[item.id] === 'no' ? '#e74c3c' : '#ddd',
                                                                        backgroundColor: formData.checklist[item.id] === 'no' ? '#e74c3c' : 'white',
                                                                        color: formData.checklist[item.id] === 'no' ? 'white' : '#666',
                                                                        borderRadius: '6px',
                                                                        cursor: 'pointer',
                                                                        fontSize: '13px',
                                                                        fontWeight: '500'
                                                                    }}
                                                                >
                                                                    Not Working
                                                                </button>
                                                            </>
                                                        )}
                                                        {(item.type === 'check' || item.type === 'present') && (
                                                            <>
                                                                <button
                                                                    type="button"
                                                                    onClick={() => handleChecklistChange(item.id, 'yes')}
                                                                    style={{
                                                                        padding: '6px 12px',
                                                                        border: '2px solid',
                                                                        borderColor: formData.checklist[item.id] === 'yes' ? '#27ae60' : '#ddd',
                                                                        backgroundColor: formData.checklist[item.id] === 'yes' ? '#27ae60' : 'white',
                                                                        color: formData.checklist[item.id] === 'yes' ? 'white' : '#666',
                                                                        borderRadius: '6px',
                                                                        cursor: 'pointer',
                                                                        fontSize: '13px',
                                                                        fontWeight: '500'
                                                                    }}
                                                                >
                                                                    Yes
                                                                </button>
                                                                <button
                                                                    type="button"
                                                                    onClick={() => handleChecklistChange(item.id, 'no')}
                                                                    style={{
                                                                        padding: '6px 12px',
                                                                        border: '2px solid',
                                                                        borderColor: formData.checklist[item.id] === 'no' ? '#e74c3c' : '#ddd',
                                                                        backgroundColor: formData.checklist[item.id] === 'no' ? '#e74c3c' : 'white',
                                                                        color: formData.checklist[item.id] === 'no' ? 'white' : '#666',
                                                                        borderRadius: '6px',
                                                                        cursor: 'pointer',
                                                                        fontSize: '13px',
                                                                        fontWeight: '500'
                                                                    }}
                                                                >
                                                                    No
                                                                </button>
                                                            </>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Damages Tab */}
                            {currentTab === 'damages' && (
                                <div>
                                    <div style={{
                                        backgroundColor: '#fff3cd',
                                        border: '1px solid #ffc107',
                                        borderRadius: '8px',
                                        padding: '15px',
                                        marginBottom: '20px'
                                    }}>
                                        <strong>üí° Add New Damage/Issue</strong>
                                        <div className="form-row" style={{marginTop: '10px'}}>
                                            <div className="form-group">
                                                <select
                                                    className="form-control"
                                                    value={newDamage.type}
                                                    onChange={(e) => {
                                                        const selectedType = e.target.value;
                                                        const cost = damageCosts[selectedType]?.cost || 0;
                                                        setNewDamage({...newDamage, type: selectedType, cost});
                                                    }}
                                                >
                                                    <option value="">Select damage type</option>
                                                    {Object.keys(damageCosts).map(key => (
                                                        <option key={key} value={key}>
                                                            {damageCosts[key].label} - N${damageCosts[key].cost}
                                                        </option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div className="form-group">
                                                <input
                                                    type="text"
                                                    className="form-control"
                                                    placeholder="Location (e.g., Front left door)"
                                                    value={newDamage.location}
                                                    onChange={(e) => setNewDamage({...newDamage, location: e.target.value})}
                                                />
                                            </div>
                                        </div>
                                        <div className="form-row">
                                            <div className="form-group" style={{flex: 2}}>
                                                <input
                                                    type="text"
                                                    className="form-control"
                                                    placeholder="Description"
                                                    value={newDamage.description}
                                                    onChange={(e) => setNewDamage({...newDamage, description: e.target.value})}
                                                />
                                            </div>
                                            <div className="form-group">
                                                <input
                                                    type="number"
                                                    className="form-control"
                                                    placeholder="Cost (N$)"
                                                    value={newDamage.cost}
                                                    onChange={(e) => setNewDamage({...newDamage, cost: e.target.value})}
                                                    step="0.01"
                                                />
                                            </div>
                                            <button
                                                type="button"
                                                className="btn btn-primary"
                                                onClick={addDamage}
                                                style={{height: '42px'}}
                                            >
                                                ‚ûï Add
                                            </button>
                                        </div>
                                    </div>

                                    {formData.damages.length > 0 ? (
                                        <div>
                                            <h4 style={{marginBottom: '15px'}}>Reported Damages:</h4>
                                            {formData.damages.map((damage, index) => (
                                                <div key={index} style={{
                                                    backgroundColor: '#ffebee',
                                                    border: '1px solid #ef5350',
                                                    borderRadius: '8px',
                                                    padding: '15px',
                                                    marginBottom: '10px',
                                                    position: 'relative'
                                                }}>
                                                    <button
                                                        type="button"
                                                        onClick={() => removeDamage(index)}
                                                        style={{
                                                            position: 'absolute',
                                                            top: '10px',
                                                            right: '10px',
                                                            background: '#e74c3c',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '4px',
                                                            padding: '4px 8px',
                                                            cursor: 'pointer',
                                                            fontSize: '12px'
                                                        }}
                                                    >
                                                        Remove
                                                    </button>
                                                    <div><strong>{damageCosts[damage.type]?.label || damage.type}</strong></div>
                                                    {damage.location && <div style={{fontSize: '13px', color: '#666'}}>Location: {damage.location}</div>}
                                                    <div style={{marginTop: '5px'}}>{damage.description}</div>
                                                    <div style={{marginTop: '8px', fontWeight: 'bold', color: '#c62828'}}>
                                                        Estimated Cost: N${parseFloat(damage.cost).toFixed(2)}
                                                    </div>
                                                </div>
                                            ))}
                                            <div style={{
                                                marginTop: '20px',
                                                padding: '15px',
                                                backgroundColor: '#f5f5f5',
                                                borderRadius: '8px',
                                                textAlign: 'right'
                                            }}>
                                                <h3 style={{margin: 0, color: '#c62828'}}>
                                                    Total Damage Cost: N${totalDamageCost.toFixed(2)}
                                                </h3>
                                            </div>
                                        </div>
                                    ) : (
                                        <div style={{textAlign: 'center', padding: '40px', color: '#999'}}>
                                            <div style={{fontSize: '48px'}}>‚úì</div>
                                            <p>No damages reported</p>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Photos Tab */}
                            {currentTab === 'photos' && (
                                <div>
                                    <div style={{marginBottom: '20px'}}>
                                        <label className="btn btn-secondary" style={{cursor: 'pointer', display: 'inline-block'}}>
                                            üì∑ Upload Photos
                                            <input
                                                type="file"
                                                accept="image/*"
                                                multiple
                                                onChange={handlePhotoUpload}
                                                style={{display: 'none'}}
                                            />
                                        </label>
                                        <p style={{fontSize: '13px', color: '#666', marginTop: '10px'}}>
                                            Upload photos of the vehicle condition, damages, or any concerns
                                        </p>
                                    </div>

                                    {formData.photos.length > 0 ? (
                                        <div style={{
                                            display: 'grid',
                                            gridTemplateColumns: 'repeat(auto-fill, minmax(150px, 1fr))',
                                            gap: '15px'
                                        }}>
                                            {formData.photos.map((photo, index) => (
                                                <div key={index} style={{position: 'relative'}}>
                                                    <img
                                                        src={photo}
                                                        alt={`Inspection photo ${index + 1}`}
                                                        style={{
                                                            width: '100%',
                                                            height: '150px',
                                                            objectFit: 'cover',
                                                            borderRadius: '8px',
                                                            border: '2px solid #ddd'
                                                        }}
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => removePhoto(index)}
                                                        style={{
                                                            position: 'absolute',
                                                            top: '5px',
                                                            right: '5px',
                                                            background: '#e74c3c',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '50%',
                                                            width: '25px',
                                                            height: '25px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        √ó
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div style={{textAlign: 'center', padding: '40px', color: '#999'}}>
                                            <div style={{fontSize: '48px'}}>üì∑</div>
                                            <p>No photos uploaded yet</p>
                                        </div>
                                    )}
                                </div>
                            )}

                            <div className="modal-footer" style={{marginTop: '30px'}}>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save Inspection
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Notification Center Component
        function NotificationCenter({ notifications, markAsRead, bookings}) {
            const [filterCategory, setFilterCategory] = useState('all');

            const categories = [
                { id: 'all', label: 'All', icon: 'üì¨' },
                { id: 'booking', label: 'Bookings', icon: 'üìÖ' },
                { id: 'payment', label: 'Payments', icon: 'üí∞' },
                { id: 'reminder', label: 'Reminders', icon: '‚è∞' },
                { id: 'alert', label: 'Alerts', icon: 'üö®' },
            ];

            const filteredNotifications = filterCategory === 'all'
                ? notifications
                : notifications.filter(n => n.category === filterCategory);

            const getCategoryIcon = (category) => {
                switch(category) {
                    case 'booking': return 'üìÖ';
                    case 'payment': return 'üí∞';
                    case 'reminder': return '‚è∞';
                    case 'alert': return 'üö®';
                    default: return 'üìß';
                }
            };

            const getTypeIcon = (type) => {
                switch(type) {
                    case 'email': return 'üìß';
                    case 'sms': return 'üì±';
                    case 'both': return 'üìßüì±';
                    default: return 'üì¨';
                }
            };

            return (
                <div>
                    <div className="header">
                        <h2>Notifications</h2>
                        <p>Email/SMS notifications sent to customers</p>
                    </div>

                    {/* Category Filter */}
                    <div style={{
                        backgroundColor: 'white',
                        padding: '15px 20px',
                        borderRadius: '12px',
                        marginBottom: '20px',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                        display: 'flex',
                        gap: '10px',
                        flexWrap: 'wrap'
                    }}>
                        {categories.map(cat => (
                            <button
                                key={cat.id}
                                onClick={() => setFilterCategory(cat.id)}
                                style={{
                                    padding: '8px 16px',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer',
                                    backgroundColor: filterCategory === cat.id ? 'var(--primary-teal)' : '#f0f0f0',
                                    color: filterCategory === cat.id ? 'white' : 'var(--text-dark)',
                                    fontSize: '14px',
                                    fontWeight: filterCategory === cat.id ? '500' : 'normal',
                                    transition: 'all 0.3s',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '6px'
                                }}
                            >
                                <span>{cat.icon}</span>
                                <span>{cat.label}</span>
                            </button>
                        ))}
                    </div>

                    <div className="card">
                        {filteredNotifications.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üîî</div>
                                <p>No notifications yet</p>
                                <small style={{color: '#999', marginTop: '10px', display: 'block'}}>
                                    Notifications will appear here when bookings are created, payments received, or reminders sent
                                </small>
                            </div>
                        ) : (
                            <div>
                                {filteredNotifications.map(notification => (
                                    <div
                                        key={notification.id}
                                        onClick={() => markAsRead(notification.id)}
                                        style={{
                                            padding: '20px',
                                            borderBottom: '1px solid #e0e0e0',
                                            backgroundColor: notification.read ? 'white' : '#f0f8ff',
                                            cursor: 'pointer',
                                            transition: 'background 0.2s',
                                            position: 'relative'
                                        }}
                                        onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#f5f5f5'}
                                        onMouseLeave={(e) => e.currentTarget.style.backgroundColor = notification.read ? 'white' : '#f0f8ff'}
                                    >
                                        <div style={{ display: 'flex', gap: '15px', alignItems: 'start' }}>
                                            <div style={{
                                                fontSize: '32px',
                                                flexShrink: 0
                                            }}>
                                                {getCategoryIcon(notification.category)}
                                            </div>
                                            <div style={{ flex: 1 }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '8px' }}>
                                                    <div>
                                                        <h4 style={{ margin: 0, fontSize: '16px', color: '#2c3e50' }}>
                                                            {notification.subject}
                                                            {!notification.read && (
                                                                <span style={{
                                                                    marginLeft: '10px',
                                                                    backgroundColor: '#e74c3c',
                                                                    color: 'white',
                                                                    fontSize: '10px',
                                                                    padding: '2px 6px',
                                                                    borderRadius: '10px',
                                                                    fontWeight: 'bold'
                                                                }}>NEW</span>
                                                            )}
                                                        </h4>
                                                        <div style={{ fontSize: '12px', color: '#999', marginTop: '4px' }}>
                                                            <span>{getTypeIcon(notification.type)} </span>
                                                            <span>To: {notification.recipient.name || notification.recipient.email || notification.recipient.phone}</span>
                                                            <span style={{ margin: '0 8px' }}>‚Ä¢</span>
                                                            <span>{new Date(notification.timestamp).toLocaleString()}</span>
                                                        </div>
                                                    </div>
                                                    <span style={{
                                                        fontSize: '11px',
                                                        padding: '4px 10px',
                                                        borderRadius: '12px',
                                                        backgroundColor: notification.status === 'sent' ? '#27ae60' : '#95a5a6',
                                                        color: 'white',
                                                        fontWeight: '500'
                                                    }}>
                                                        {notification.status}
                                                    </span>
                                                </div>
                                                <p style={{
                                                    margin: '12px 0 0 0',
                                                    fontSize: '14px',
                                                    color: '#555',
                                                    whiteSpace: 'pre-line',
                                                    lineHeight: '1.6'
                                                }}>
                                                    {notification.message}
                                                </p>
                                                {notification.bookingId && (
                                                    <div style={{
                                                        marginTop: '12px',
                                                        padding: '8px 12px',
                                                        backgroundColor: '#f9f9f9',
                                                        borderRadius: '6px',
                                                        fontSize: '12px',
                                                        color: '#666'
                                                    }}>
                                                        üìã Related to Booking #{notification.bookingId}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Calendar View Component
        function CalendarView({ bookings, setBookings, vehicles, customers, showToast }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedBooking, setSelectedBooking] = useState(null);
            const [viewMode, setViewMode] = useState('month'); // month, week, day

            const getDaysInMonth = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();

                const days = [];
                // Add empty cells for days before month starts
                for (let i = 0; i < startingDayOfWeek; i++) {
                    days.push(null);
                }
                // Add days of month
                for (let day = 1; day <= daysInMonth; day++) {
                    days.push(new Date(year, month, day));
                }
                return days;
            };

            const getBookingsForDate = (date) => {
                if (!date) return [];
                const dateStr = date.toDateString();
                return bookings.filter(booking => {
                    const startDate = new Date(booking.startDate);
                    const endDate = new Date(booking.endDate);
                    const checkDate = new Date(dateStr);
                    return checkDate >= new Date(startDate.toDateString()) &&
                           checkDate <= new Date(endDate.toDateString());
                });
            };

            const getVehicleName = (vehicleId) => {
                const vehicle = vehicles.find(v => v.id === vehicleId);
                return vehicle ? vehicle.name : 'Unknown Vehicle';
            };

            const previousMonth = () => {
                setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
            };

            const nextMonth = () => {
                setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));
            };

            const today = () => {
                setCurrentDate(new Date());
            };

            const days = getDaysInMonth(currentDate);
            const monthName = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            return (
                <div>
                    <div className="header">
                        <h2>üìÜ Calendar View</h2>
                        <p>Visual booking calendar with drag-and-drop support</p>
                    </div>

                    <div className="card" style={{ marginBottom: '20px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '20px' }}>
                            <div style={{ display: 'flex', gap: '10px' }}>
                                <button className="btn btn-primary" onClick={previousMonth}>‚Üê Previous</button>
                                <button className="btn btn-secondary" onClick={today}>Today</button>
                                <button className="btn btn-primary" onClick={nextMonth}>Next ‚Üí</button>
                            </div>
                            <h2 style={{ margin: 0 }}>{monthName}</h2>
                            <div style={{ display: 'flex', gap: '10px' }}>
                                <select
                                    className="form-control"
                                    value={viewMode}
                                    onChange={(e) => setViewMode(e.target.value)}
                                    style={{ width: '120px' }}
                                >
                                    <option value="month">Month</option>
                                    <option value="week">Week</option>
                                    <option value="day">Day</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <div style={{ padding: '20px' }}>
                            {/* Calendar Grid */}
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(7, 1fr)',
                                gap: '1px',
                                backgroundColor: '#e0e0e0'
                            }}>
                                {/* Day Headers */}
                                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                    <div
                                        key={day}
                                        style={{
                                            backgroundColor: 'var(--primary-teal)',
                                            color: 'white',
                                            padding: '10px',
                                            textAlign: 'center',
                                            fontWeight: 'bold'
                                        }}
                                    >
                                        {day}
                                    </div>
                                ))}

                                {/* Calendar Days */}
                                {days.map((date, index) => {
                                    const dayBookings = date ? getBookingsForDate(date) : [];
                                    const isToday = date && date.toDateString() === new Date().toDateString();
                                    const isCurrentMonth = date && date.getMonth() === currentDate.getMonth();

                                    return (
                                        <div
                                            key={index}
                                            style={{
                                                backgroundColor: 'white',
                                                minHeight: '100px',
                                                padding: '5px',
                                                position: 'relative',
                                                opacity: isCurrentMonth || !date ? 1 : 0.3,
                                                border: isToday ? '2px solid var(--primary-orange)' : 'none'
                                            }}
                                        >
                                            {date && (
                                                <>
                                                    <div style={{
                                                        fontWeight: isToday ? 'bold' : 'normal',
                                                        color: isToday ? 'var(--primary-orange)' : 'var(--text-dark)',
                                                        marginBottom: '5px',
                                                        fontSize: '14px'
                                                    }}>
                                                        {date.getDate()}
                                                    </div>
                                                    <div style={{ fontSize: '11px' }}>
                                                        {dayBookings.map(booking => (
                                                            <div
                                                                key={booking.id}
                                                                onClick={() => setSelectedBooking(booking)}
                                                                style={{
                                                                    backgroundColor: booking.status === 'active' ? 'var(--success)' :
                                                                                   booking.status === 'pending' ? 'var(--warning)' :
                                                                                   booking.status === 'completed' ? 'var(--primary-teal)' :
                                                                                   'var(--text-light)',
                                                                    color: 'white',
                                                                    padding: '3px 5px',
                                                                    marginBottom: '2px',
                                                                    borderRadius: '3px',
                                                                    cursor: 'pointer',
                                                                    overflow: 'hidden',
                                                                    textOverflow: 'ellipsis',
                                                                    whiteSpace: 'nowrap'
                                                                }}
                                                                title={`${getVehicleName(booking.vehicleId)} - ${booking.customerName}`}
                                                            >
                                                                {getVehicleName(booking.vehicleId).substring(0, 15)}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>

                            {/* Legend */}
                            <div style={{ marginTop: '20px', display: 'flex', gap: '20px', flexWrap: 'wrap' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                    <div style={{ width: '20px', height: '20px', backgroundColor: 'var(--success)', borderRadius: '3px' }}></div>
                                    <span style={{ fontSize: '12px' }}>Active</span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                    <div style={{ width: '20px', height: '20px', backgroundColor: 'var(--warning)', borderRadius: '3px' }}></div>
                                    <span style={{ fontSize: '12px' }}>Pending</span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                    <div style={{ width: '20px', height: '20px', backgroundColor: 'var(--primary-teal)', borderRadius: '3px' }}></div>
                                    <span style={{ fontSize: '12px' }}>Completed</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Booking Details Modal */}
                    {selectedBooking && (
                        <div className="modal-overlay" onClick={() => setSelectedBooking(null)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '600px' }}>
                                <div className="modal-header">
                                    <h3>Booking Details</h3>
                                    <button className="close-btn" onClick={() => setSelectedBooking(null)}>√ó</button>
                                </div>
                                <div style={{ padding: '20px' }}>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>Booking ID:</strong> #{selectedBooking.id}
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>Vehicle:</strong> {getVehicleName(selectedBooking.vehicleId)}
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>Customer:</strong> {selectedBooking.customerName}
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>Start Date:</strong> {new Date(selectedBooking.startDate).toLocaleDateString()}
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>End Date:</strong> {new Date(selectedBooking.endDate).toLocaleDateString()}
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>Total Amount:</strong> N$ {selectedBooking.totalAmount}
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>Status:</strong>{' '}
                                        <span className={`badge badge-${selectedBooking.status}`}>
                                            {selectedBooking.status}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Contracts Component with E-Signature
        function Contracts({ contracts, setContracts, bookings, customers, showToast }) {
            const [showModal, setShowModal] = useState(false);
            const [selectedContract, setSelectedContract] = useState(null);
            const [showSignModal, setShowSignModal] = useState(false);
            const signaturePadRef = useRef(null);
            const canvasRef = useRef(null);

            useEffect(() => {
                if (showSignModal && canvasRef.current && !signaturePadRef.current) {
                    signaturePadRef.current = new SignaturePad(canvasRef.current, {
                        backgroundColor: 'rgb(255, 255, 255)',
                        penColor: 'rgb(0, 0, 0)'
                    });
                }
            }, [showSignModal]);

            const createContract = (booking) => {
                const contract = {
                    id: Date.now(),
                    bookingId: booking.id,
                    customerName: booking.customerName,
                    vehicleName: bookings.find(b => b.id === booking.id)?.vehicleName || 'N/A',
                    startDate: booking.startDate,
                    endDate: booking.endDate,
                    totalAmount: booking.totalAmount,
                    terms: `1. The vehicle must be returned in the same condition as received.
2. Customer is responsible for any damages during the rental period.
3. Late returns will incur additional charges at N$500 per day.
4. Insurance coverage is included up to N$50,000.
5. Customer must maintain valid driver's license throughout rental period.
6. Vehicle must not be used for illegal activities.
7. Fuel tank must be returned full or refueling charges apply.
8. No smoking in the vehicle.
9. Maximum mileage: 200km per day (additional charges apply).
10. Customer accepts full responsibility for traffic violations.`,
                    status: 'pending', // pending, signed, active, completed
                    createdDate: new Date().toISOString(),
                    signature: null,
                    signedDate: null
                };
                setContracts([...contracts, contract]);
                showToast('success', 'Contract Created', 'Rental contract has been generated');
            };

            const signContract = () => {
                if (signaturePadRef.current && !signaturePadRef.current.isEmpty()) {
                    const signatureData = signaturePadRef.current.toDataURL();
                    const updatedContracts = contracts.map(c =>
                        c.id === selectedContract.id
                            ? { ...c, signature: signatureData, signedDate: new Date().toISOString(), status: 'signed' }
                            : c
                    );
                    setContracts(updatedContracts);
                    setShowSignModal(false);
                    setSelectedContract(null);
                    showToast('success', 'Contract Signed', 'Contract has been digitally signed');
                } else {
                    alert('Please provide your signature');
                }
            };

            const clearSignature = () => {
                if (signaturePadRef.current) {
                    signaturePadRef.current.clear();
                }
            };

            const deleteContract = (id) => {
                if (confirm('Are you sure you want to delete this contract?')) {
                    setContracts(contracts.filter(c => c.id !== id));
                    showToast('info', 'Contract Deleted', 'Contract has been removed');
                }
            };

            const exportContractPDF = (contract) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Header
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('VEHICLE RENTAL CONTRACT', 105, 20, { align: 'center' });

                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('KETU KAKAHALA TRADING ENTERPRISES CC', 105, 30, { align: 'center' });
                doc.setFont(undefined, 'normal');
                doc.text('PO Box 286, Okahandja', 105, 36, { align: 'center' });

                // Contract Details
                let y = 50;
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('Contract ID:', 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(`#${contract.id}`, 60, y);
                y += 6;

                doc.setFont(undefined, 'bold');
                doc.text('Date Created:', 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(new Date(contract.createdDate).toLocaleDateString(), 60, y);
                y += 10;

                doc.setFont(undefined, 'bold');
                doc.text('Customer:', 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(contract.customerName, 60, y);
                y += 6;

                doc.setFont(undefined, 'bold');
                doc.text('Vehicle:', 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(contract.vehicleName, 60, y);
                y += 6;

                doc.setFont(undefined, 'bold');
                doc.text('Rental Period:', 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(`${new Date(contract.startDate).toLocaleDateString()} - ${new Date(contract.endDate).toLocaleDateString()}`, 60, y);
                y += 6;

                doc.setFont(undefined, 'bold');
                doc.text('Total Amount:', 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(`N$ ${contract.totalAmount}`, 60, y);
                y += 15;

                // Terms and Conditions
                doc.setFont(undefined, 'bold');
                doc.text('TERMS AND CONDITIONS:', 20, y);
                y += 7;

                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                const terms = contract.terms.split('\n');
                terms.forEach(term => {
                    const lines = doc.splitTextToSize(term, 170);
                    lines.forEach(line => {
                        if (y > 270) {
                            doc.addPage();
                            y = 20;
                        }
                        doc.text(line, 20, y);
                        y += 5;
                    });
                });

                // Signature
                if (contract.signature) {
                    y += 10;
                    if (y > 220) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.setFont(undefined, 'bold');
                    doc.text('Customer Signature:', 20, y);
                    y += 5;
                    doc.addImage(contract.signature, 'PNG', 20, y, 60, 20);
                    y += 25;
                    doc.setFont(undefined, 'normal');
                    doc.text(`Signed on: ${new Date(contract.signedDate).toLocaleString()}`, 20, y);
                }

                doc.save(`Contract-${contract.id}.pdf`);
            };

            return (
                <div>
                    <div className="header">
                        <h2>‚úçÔ∏è Digital Contracts</h2>
                        <p>Manage rental contracts with e-signature support</p>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <h3>Contracts ({contracts.length})</h3>
                            <button
                                className="btn btn-primary"
                                onClick={() => setShowModal(true)}
                            >
                                ‚ûï Create New Contract
                            </button>
                        </div>

                        {contracts.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">‚úçÔ∏è</div>
                                <p>No contracts found</p>
                                <p style={{ fontSize: '14px', marginTop: '10px' }}>Create contracts for your bookings</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Contract ID</th>
                                        <th>Customer</th>
                                        <th>Vehicle</th>
                                        <th>Rental Period</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {contracts.map(contract => (
                                        <tr key={contract.id}>
                                            <td>#{contract.id}</td>
                                            <td>{contract.customerName}</td>
                                            <td>{contract.vehicleName}</td>
                                            <td>
                                                {new Date(contract.startDate).toLocaleDateString()} -{' '}
                                                {new Date(contract.endDate).toLocaleDateString()}
                                            </td>
                                            <td>N$ {contract.totalAmount}</td>
                                            <td>
                                                <span className={`badge badge-${
                                                    contract.status === 'signed' ? 'active' :
                                                    contract.status === 'pending' ? 'rented' :
                                                    'available'
                                                }`}>
                                                    {contract.status}
                                                </span>
                                            </td>
                                            <td>
                                                <div style={{ display: 'flex', gap: '8px' }}>
                                                    {contract.status === 'pending' && (
                                                        <button
                                                            className="btn btn-primary"
                                                            style={{ padding: '8px 12px', fontSize: '12px' }}
                                                            onClick={() => {
                                                                setSelectedContract(contract);
                                                                setShowSignModal(true);
                                                            }}
                                                        >
                                                            ‚úçÔ∏è Sign
                                                        </button>
                                                    )}
                                                    <button
                                                        className="btn btn-primary"
                                                        style={{ padding: '8px 12px', fontSize: '12px' }}
                                                        onClick={() => exportContractPDF(contract)}
                                                    >
                                                        üìÑ PDF
                                                    </button>
                                                    <button
                                                        className="btn btn-danger"
                                                        style={{ padding: '8px 12px', fontSize: '12px' }}
                                                        onClick={() => deleteContract(contract.id)}
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {/* Create Contract Modal */}
                    {showModal && (
                        <div className="modal-overlay" onClick={() => setShowModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>Create New Contract</h3>
                                    <button className="close-btn" onClick={() => setShowModal(false)}>√ó</button>
                                </div>
                                <div style={{ padding: '20px' }}>
                                    <p style={{ marginBottom: '15px' }}>Select a booking to create a contract:</p>
                                    <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                                        {bookings.filter(b => b.status !== 'cancelled').map(booking => (
                                            <div
                                                key={booking.id}
                                                onClick={() => {
                                                    createContract(booking);
                                                    setShowModal(false);
                                                }}
                                                style={{
                                                    padding: '15px',
                                                    border: '1px solid #ddd',
                                                    borderRadius: '8px',
                                                    marginBottom: '10px',
                                                    cursor: 'pointer',
                                                    transition: 'all 0.2s'
                                                }}
                                                onMouseEnter={(e) => {
                                                    e.currentTarget.style.backgroundColor = 'var(--light-teal)';
                                                    e.currentTarget.style.borderColor = 'var(--primary-teal)';
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.backgroundColor = 'white';
                                                    e.currentTarget.style.borderColor = '#ddd';
                                                }}
                                            >
                                                <div><strong>Booking #{booking.id}</strong></div>
                                                <div>Customer: {booking.customerName}</div>
                                                <div>Vehicle: {booking.vehicleName}</div>
                                                <div>Amount: N$ {booking.totalAmount}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* E-Signature Modal */}
                    {showSignModal && selectedContract && (
                        <div className="modal-overlay" onClick={() => setShowSignModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '600px' }}>
                                <div className="modal-header">
                                    <h3>Sign Contract #{selectedContract.id}</h3>
                                    <button className="close-btn" onClick={() => setShowSignModal(false)}>√ó</button>
                                </div>
                                <div style={{ padding: '20px' }}>
                                    <p style={{ marginBottom: '15px' }}>
                                        Please sign below to accept the terms and conditions:
                                    </p>
                                    <div style={{
                                        border: '2px solid var(--primary-teal)',
                                        borderRadius: '8px',
                                        marginBottom: '15px'
                                    }}>
                                        <canvas
                                            ref={canvasRef}
                                            width={540}
                                            height={200}
                                            style={{ display: 'block', cursor: 'crosshair' }}
                                        />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>
                                        <button
                                            className="btn btn-secondary"
                                            onClick={clearSignature}
                                        >
                                            Clear
                                        </button>
                                        <button
                                            className="btn btn-primary"
                                            onClick={signContract}
                                        >
                                            Confirm Signature
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Customer Portal Component
        function CustomerPortal({ customers, bookings, payments, vehicles, showToast }) {
            const [selectedCustomer, setSelectedCustomer] = useState(null);
            const [loginEmail, setLoginEmail] = useState('');
            const [isLoggedIn, setIsLoggedIn] = useState(false);

            const handleLogin = () => {
                const customer = customers.find(c => c.email.toLowerCase() === loginEmail.toLowerCase());
                if (customer) {
                    setSelectedCustomer(customer);
                    setIsLoggedIn(true);
                    showToast('success', 'Login Successful', `Welcome back, ${customer.name}!`);
                } else {
                    showToast('error', 'Login Failed', 'Customer not found. Please check your email.');
                }
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setSelectedCustomer(null);
                setLoginEmail('');
            };

            const getCustomerBookings = () => {
                if (!selectedCustomer) return [];
                return bookings.filter(b =>
                    b.customerEmail === selectedCustomer.email ||
                    b.customerName === selectedCustomer.name
                );
            };

            const getCustomerPayments = () => {
                if (!selectedCustomer) return [];
                const customerBookingIds = getCustomerBookings().map(b => b.id);
                return payments.filter(p => customerBookingIds.includes(p.bookingId));
            };

            const totalSpent = getCustomerPayments().reduce((sum, p) => sum + parseFloat(p.amount || 0), 0);

            if (!isLoggedIn) {
                return (
                    <div>
                        <div className="header">
                            <h2>üåê Customer Portal</h2>
                            <p>Self-service portal for customers</p>
                        </div>

                        <div className="card" style={{ maxWidth: '500px', margin: '50px auto', padding: '40px' }}>
                            <h2 style={{ textAlign: 'center', marginBottom: '30px', color: 'var(--primary-teal)' }}>
                                Customer Login
                            </h2>
                            <div className="form-group">
                                <label>Email Address</label>
                                <input
                                    type="email"
                                    className="form-control"
                                    placeholder="Enter your email"
                                    value={loginEmail}
                                    onChange={(e) => setLoginEmail(e.target.value)}
                                    onKeyPress={(e) => {
                                        if (e.key === 'Enter') handleLogin();
                                    }}
                                />
                            </div>
                            <button
                                className="btn btn-primary"
                                onClick={handleLogin}
                                style={{ width: '100%', padding: '12px' }}
                            >
                                Login to Portal
                            </button>
                            <p style={{ textAlign: 'center', marginTop: '20px', fontSize: '14px', color: 'var(--text-light)' }}>
                                Enter the email address associated with your bookings
                            </p>
                        </div>
                    </div>
                );
            }

            const customerBookings = getCustomerBookings();
            const activeBookings = customerBookings.filter(b => b.status === 'active');
            const upcomingBookings = customerBookings.filter(b => b.status === 'pending');

            return (
                <div>
                    <div className="header">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div>
                                <h2>Welcome, {selectedCustomer.name}!</h2>
                                <p>Manage your bookings and view rental history</p>
                            </div>
                            <button
                                className="btn btn-secondary"
                                onClick={handleLogout}
                            >
                                Logout
                            </button>
                        </div>
                    </div>

                    {/* Summary Cards */}
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                        gap: '20px',
                        marginBottom: '30px'
                    }}>
                        <div className="card" style={{ padding: '20px', textAlign: 'center' }}>
                            <div style={{ fontSize: '32px', marginBottom: '10px' }}>üìÖ</div>
                            <h3 style={{ fontSize: '24px', color: 'var(--primary-teal)' }}>
                                {customerBookings.length}
                            </h3>
                            <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Total Bookings</p>
                        </div>
                        <div className="card" style={{ padding: '20px', textAlign: 'center' }}>
                            <div style={{ fontSize: '32px', marginBottom: '10px' }}>‚ö°</div>
                            <h3 style={{ fontSize: '24px', color: 'var(--primary-orange)' }}>
                                {activeBookings.length}
                            </h3>
                            <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Active Rentals</p>
                        </div>
                        <div className="card" style={{ padding: '20px', textAlign: 'center' }}>
                            <div style={{ fontSize: '32px', marginBottom: '10px' }}>‚è∞</div>
                            <h3 style={{ fontSize: '24px', color: 'var(--success)' }}>
                                {upcomingBookings.length}
                            </h3>
                            <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Upcoming</p>
                        </div>
                        <div className="card" style={{ padding: '20px', textAlign: 'center' }}>
                            <div style={{ fontSize: '32px', marginBottom: '10px' }}>üí∞</div>
                            <h3 style={{ fontSize: '24px', color: 'var(--warning)' }}>
                                N$ {totalSpent.toLocaleString()}
                            </h3>
                            <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Total Spent</p>
                        </div>
                    </div>

                    {/* Bookings List */}
                    <div className="card">
                        <div style={{ padding: '20px', borderBottom: '1px solid #eee' }}>
                            <h3>My Bookings</h3>
                        </div>
                        {customerBookings.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üìÖ</div>
                                <p>No bookings found</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Booking ID</th>
                                        <th>Vehicle</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {customerBookings.map(booking => (
                                        <tr key={booking.id}>
                                            <td>#{booking.id}</td>
                                            <td>{booking.vehicleName}</td>
                                            <td>{new Date(booking.startDate).toLocaleDateString()}</td>
                                            <td>{new Date(booking.endDate).toLocaleDateString()}</td>
                                            <td>N$ {booking.totalAmount}</td>
                                            <td>
                                                <span className={`badge badge-${booking.status}`}>
                                                    {booking.status}
                                                </span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ vehicles, bookings, customers, payments, transfers }) {
            const availableVehicles = vehicles.filter(v => v.status === 'available').length;
            const activeBookings = bookings.filter(b => b.status === 'active').length;
            const totalRevenue = payments.reduce((sum, p) => sum + parseFloat(p.amount || 0), 0);
            const upcomingBookings = bookings.filter(b =>
                new Date(b.startDate) > new Date() && b.status === 'active'
            ).length;
            const activeTransfers = transfers.filter(t => t.status === 'confirmed' || t.status === 'pending').length;

            // Calculate available vehicles by class for today
            const getAvailableByClass = () => {
                const classSummary = {};
                VEHICLE_CLASSES.forEach(cls => {
                    classSummary[cls] = vehicles.filter(v => 
                        v.vehicleClass === cls && v.status === 'available'
                    ).length;
                });
                return classSummary;
            };

            const availableByClass = getAvailableByClass();
            const totalAvailableToday = Object.values(availableByClass).reduce((sum, count) => sum + count, 0);

            // Generate mock availability data for the chart (last 30 days)
            const generateAvailabilityChartData = () => {
                const data = [];
                const today = new Date();
                for (let i = 29; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    
                    const dayData = { date: dateStr };
                    VEHICLE_CLASSES.forEach(cls => {
                        const vehiclesInClass = vehicles.filter(v => v.vehicleClass === cls);
                        // Simulate availability - in real app, this would come from booking history
                        dayData[cls] = vehiclesInClass.filter(v => v.status === 'available').length;
                    });
                    data.push(dayData);
                }
                return data;
            };

            const chartData = generateAvailabilityChartData();

            return (
                <div>
                    <div className="header">
                        <h2>Dashboard</h2>
                        <p>Welcome back! Here's your business overview for {new Date().toLocaleDateString()}</p>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <h3>Available Vehicles</h3>
                            <p>{availableVehicles}</p>
                        </div>
                        <div className="stat-card orange">
                            <h3>Active Bookings</h3>
                            <p>{activeBookings}</p>
                        </div>
                        <div className="stat-card">
                            <h3>Active Transfers</h3>
                            <p>{activeTransfers}</p>
                        </div>
                        <div className="stat-card orange">
                            <h3>Total Customers</h3>
                            <p>{customers.length}</p>
                        </div>
                        <div className="stat-card">
                            <h3>Total Revenue</h3>
                            <p>N${totalRevenue.toFixed(2)}</p>
                        </div>
                    </div>

                    {/* Available Vehicles for Today */}
                    <div className="card">
                        <div className="card-title">Available Vehicles for Today</div>
                        <table className="table">
                            <thead>
                                <tr>
                                    <th>Vehicle Class</th>
                                    <th>Available</th>
                                </tr>
                            </thead>
                            <tbody>
                                {VEHICLE_CLASSES.map(cls => (
                                    <tr key={cls}>
                                        <td>{cls}</td>
                                        <td><strong>{availableByClass[cls] || 0}</strong></td>
                                    </tr>
                                ))}
                                <tr style={{backgroundColor: '#f0f0f0', fontWeight: 'bold'}}>
                                    <td>Total</td>
                                    <td><strong>{totalAvailableToday}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    {/* Classes Availability Chart */}
                    <div className="card">
                        <div className="card-title">Classes Availability (Last 30 Days)</div>
                        <div style={{padding: '20px', backgroundColor: '#f9f9f9', borderRadius: '8px', minHeight: '300px'}}>
                            <AvailabilityChart data={chartData} classes={VEHICLE_CLASSES} />
                        </div>
                    </div>

                    <div className="card">
                        <div className="card-title">Recent Bookings</div>
                        {bookings.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üìÖ</div>
                                <p>No bookings yet</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Booking ID</th>
                                        <th>Customer</th>
                                        <th>Vehicle</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {bookings.slice(0, 5).map(booking => (
                                        <tr key={booking.id}>
                                            <td>#{booking.id}</td>
                                            <td>{booking.customerName}</td>
                                            <td>{booking.vehicleName}</td>
                                            <td>{new Date(booking.startDate).toLocaleDateString()}</td>
                                            <td>{new Date(booking.endDate).toLocaleDateString()}</td>
                                            <td>
                                                <span className={`badge badge-${booking.status}`}>
                                                    {booking.status}
                                                </span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    <div className="card">
                        <div className="card-title">Recent Transfers</div>
                        {transfers.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üöê</div>
                                <p>No transfers yet</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Confirmation #</th>
                                        <th>Customer</th>
                                        <th>Pickup Location</th>
                                        <th>Dropoff Location</th>
                                        <th>Date & Time</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {transfers.slice(0, 5).map(transfer => (
                                        <tr key={transfer.id}>
                                            <td>{transfer.confirmationNumber}</td>
                                            <td>{transfer.customerName}</td>
                                            <td>{transfer.pickupLocation}</td>
                                            <td>{transfer.dropoffLocation}</td>
                                            <td>{new Date(transfer.pickupDate).toLocaleDateString()} {transfer.pickupTime}</td>
                                            <td>
                                                <span className={`badge badge-${transfer.status === 'confirmed' ? 'active' : transfer.status === 'completed' ? 'completed' : transfer.status === 'cancelled' ? 'maintenance' : 'rented'}`}>
                                                    {transfer.status}
                                                </span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>
                </div>
            );
        }

        // Availability Chart Component
        function AvailabilityChart({ data, classes }) {
            const colors = {
                'Economic Manual': '#4CAF50',
                'Economic Automatic': '#2196F3',
                'Premium': '#FF9800',
                'SUV': '#9C27B0',
                'Luxury': '#F44336',
                'Van': '#00BCD4'
            };

            if (data.length === 0) {
                return <div style={{textAlign: 'center', padding: '40px', color: '#999'}}>No data available</div>;
            }

            return (
                <div style={{position: 'relative'}}>
                    <svg width="100%" height="300" viewBox="0 0 1200 300" style={{overflow: 'visible'}}>
                        {/* Y-axis */}
                        <line x1="50" y1="20" x2="50" y2="260" stroke="#ddd" strokeWidth="2"/>
                        {/* X-axis */}
                        <line x1="50" y1="260" x2="1150" y2="260" stroke="#ddd" strokeWidth="2"/>
                        
                        {/* Y-axis labels */}
                        {[0, 1, 2, 3, 4, 5, 6].map(i => (
                            <text key={i} x="35" y={260 - (i * 40)} fontSize="12" fill="#666" textAnchor="end">{i}</text>
                        ))}

                        {/* Grid lines */}
                        {[1, 2, 3, 4, 5, 6].map(i => (
                            <line key={i} x1="50" y1={260 - (i * 40)} x2="1150" y2={260 - (i * 40)} 
                                stroke="#f0f0f0" strokeWidth="1"/>
                        ))}

                        {/* Plot lines for each class */}
                        {classes.map((cls, classIndex) => {
                            const points = data.map((d, i) => {
                                const x = 50 + (i * (1100 / (data.length - 1)));
                                const y = 260 - ((d[cls] || 0) * 40);
                                return `${x},${y}`;
                            }).join(' ');

                            return (
                                <g key={cls}>
                                    <polyline
                                        points={points}
                                        fill="none"
                                        stroke={colors[cls]}
                                        strokeWidth="2"
                                    />
                                    {/* Data points */}
                                    {data.map((d, i) => {
                                        const x = 50 + (i * (1100 / (data.length - 1)));
                                        const y = 260 - ((d[cls] || 0) * 40);
                                        return (
                                            <circle
                                                key={i}
                                                cx={x}
                                                cy={y}
                                                r="4"
                                                fill={colors[cls]}
                                            />
                                        );
                                    })}
                                </g>
                            );
                        })}

                        {/* X-axis labels (showing every 5th date) */}
                        {data.map((d, i) => {
                            if (i % 5 === 0 || i === data.length - 1) {
                                const x = 50 + (i * (1100 / (data.length - 1)));
                                return (
                                    <text key={i} x={x} y="280" fontSize="10" fill="#666" textAnchor="middle">
                                        {d.date}
                                    </text>
                                );
                            }
                            return null;
                        })}
                    </svg>

                    {/* Legend */}
                    <div style={{display: 'flex', justifyContent: 'center', flexWrap: 'wrap', marginTop: '20px', gap: '20px'}}>
                        {classes.map(cls => (
                            <div key={cls} style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                <div style={{
                                    width: '20px',
                                    height: '3px',
                                    backgroundColor: colors[cls]
                                }}></div>
                                <span style={{fontSize: '12px', color: '#666'}}>{cls}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Vehicles Component
        function Vehicles({ vehicles, setVehicles, bookings }) {
            const [showModal, setShowModal] = useState(false);
            const [editingVehicle, setEditingVehicle] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');

            const filteredVehicles = vehicles.filter(v => 
                v.make.toLowerCase().includes(searchTerm.toLowerCase()) ||
                v.model.toLowerCase().includes(searchTerm.toLowerCase()) ||
                v.licensePlate.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const addVehicle = (vehicle) => {
                if (editingVehicle) {
                    setVehicles(vehicles.map(v => v.id === editingVehicle.id ? vehicle : v));
                } else {
                    setVehicles([...vehicles, { ...vehicle, id: Date.now() }]);
                }
                setShowModal(false);
                setEditingVehicle(null);
            };

            const deleteVehicle = (id) => {
                if (confirm('Are you sure you want to delete this vehicle?')) {
                    setVehicles(vehicles.filter(v => v.id !== id));
                }
            };

            return (
                <div>
                    <div className="header">
                        <h2>Vehicle Management</h2>
                        <p>Manage your fleet inventory</p>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Search vehicles..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button 
                                className="btn btn-primary"
                                onClick={() => {
                                    setEditingVehicle(null);
                                    setShowModal(true);
                                }}
                            >
                                ‚ûï Add Vehicle
                            </button>
                        </div>

                        {filteredVehicles.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üöó</div>
                                <p>No vehicles found</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Make & Model</th>
                                        <th>Class</th>
                                        <th>License Plate</th>
                                        <th>Year</th>
                                        <th>Daily Rate</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredVehicles.map(vehicle => (
                                        <tr key={vehicle.id}>
                                            <td>{vehicle.make} {vehicle.model}</td>
                                            <td>{vehicle.vehicleClass || 'N/A'}</td>
                                            <td>{vehicle.licensePlate}</td>
                                            <td>{vehicle.year}</td>
                                            <td>N${vehicle.dailyRate}</td>
                                            <td>
                                                <span className={`badge badge-${vehicle.status}`}>
                                                    {vehicle.status}
                                                </span>
                                            </td>
                                            <td>
                                                <button 
                                                    className="btn btn-primary"
                                                    style={{marginRight: '10px', padding: '8px 16px'}}
                                                    onClick={() => {
                                                        setEditingVehicle(vehicle);
                                                        setShowModal(true);
                                                    }}
                                                >
                                                    ‚úèÔ∏è Edit
                                                </button>
                                                <button 
                                                    className="btn btn-danger"
                                                    style={{padding: '8px 16px'}}
                                                    onClick={() => deleteVehicle(vehicle.id)}
                                                >
                                                    üóëÔ∏è Delete
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {showModal && (
                        <VehicleModal 
                            vehicle={editingVehicle}
                            onSave={addVehicle}
                            onClose={() => {
                                setShowModal(false);
                                setEditingVehicle(null);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Vehicle Modal Component
        function VehicleModal({ vehicle, onSave, onClose }) {
            const [formData, setFormData] = useState(vehicle || {
                make: '',
                model: '',
                year: new Date().getFullYear(),
                licensePlate: '',
                dailyRate: '',
                status: 'available',
                color: '',
                mileage: '',
                vehicleClass: 'Economic Manual'
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h3>{vehicle ? 'Edit Vehicle' : 'Add New Vehicle'}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Make</label>
                                    <input 
                                        type="text"
                                        className="form-control"
                                        value={formData.make}
                                        onChange={(e) => setFormData({...formData, make: e.target.value})}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Model</label>
                                    <input 
                                        type="text"
                                        className="form-control"
                                        value={formData.model}
                                        onChange={(e) => setFormData({...formData, model: e.target.value})}
                                        required
                                    />
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Vehicle Class</label>
                                    <select 
                                        className="form-control"
                                        value={formData.vehicleClass}
                                        onChange={(e) => setFormData({...formData, vehicleClass: e.target.value})}
                                    >
                                        {VEHICLE_CLASSES.map(cls => (
                                            <option key={cls} value={cls}>{cls}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Year</label>
                                    <input 
                                        type="number"
                                        className="form-control"
                                        value={formData.year}
                                        onChange={(e) => setFormData({...formData, year: e.target.value})}
                                        required
                                    />
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>License Plate</label>
                                    <input 
                                        type="text"
                                        className="form-control"
                                        value={formData.licensePlate}
                                        onChange={(e) => setFormData({...formData, licensePlate: e.target.value})}
                                        required
                                    />
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Color</label>
                                    <input 
                                        type="text"
                                        className="form-control"
                                        value={formData.color}
                                        onChange={(e) => setFormData({...formData, color: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Mileage</label>
                                    <input 
                                        type="number"
                                        className="form-control"
                                        value={formData.mileage}
                                        onChange={(e) => setFormData({...formData, mileage: e.target.value})}
                                    />
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Daily Rate ($)</label>
                                    <input 
                                        type="number"
                                        className="form-control"
                                        value={formData.dailyRate}
                                        onChange={(e) => setFormData({...formData, dailyRate: e.target.value})}
                                        required
                                        step="0.01"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Status</label>
                                    <select 
                                        className="form-control"
                                        value={formData.status}
                                        onChange={(e) => setFormData({...formData, status: e.target.value})}
                                    >
                                        <option value="available">Available</option>
                                        <option value="rented">Rented</option>
                                        <option value="maintenance">Maintenance</option>
                                    </select>
                                </div>
                            </div>
                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save Vehicle
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Bookings/Reservations Component
        function Bookings({ bookings, setBookings, vehicles, customers, showToast, sendNotification }) {
            const [showModal, setShowModal] = useState(false);
            const [editingBooking, setEditingBooking] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterStatus, setFilterStatus] = useState('all');
            const [showAvailabilityCheck, setShowAvailabilityCheck] = useState(false);

            const statusFilters = [
                { id: 'all', label: 'All' },
                { id: 'today-returns', label: "Today's Returns" },
                { id: 'tomorrow-pickups', label: "Tomorrow's Pickups" },
                { id: 'today-pickups', label: "Today's Pickups" },
                { id: 'tomorrow-returns', label: "Tomorrow's Returns" },
                { id: 'on-rent', label: 'On Rent' },
                { id: 'completed', label: 'Completed' },
                { id: 'cancelled', label: 'Cancelled' },
                { id: 'outstanding-payment', label: 'Outstanding Payment' }
            ];

            const getFilteredBookings = () => {
                let filtered = bookings;
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);

                switch(filterStatus) {
                    case 'today-returns':
                        filtered = bookings.filter(b => {
                            const endDate = new Date(b.endDate);
                            endDate.setHours(0, 0, 0, 0);
                            return endDate.getTime() === today.getTime();
                        });
                        break;
                    case 'tomorrow-pickups':
                        filtered = bookings.filter(b => {
                            const startDate = new Date(b.startDate);
                            startDate.setHours(0, 0, 0, 0);
                            return startDate.getTime() === tomorrow.getTime();
                        });
                        break;
                    case 'today-pickups':
                        filtered = bookings.filter(b => {
                            const startDate = new Date(b.startDate);
                            startDate.setHours(0, 0, 0, 0);
                            return startDate.getTime() === today.getTime();
                        });
                        break;
                    case 'tomorrow-returns':
                        filtered = bookings.filter(b => {
                            const endDate = new Date(b.endDate);
                            endDate.setHours(0, 0, 0, 0);
                            return endDate.getTime() === tomorrow.getTime();
                        });
                        break;
                    case 'on-rent':
                        filtered = bookings.filter(b => b.status === 'active');
                        break;
                    case 'completed':
                        filtered = bookings.filter(b => b.status === 'completed');
                        break;
                    case 'cancelled':
                        filtered = bookings.filter(b => b.status === 'cancelled');
                        break;
                    case 'outstanding-payment':
                        filtered = bookings.filter(b => b.outstandingBalance && parseFloat(b.outstandingBalance) > 0);
                        break;
                }

                if (searchTerm) {
                    filtered = filtered.filter(b => 
                        b.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        b.vehicleName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        b.id.toString().includes(searchTerm)
                    );
                }

                return filtered;
            };

            const filteredBookings = getFilteredBookings();

            // Calculate totals
            const totals = filteredBookings.reduce((acc, b) => ({
                totalPrice: acc.totalPrice + parseFloat(b.totalAmount || 0),
                totalRevenue: acc.totalRevenue + parseFloat(b.totalRevenue || b.totalAmount || 0),
                totalPaid: acc.totalPaid + parseFloat(b.totalPaid || 0),
                totalRefunded: acc.totalRefunded + parseFloat(b.totalRefunded || 0),
                outstandingBalance: acc.outstandingBalance + parseFloat(b.outstandingBalance || 0),
                totalDays: acc.totalDays + (b.totalDays || 0)
            }), { totalPrice: 0, totalRevenue: 0, totalPaid: 0, totalRefunded: 0, outstandingBalance: 0, totalDays: 0 });

            const addBooking = (booking) => {
                if (editingBooking) {
                    setBookings(bookings.map(b => b.id === editingBooking.id ? booking : b));
                    if (showToast) showToast('success', 'Booking Updated', `Reservation #${editingBooking.id} has been updated successfully.`);
                } else {
                    const newBooking = { ...booking, id: Date.now() };
                    setBookings([...bookings, newBooking]);
                    if (showToast) showToast('success', 'Booking Created', `New reservation #${newBooking.id} for ${booking.customerName} has been created.`);

                    // Send booking confirmation notification
                    if (sendNotification) {
                        const confirmationMessage = `Dear ${booking.customerName},\n\nYour vehicle reservation has been confirmed!\n\nBooking Details:\n- Booking ID: #${newBooking.id}\n- Vehicle: ${booking.vehicleName}\n- Pickup Date: ${new Date(booking.startDate).toLocaleDateString()}\n- Return Date: ${new Date(booking.endDate).toLocaleDateString()}\n- Total Amount: N$${booking.totalAmount}\n\nPlease bring your driver's license and payment confirmation on pickup day.\n\nThank you for choosing Ketu Kakahala!\n\nBest regards,\nKetu Kakahala Vehicle Rentals`;

                        sendNotification(
                            'both',
                            { name: booking.customerName, email: booking.customerEmail, phone: booking.customerPhone },
                            'Booking Confirmation',
                            confirmationMessage,
                            newBooking.id
                        );
                    }
                }
                setShowModal(false);
                setEditingBooking(null);
            };

            const deleteBooking = (id) => {
                if (confirm('Are you sure you want to delete this reservation?')) {
                    setBookings(bookings.filter(b => b.id !== id));
                    if (showToast) showToast('success', 'Booking Deleted', 'The reservation has been deleted.');
                }
            };

            const generateRentalAgreement = (booking) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let y = 15;
                const leftMargin = 15;
                const pageWidth = 210;
                
                // Add logo at the top
                doc.addImage(KETU_LOGO, 'JPEG', pageWidth/2 - 40, y, 80, 20);
                y += 25;
                
                doc.setFontSize(18);
                doc.setTextColor(26, 122, 138);
                doc.setFont(undefined, 'bold');
                doc.text('VEHICLE RENTAL AGREEMENT', pageWidth/2, y, { align: 'center' });
                
                y += 5;
                doc.setFontSize(9);
                doc.setFont(undefined, 'italic');
                doc.setTextColor(0, 0, 0);
                doc.text('IMPORTANT: Read this agreement carefully before signing', pageWidth/2, y, { align: 'center' });
                
                y += 10;
                doc.setDrawColor(255, 140, 66);
                doc.setLineWidth(0.5);
                doc.line(leftMargin, y, pageWidth - leftMargin, y);
                y += 8;
                
                // Agreement Number and Date
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.text(`Agreement Number: ${booking.id}`, leftMargin, y);
                doc.text(`Date: ${new Date().toLocaleDateString()}`, pageWidth - 60, y);
                y += 10;
                
                // 1. PARTIES TO THIS AGREEMENT
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.text('1. PARTIES TO THIS AGREEMENT', leftMargin, y);
                y += 7;
                
                doc.setFontSize(10);
                doc.text('1.1 VEHICLE OWNER (Lessor)', leftMargin, y);
                y += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                doc.text(`Full Name: Ketu Kakahala Vehicle Rentals`, leftMargin + 5, y);
                y += 5;
                doc.text(`Contact Number: _______________________`, leftMargin + 5, y);
                y += 5;
                doc.text(`Email: _______________________`, leftMargin + 5, y);
                y += 8;
                
                doc.setFont(undefined, 'bold');
                doc.setFontSize(10);
                doc.text('1.2 RENTER (Lessee)', leftMargin, y);
                y += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                doc.text(`Full Name: ${booking.customerName}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Contact Number: ${booking.customerPhone || '_______________________'}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Email: ${booking.customerEmail || '_______________________'}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Driver's License Number: _______________________`, leftMargin + 5, y);
                y += 5;
                doc.text(`Emergency Contact: _______________________`, leftMargin + 5, y);
                y += 10;
                
                // 2. VEHICLE DETAILS
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.text('2. VEHICLE DETAILS', leftMargin, y);
                y += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                doc.text(`Make & Model: ${booking.vehicleName}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Registration Number: ${booking.licensePlate || '_______________________'}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Current Odometer Reading: _______________________ km`, leftMargin + 5, y);
                y += 10;
                
                // 3. RENTAL PERIOD AND PAYMENT
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.text('3. RENTAL PERIOD AND PAYMENT', leftMargin, y);
                y += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                doc.text(`Start Date & Time: ${new Date(booking.startDate).toLocaleDateString()} _______`, leftMargin + 5, y);
                y += 5;
                doc.text(`End Date & Time: ${new Date(booking.endDate).toLocaleDateString()} _______`, leftMargin + 5, y);
                y += 5;
                const days = Math.ceil((new Date(booking.endDate) - new Date(booking.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                doc.text(`Number of Rental Days: ${days}`, leftMargin + 5, y);
                y += 7;
                doc.setFont(undefined, 'bold');
                doc.text('RENTAL CHARGES:', leftMargin + 5, y);
                y += 5;
                doc.setFont(undefined, 'normal');
                doc.text(`Total Rental Cost: N$ ${booking.totalAmount}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Security Deposit: N$ _______________________`, leftMargin + 5, y);
                y += 5;
                doc.setFont(undefined, 'bold');
                doc.text(`TOTAL AMOUNT PAID: N$ ${booking.totalAmount}`, leftMargin + 5, y);
                y += 5;
                doc.setFont(undefined, 'normal');
                doc.text(`Payment Method: [ ] Cash  [ ] EFT  [ ] Card`, leftMargin + 5, y);
                
                doc.save(`Ketu-Rental-Agreement-${booking.id}.pdf`);
            };

            const generateInvoice = (booking) => {
                const { jsPDF} = window.jspdf;
                const doc = new jsPDF();

                let y = 15;
                const leftMargin = 15;
                const rightMargin = 195;
                const pageWidth = 210;

                // Company name (top left) - using text instead of logo to avoid errors
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(26, 122, 138);
                doc.text('KETU KAKAHALA', leftMargin, y);
                y += 6;
                doc.setFontSize(10);
                doc.text('Vehicle Rentals', leftMargin, y);

                // Company details (top right)
                y = 15;
                doc.setFontSize(9);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(100, 100, 100);
                doc.text('Windhoek, Namibia', rightMargin, y, { align: 'right' });
                y += 5;
                doc.text('Tel: +264 61 234 567', rightMargin, y, { align: 'right' });
                y += 5;
                doc.text('Email: info@ketukakahala.com', rightMargin, y, { align: 'right' });

                y = 45;

                // INVOICE title
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(26, 122, 138);
                doc.text('INVOICE', leftMargin, y);

                y += 10;

                // Invoice details box
                doc.setDrawColor(200, 200, 200);
                doc.setLineWidth(0.1);
                doc.rect(leftMargin, y, 85, 20);

                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('Invoice Number:', leftMargin + 3, y + 5);
                doc.text('Invoice Date:', leftMargin + 3, y + 10);
                doc.text('Due Date:', leftMargin + 3, y + 15);

                doc.setFont(undefined, 'normal');
                doc.text(`INV-${String(booking.id).padStart(5, '0')}`, leftMargin + 35, y + 5);
                doc.text(new Date().toLocaleDateString(), leftMargin + 35, y + 10);
                doc.text(new Date().toLocaleDateString(), leftMargin + 35, y + 15);

                y += 25;

                // Bill To section
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('BILL TO:', leftMargin, y);
                y += 6;
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text(booking.customerName, leftMargin, y);
                y += 5;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(8);
                if (booking.customerEmail) {
                    doc.text(`Email: ${booking.customerEmail}`, leftMargin, y);
                    y += 4;
                }
                if (booking.customerPhone) {
                    doc.text(`Phone: ${booking.customerPhone}`, leftMargin, y);
                    y += 4;
                }

                y += 10;

                // Table Header
                const tableTop = y;
                doc.setFillColor(26, 122, 138);
                doc.rect(leftMargin, y, rightMargin - leftMargin, 8, 'F');

                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text('Description', leftMargin + 2, y + 5);
                doc.text('Days', 120, y + 5);
                doc.text('Rate', 145, y + 5);
                doc.text('Amount', rightMargin - 2, y + 5, { align: 'right' });

                y += 8;

                // Table rows
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');

                // Rental line item
                doc.setFillColor(248, 248, 248);
                doc.rect(leftMargin, y, rightMargin - leftMargin, 10, 'F');

                doc.setFontSize(9);
                doc.text(`${booking.vehicleName} Rental`, leftMargin + 2, y + 6);
                const rentalDays = booking.totalDays || Math.ceil((new Date(booking.endDate) - new Date(booking.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                doc.text(String(rentalDays), 120, y + 6);
                const dailyRate = (booking.totalAmount / rentalDays).toFixed(2);
                doc.text(`N$${dailyRate}`, 145, y + 6);
                doc.text(`N$${parseFloat(booking.totalAmount).toFixed(2)}`, rightMargin - 2, y + 6, { align: 'right' });

                y += 10;
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text(`Rental Period: ${new Date(booking.startDate).toLocaleDateString()} - ${new Date(booking.endDate).toLocaleDateString()}`, leftMargin + 2, y + 3);
                doc.text(`License Plate: ${booking.licensePlate || 'N/A'}`, leftMargin + 2, y + 7);

                y += 15;

                // Totals section
                const totalsX = 130;
                doc.setDrawColor(200, 200, 200);
                doc.line(totalsX, y, rightMargin, y);
                y += 6;

                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                doc.text('Subtotal:', totalsX, y);
                doc.text(`N$${parseFloat(booking.totalAmount).toFixed(2)}`, rightMargin - 2, y, { align: 'right' });
                y += 6;

                const tax = parseFloat(booking.totalAmount) * 0.15; // 15% VAT
                doc.text('VAT (15%):', totalsX, y);
                doc.text(`N$${tax.toFixed(2)}`, rightMargin - 2, y, { align: 'right' });
                y += 2;

                doc.setLineWidth(0.5);
                doc.setDrawColor(26, 122, 138);
                doc.line(totalsX, y, rightMargin, y);
                y += 6;

                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.text('TOTAL:', totalsX, y);
                doc.text(`N$${(parseFloat(booking.totalAmount) + tax).toFixed(2)}`, rightMargin - 2, y, { align: 'right' });

                y += 10;

                const totalPaid = parseFloat(booking.totalPaid || 0);
                if (totalPaid > 0) {
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(9);
                    doc.text('Amount Paid:', totalsX, y);
                    doc.text(`N$${totalPaid.toFixed(2)}`, rightMargin - 2, y, { align: 'right' });
                    y += 6;

                    const balance = (parseFloat(booking.totalAmount) + tax) - totalPaid;
                    doc.setFont(undefined, 'bold');
                    if (balance > 0) {
                        doc.setTextColor(231, 76, 60); // Red for outstanding balance
                    } else {
                        doc.setTextColor(39, 174, 96); // Green for paid/credit
                    }
                    doc.text('Balance Due:', totalsX, y);
                    doc.text(`N$${balance.toFixed(2)}`, rightMargin - 2, y, { align: 'right' });
                }

                // Footer
                y = 270;
                doc.setDrawColor(255, 140, 66);
                doc.setLineWidth(0.5);
                doc.line(leftMargin, y, rightMargin, y);
                y += 5;

                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.setFont(undefined, 'italic');
                doc.text('Thank you for your business!', pageWidth/2, y, { align: 'center' });
                y += 4;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(7);
                doc.text('Payment terms: Payment is due upon receipt. Late payments may incur additional charges.', pageWidth/2, y, { align: 'center' });

                doc.save(`Ketu-Invoice-${String(booking.id).padStart(5, '0')}.pdf`);
                if (showToast) showToast('success', 'Invoice Generated', `Invoice #INV-${String(booking.id).padStart(5, '0')} has been downloaded.`);
            };

            // Get calendar data for the next 30 days
            const getCalendarData = () => {
                const today = new Date();
                const calendar = [];

                for (let i = 0; i < 30; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() + i);
                    date.setHours(0, 0, 0, 0);

                    const dateStr = date.toISOString().split('T')[0];
                    const dayBookings = bookings.filter(b => {
                        const start = new Date(b.startDate);
                        const end = new Date(b.endDate);
                        start.setHours(0, 0, 0, 0);
                        end.setHours(0, 0, 0, 0);
                        return date >= start && date <= end && b.status === 'active';
                    });

                    const availableCount = vehicles.filter(v => {
                        if (v.status !== 'available') return false;
                        // Check if vehicle is booked on this date
                        const isBooked = dayBookings.some(b => {
                            return b.vehicleId === v.id || b.vehicleName === `${v.make} ${v.model}`;
                        });
                        return !isBooked;
                    }).length;

                    calendar.push({
                        date: dateStr,
                        dayName: date.toLocaleDateString('en-US', { weekday: 'short' }),
                        dayNum: date.getDate(),
                        month: date.toLocaleDateString('en-US', { month: 'short' }),
                        bookings: dayBookings.length,
                        available: availableCount,
                        total: vehicles.length,
                        isToday: date.toDateString() === today.toDateString()
                    });
                }

                return calendar;
            };

            const calendarData = getCalendarData();

            return (
                <div>
                    <div className="header" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <div>
                            <h2>Reservations</h2>
                            <p>Manage your vehicle reservations and bookings</p>
                        </div>
                        <div style={{ display: 'flex', gap: '10px' }}>
                            <button
                                className="btn btn-secondary"
                                onClick={() => setShowAvailabilityCheck(!showAvailabilityCheck)}
                            >
                                üìÖ {showAvailabilityCheck ? 'Hide' : 'Show'} Availability Calendar
                            </button>
                            <button 
                                className="btn btn-primary"
                                onClick={() => {
                                    setEditingBooking(null);
                                    setShowModal(true);
                                }}
                            >
                                ‚ûï New Reservation
                            </button>
                        </div>
                    </div>

                    {/* Availability Calendar */}
                    {showAvailabilityCheck && (
                        <div className="card" style={{ marginBottom: '20px' }}>
                            <div className="card-title">30-Day Availability Calendar</div>
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fill, minmax(80px, 1fr))',
                                gap: '10px',
                                padding: '10px'
                            }}>
                                {calendarData.map((day) => {
                                    const utilizationRate = day.total > 0 ? (day.bookings / day.total) * 100 : 0;
                                    let bgColor = '#e8f4f6'; // Light teal for low utilization
                                    if (utilizationRate > 75) bgColor = '#ff6b6b'; // Red for high utilization
                                    else if (utilizationRate > 50) bgColor = '#ffd93d'; // Yellow for medium
                                    else if (utilizationRate > 25) bgColor = '#95e1d3'; // Medium teal

                                    return (
                                        <div
                                            key={day.date}
                                            style={{
                                                backgroundColor: day.isToday ? '#ff8c42' : bgColor,
                                                padding: '10px',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                border: day.isToday ? '2px solid var(--primary-teal)' : '1px solid #ddd',
                                                boxShadow: day.isToday ? '0 2px 8px rgba(26, 122, 138, 0.3)' : 'none',
                                                cursor: 'pointer',
                                                transition: 'transform 0.2s'
                                            }}
                                            onMouseEnter={(e) => e.currentTarget.style.transform = 'scale(1.05)'}
                                            onMouseLeave={(e) => e.currentTarget.style.transform = 'scale(1)'}
                                            title={`${day.date}\n${day.bookings} bookings\n${day.available} available vehicles`}
                                        >
                                            <div style={{
                                                fontSize: '10px',
                                                fontWeight: '600',
                                                color: day.isToday ? 'white' : '#666',
                                                marginBottom: '4px'
                                            }}>
                                                {day.dayName}
                                            </div>
                                            <div style={{
                                                fontSize: '18px',
                                                fontWeight: 'bold',
                                                color: day.isToday ? 'white' : '#2c3e50',
                                                marginBottom: '4px'
                                            }}>
                                                {day.dayNum}
                                            </div>
                                            <div style={{
                                                fontSize: '9px',
                                                color: day.isToday ? 'white' : '#888'
                                            }}>
                                                {day.month}
                                            </div>
                                            <div style={{
                                                fontSize: '11px',
                                                fontWeight: '600',
                                                marginTop: '6px',
                                                color: day.isToday ? 'white' : '#1a7a8a',
                                                borderTop: day.isToday ? '1px solid white' : '1px solid #ccc',
                                                paddingTop: '4px'
                                            }}>
                                                {day.available}/{day.total}
                                            </div>
                                            <div style={{
                                                fontSize: '8px',
                                                color: day.isToday ? 'white' : '#999'
                                            }}>
                                                available
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            <div style={{
                                padding: '15px',
                                borderTop: '1px solid #e0e0e0',
                                display: 'flex',
                                gap: '20px',
                                fontSize: '12px',
                                justifyContent: 'center',
                                flexWrap: 'wrap'
                            }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <div style={{ width: '20px', height: '20px', backgroundColor: '#e8f4f6', borderRadius: '4px', border: '1px solid #ddd' }}></div>
                                    <span>Low (&lt;25%)</span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <div style={{ width: '20px', height: '20px', backgroundColor: '#95e1d3', borderRadius: '4px', border: '1px solid #ddd' }}></div>
                                    <span>Medium (25-50%)</span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <div style={{ width: '20px', height: '20px', backgroundColor: '#ffd93d', borderRadius: '4px', border: '1px solid #ddd' }}></div>
                                    <span>High (50-75%)</span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <div style={{ width: '20px', height: '20px', backgroundColor: '#ff6b6b', borderRadius: '4px', border: '1px solid #ddd' }}></div>
                                    <span>Very High (&gt;75%)</span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <div style={{ width: '20px', height: '20px', backgroundColor: '#ff8c42', borderRadius: '4px', border: '2px solid var(--primary-teal)' }}></div>
                                    <span>Today</span>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Status Filter Tabs */}
                    <div style={{
                        backgroundColor: 'white',
                        padding: '15px 20px',
                        borderRadius: '12px',
                        marginBottom: '20px',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                        display: 'flex',
                        gap: '10px',
                        flexWrap: 'wrap',
                        alignItems: 'center'
                    }}>
                        {statusFilters.map(filter => (
                            <button
                                key={filter.id}
                                onClick={() => setFilterStatus(filter.id)}
                                style={{
                                    padding: '8px 16px',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer',
                                    backgroundColor: filterStatus === filter.id ? 'var(--primary-teal)' : '#f0f0f0',
                                    color: filterStatus === filter.id ? 'white' : 'var(--text-dark)',
                                    fontSize: '14px',
                                    fontWeight: filterStatus === filter.id ? '500' : 'normal',
                                    transition: 'all 0.3s'
                                }}
                            >
                                {filter.label}
                            </button>
                        ))}
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Start typing a name..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button className="btn btn-secondary">
                                üíæ Save this search
                            </button>
                        </div>

                        {filteredBookings.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üìÖ</div>
                                <p>No reservations found</p>
                            </div>
                        ) : (
                            <>
                                <div style={{ overflowX: 'auto' }}>
                                    <table className="table" style={{ minWidth: '1400px' }}>
                                        <thead>
                                            <tr>
                                                <th style={{ width: '30px' }}>
                                                    <input type="checkbox" />
                                                </th>
                                                <th>#</th>
                                                <th>Customer</th>
                                                <th>Pickup Date</th>
                                                <th>Return Date</th>
                                                <th>Pickup Location</th>
                                                <th>Vehicle Class</th>
                                                <th>Vehicle</th>
                                                <th>Total Price</th>
                                                <th>Total Revenue</th>
                                                <th>Total Paid</th>
                                                <th>Total Refunded</th>
                                                <th>Outstanding Balance</th>
                                                <th>Status</th>
                                                <th>Notes</th>
                                                <th>Total Days</th>
                                                <th>Daily Rate</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {filteredBookings.map(booking => {
                                                const days = Math.ceil((new Date(booking.endDate) - new Date(booking.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                                                const dailyRate = booking.totalAmount / days;
                                                return (
                                                    <tr key={booking.id}>
                                                        <td><input type="checkbox" /></td>
                                                        <td>{booking.id}</td>
                                                        <td style={{ color: 'var(--primary-teal)', cursor: 'pointer' }}>{booking.customerName}</td>
                                                        <td>
                                                            {new Date(booking.startDate).toLocaleDateString()}<br/>
                                                            <small style={{ color: '#999' }}>13:47</small>
                                                        </td>
                                                        <td>
                                                            {new Date(booking.endDate).toLocaleDateString()}<br/>
                                                            <small style={{ color: '#999' }}>13:47</small>
                                                        </td>
                                                        <td>Office</td>
                                                        <td>{booking.vehicleClass || 'Premium'}</td>
                                                        <td>{booking.vehicleName}</td>
                                                        <td>N${parseFloat(booking.totalAmount).toFixed(2)}</td>
                                                        <td>N${parseFloat(booking.totalRevenue || booking.totalAmount).toFixed(2)}</td>
                                                        <td>N${parseFloat(booking.totalPaid || 0).toFixed(2)}</td>
                                                        <td>N$0.00</td>
                                                        <td style={{ color: parseFloat(booking.outstandingBalance || booking.totalAmount) > 0 ? 'var(--danger)' : 'inherit' }}>
                                                            N${parseFloat(booking.outstandingBalance || booking.totalAmount).toFixed(2)}
                                                        </td>
                                                        <td>
                                                            <span className="badge badge-active" style={{ 
                                                                backgroundColor: '#ff9800', 
                                                                color: 'white',
                                                                padding: '4px 12px',
                                                                borderRadius: '12px',
                                                                fontSize: '11px'
                                                            }}>
                                                                {booking.status === 'active' ? 'Open' : booking.status}
                                                            </span>
                                                        </td>
                                                        <td>{booking.notes || '-'}</td>
                                                        <td>{days}</td>
                                                        <td>N${dailyRate.toFixed(2)}</td>
                                                        <td>
                                                            <div style={{ display: 'flex', gap: '5px' }}>
                                                                <button
                                                                    className="btn btn-success"
                                                                    style={{ padding: '6px 10px', fontSize: '12px' }}
                                                                    onClick={() => generateRentalAgreement(booking)}
                                                                    title="Generate Agreement PDF"
                                                                >
                                                                    üìÑ
                                                                </button>
                                                                <button
                                                                    className="btn btn-success"
                                                                    style={{ padding: '6px 10px', fontSize: '12px', backgroundColor: '#ff8c42' }}
                                                                    onClick={() => generateInvoice(booking)}
                                                                    title="Generate Invoice"
                                                                >
                                                                    üßæ
                                                                </button>
                                                                <button
                                                                    className="btn btn-primary"
                                                                    style={{ padding: '6px 10px', fontSize: '12px' }}
                                                                    onClick={() => {
                                                                        setEditingBooking(booking);
                                                                        setShowModal(true);
                                                                    }}
                                                                    title="Edit"
                                                                >
                                                                    ‚úèÔ∏è
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                        <tfoot style={{ backgroundColor: '#f5f5f5', fontWeight: 'bold' }}>
                                            <tr>
                                                <td colSpan="8" style={{ textAlign: 'right', paddingRight: '20px' }}>Totals:</td>
                                                <td>N${totals.totalPrice.toFixed(2)}</td>
                                                <td>N${totals.totalRevenue.toFixed(2)}</td>
                                                <td>N${totals.totalPaid.toFixed(2)}</td>
                                                <td>N${totals.totalRefunded.toFixed(2)}</td>
                                                <td>N${totals.outstandingBalance.toFixed(2)}</td>
                                                <td colSpan="2"></td>
                                                <td>{totals.totalDays || filteredBookings.reduce((sum, b) => {
                                                    return sum + Math.ceil((new Date(b.endDate) - new Date(b.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                                                }, 0)}</td>
                                                <td colSpan="2"></td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>

                                <div style={{
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    marginTop: '20px',
                                    padding: '15px 0'
                                }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                        <span>Show</span>
                                        <select style={{ padding: '5px 10px', borderRadius: '4px', border: '1px solid #ddd' }}>
                                            <option>10</option>
                                            <option>25</option>
                                            <option>50</option>
                                            <option>100</option>
                                        </select>
                                        <span>records</span>
                                    </div>
                                    <div style={{ color: '#666' }}>
                                        Showing 1 to {Math.min(10, filteredBookings.length)} of {filteredBookings.length} entries
                                    </div>
                                    <div style={{ display: 'flex', gap: '5px' }}>
                                        <button className="btn btn-secondary" style={{ padding: '6px 12px' }}>Previous</button>
                                        <button className="btn btn-secondary" style={{ padding: '6px 12px' }}>Next</button>
                                    </div>
                                </div>
                            </>
                        )}
                    </div>

                    {showModal && (
                        <BookingModal 
                            booking={editingBooking}
                            vehicles={vehicles}
                            customers={customers}
                            bookings={bookings}
                            onSave={addBooking}
                            onClose={() => {
                                setShowModal(false);
                                setEditingBooking(null);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Booking Modal Component
        function BookingModal({ booking, vehicles, customers, bookings, onSave, onClose }) {
            const [formData, setFormData] = useState(booking || {
                customerName: '',
                customerEmail: '',
                customerPhone: '',
                vehicleId: '',
                vehicleName: '',
                licensePlate: '',
                startDate: '',
                endDate: '',
                totalAmount: 0,
                status: 'active',
                startOdometer: '',
                endOdometer: '',
                startFuelLevel: 'full',
                endFuelLevel: 'full'
            });

            const [errors, setErrors] = useState({});
            const [rentalDays, setRentalDays] = useState(0);
            const [showCustomerSuggestions, setShowCustomerSuggestions] = useState(false);
            const [filteredCustomers, setFilteredCustomers] = useState([]);

            const getTodayDate = () => {
                const today = new Date();
                return today.toISOString().split('T')[0];
            };

            const handleCustomerNameChange = (value) => {
                setFormData({...formData, customerName: value});

                if (value.trim().length > 0) {
                    const matches = customers.filter(c =>
                        c.name.toLowerCase().includes(value.toLowerCase()) ||
                        c.email.toLowerCase().includes(value.toLowerCase()) ||
                        c.phone.includes(value)
                    );
                    setFilteredCustomers(matches);
                    setShowCustomerSuggestions(matches.length > 0);
                } else {
                    setShowCustomerSuggestions(false);
                    setFilteredCustomers([]);
                }
            };

            const selectCustomer = (customer) => {
                setFormData({
                    ...formData,
                    customerName: customer.name,
                    customerEmail: customer.email,
                    customerPhone: customer.phone
                });
                setShowCustomerSuggestions(false);
                setFilteredCustomers([]);
            };

            const availableVehicles = vehicles.filter(v => {
                if (v.status !== 'available') return false;
                
                // Check if vehicle is booked during selected dates
                if (formData.startDate && formData.endDate) {
                    const hasConflict = bookings.some(b => {
                        if (booking && b.id === booking.id) return false; // Skip current booking when editing
                        if (b.vehicleId !== v.id) return false;
                        
                        const bookingStart = new Date(b.startDate);
                        const bookingEnd = new Date(b.endDate);
                        const selectedStart = new Date(formData.startDate);
                        const selectedEnd = new Date(formData.endDate);
                        
                        return (selectedStart <= bookingEnd && selectedEnd >= bookingStart);
                    });
                    
                    return !hasConflict;
                }
                
                return true;
            });

            const handleVehicleChange = (vehicleId) => {
                const vehicle = vehicles.find(v => v.id === parseInt(vehicleId));
                if (vehicle) {
                    setFormData({
                        ...formData,
                        vehicleId: vehicle.id,
                        vehicleName: `${vehicle.make} ${vehicle.model}`,
                        licensePlate: vehicle.licensePlate
                    });
                    calculateTotal(formData.startDate, formData.endDate, vehicle.dailyRate);
                }
            };

            const calculateTotal = (startDate, endDate, dailyRate) => {
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);

                    // Validate end date is after start date
                    if (end < start) {
                        setErrors(prev => ({...prev, endDate: 'End date must be after start date'}));
                        setRentalDays(0);
                        return;
                    } else {
                        setErrors(prev => ({...prev, endDate: ''}));
                    }

                    const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                    setRentalDays(days);
                    const vehicle = vehicles.find(v => v.id === formData.vehicleId);
                    const rate = dailyRate || (vehicle ? vehicle.dailyRate : 0);
                    setFormData(prev => ({...prev, totalAmount: (days * rate).toFixed(2), totalDays: days}));
                }
            };

            const validateForm = () => {
                const newErrors = {};

                if (!formData.customerName.trim()) {
                    newErrors.customerName = 'Customer name is required';
                }

                if (formData.customerEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.customerEmail)) {
                    newErrors.customerEmail = 'Invalid email format';
                }

                if (formData.customerPhone && !/^[\d\s\-\+\(\)]+$/.test(formData.customerPhone)) {
                    newErrors.customerPhone = 'Invalid phone number format';
                }

                if (!formData.vehicleId) {
                    newErrors.vehicleId = 'Please select a vehicle';
                }

                if (!formData.startDate) {
                    newErrors.startDate = 'Start date is required';
                }

                if (!formData.endDate) {
                    newErrors.endDate = 'End date is required';
                } else if (new Date(formData.endDate) < new Date(formData.startDate)) {
                    newErrors.endDate = 'End date must be after start date';
                }

                if (formData.startOdometer && formData.endOdometer) {
                    if (parseFloat(formData.endOdometer) < parseFloat(formData.startOdometer)) {
                        newErrors.endOdometer = 'End odometer must be greater than start odometer';
                    }
                }

                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (validateForm()) {
                    onSave(formData);
                }
            };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h3>{booking ? 'Edit Booking' : 'New Booking'}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group" style={{ position: 'relative' }}>
                                <label>Customer Name *</label>
                                <input
                                    type="text"
                                    className={`form-control ${errors.customerName ? 'error' : ''}`}
                                    value={formData.customerName}
                                    onChange={(e) => handleCustomerNameChange(e.target.value)}
                                    onFocus={(e) => {
                                        if (e.target.value.trim().length > 0 && filteredCustomers.length > 0) {
                                            setShowCustomerSuggestions(true);
                                        }
                                    }}
                                    onBlur={() => {
                                        setTimeout(() => setShowCustomerSuggestions(false), 200);
                                    }}
                                    placeholder="Start typing to search existing customers..."
                                    required
                                />
                                {errors.customerName && <span className="form-error">{errors.customerName}</span>}

                                {showCustomerSuggestions && filteredCustomers.length > 0 && (
                                    <div style={{
                                        position: 'absolute',
                                        top: '100%',
                                        left: 0,
                                        right: 0,
                                        maxHeight: '200px',
                                        overflowY: 'auto',
                                        background: 'white',
                                        border: '1px solid #ddd',
                                        borderRadius: '4px',
                                        boxShadow: '0 2px 8px rgba(0,0,0,0.15)',
                                        zIndex: 1000,
                                        marginTop: '2px'
                                    }}>
                                        {filteredCustomers.map(customer => (
                                            <div
                                                key={customer.id}
                                                onClick={() => selectCustomer(customer)}
                                                style={{
                                                    padding: '10px 12px',
                                                    cursor: 'pointer',
                                                    borderBottom: '1px solid #f0f0f0',
                                                    transition: 'background 0.2s'
                                                }}
                                                onMouseEnter={(e) => e.target.style.background = '#f5f5f5'}
                                                onMouseLeave={(e) => e.target.style.background = 'white'}
                                            >
                                                <div style={{ fontWeight: 'bold', marginBottom: '3px' }}>{customer.name}</div>
                                                <div style={{ fontSize: '12px', color: '#666' }}>
                                                    {customer.email} {customer.phone && `‚Ä¢ ${customer.phone}`}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Email</label>
                                    <input
                                        type="email"
                                        className={`form-control ${errors.customerEmail ? 'error' : ''}`}
                                        value={formData.customerEmail}
                                        onChange={(e) => setFormData({...formData, customerEmail: e.target.value})}
                                    />
                                    {errors.customerEmail && <span className="form-error">{errors.customerEmail}</span>}
                                </div>
                                <div className="form-group">
                                    <label>Phone</label>
                                    <input
                                        type="tel"
                                        className={`form-control ${errors.customerPhone ? 'error' : ''}`}
                                        value={formData.customerPhone}
                                        onChange={(e) => setFormData({...formData, customerPhone: e.target.value})}
                                    />
                                    {errors.customerPhone && <span className="form-error">{errors.customerPhone}</span>}
                                </div>
                            </div>
                            <div className="form-group">
                                <label>Vehicle *</label>
                                <select
                                    className={`form-control ${errors.vehicleId ? 'error' : ''}`}
                                    value={formData.vehicleId}
                                    onChange={(e) => handleVehicleChange(e.target.value)}
                                    required
                                >
                                    <option value="">Select a vehicle</option>
                                    {availableVehicles.map(vehicle => (
                                        <option key={vehicle.id} value={vehicle.id}>
                                            {vehicle.make} {vehicle.model} - ${vehicle.dailyRate}/day
                                        </option>
                                    ))}
                                </select>
                                {errors.vehicleId && <span className="form-error">{errors.vehicleId}</span>}
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Start Date *</label>
                                    <input
                                        type="date"
                                        className={`form-control ${errors.startDate ? 'error' : ''}`}
                                        value={formData.startDate}
                                        min={getTodayDate()}
                                        onChange={(e) => {
                                            setFormData({...formData, startDate: e.target.value});
                                            calculateTotal(e.target.value, formData.endDate);
                                        }}
                                        required
                                    />
                                    {errors.startDate && <span className="form-error">{errors.startDate}</span>}
                                </div>
                                <div className="form-group">
                                    <label>End Date *</label>
                                    <input
                                        type="date"
                                        className={`form-control ${errors.endDate ? 'error' : ''}`}
                                        value={formData.endDate}
                                        min={formData.startDate || getTodayDate()}
                                        onChange={(e) => {
                                            setFormData({...formData, endDate: e.target.value});
                                            calculateTotal(formData.startDate, e.target.value);
                                        }}
                                        required
                                    />
                                    {errors.endDate && <span className="form-error">{errors.endDate}</span>}
                                </div>
                            </div>
                            {rentalDays > 0 && (
                                <div className="form-group">
                                    <span className="form-info">
                                        üìÖ Rental Period: {rentalDays} day{rentalDays > 1 ? 's' : ''}
                                    </span>
                                </div>
                            )}
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Start Odometer (km)</label>
                                    <input
                                        type="number"
                                        className={`form-control ${errors.startOdometer ? 'error' : ''}`}
                                        value={formData.startOdometer}
                                        onChange={(e) => setFormData({...formData, startOdometer: e.target.value})}
                                        placeholder="Enter odometer reading"
                                        step="0.1"
                                    />
                                    {errors.startOdometer && <span className="form-error">{errors.startOdometer}</span>}
                                </div>
                                <div className="form-group">
                                    <label>End Odometer (km)</label>
                                    <input
                                        type="number"
                                        className={`form-control ${errors.endOdometer ? 'error' : ''}`}
                                        value={formData.endOdometer}
                                        onChange={(e) => setFormData({...formData, endOdometer: e.target.value})}
                                        placeholder="Enter odometer reading"
                                        step="0.1"
                                    />
                                    {errors.endOdometer && <span className="form-error">{errors.endOdometer}</span>}
                                    {formData.startOdometer && formData.endOdometer && parseFloat(formData.endOdometer) > parseFloat(formData.startOdometer) && (
                                        <span className="form-info">
                                            Distance: {(parseFloat(formData.endOdometer) - parseFloat(formData.startOdometer)).toFixed(1)} km
                                        </span>
                                    )}
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Start Fuel Level</label>
                                    <select
                                        className="form-control"
                                        value={formData.startFuelLevel}
                                        onChange={(e) => setFormData({...formData, startFuelLevel: e.target.value})}
                                    >
                                        <option value="full">Full</option>
                                        <option value="three-quarters">3/4</option>
                                        <option value="half">1/2</option>
                                        <option value="quarter">1/4</option>
                                        <option value="empty">Empty</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>End Fuel Level</label>
                                    <select
                                        className="form-control"
                                        value={formData.endFuelLevel}
                                        onChange={(e) => setFormData({...formData, endFuelLevel: e.target.value})}
                                    >
                                        <option value="full">Full</option>
                                        <option value="three-quarters">3/4</option>
                                        <option value="half">1/2</option>
                                        <option value="quarter">1/4</option>
                                        <option value="empty">Empty</option>
                                    </select>
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Total Amount ($)</label>
                                    <input 
                                        type="number"
                                        className="form-control"
                                        value={formData.totalAmount}
                                        onChange={(e) => setFormData({...formData, totalAmount: e.target.value})}
                                        required
                                        step="0.01"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Status</label>
                                    <select 
                                        className="form-control"
                                        value={formData.status}
                                        onChange={(e) => setFormData({...formData, status: e.target.value})}
                                    >
                                        <option value="active">Active</option>
                                        <option value="completed">Completed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                </div>
                            </div>
                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save Booking
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Transfers Component
        function Transfers({ transfers, setTransfers, customers }) {
            const [showModal, setShowModal] = useState(false);
            const [editingTransfer, setEditingTransfer] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterStatus, setFilterStatus] = useState('all');

            const TRANSFER_TYPES = [
                { id: 'airport-pickup', label: 'Airport Pickup', icon: '‚úàÔ∏è' },
                { id: 'airport-dropoff', label: 'Airport Drop-off', icon: '‚úàÔ∏è' },
                { id: 'hotel-transfer', label: 'Hotel Transfer', icon: 'üè®' },
                { id: 'city-transfer', label: 'City Transfer', icon: 'üèôÔ∏è' },
                { id: 'point-to-point', label: 'Point to Point', icon: 'üìç' },
                { id: 'hourly-charter', label: 'Hourly Charter', icon: '‚è∞' }
            ];

            const VEHICLE_TYPES = [
                { id: 'sedan', label: 'Sedan (1-3 passengers)', capacity: 3, luggage: 2, price: 50 },
                { id: 'suv', label: 'SUV (1-6 passengers)', capacity: 6, luggage: 4, price: 80 },
                { id: 'van', label: 'Van (1-12 passengers)', capacity: 12, luggage: 8, price: 120 },
                { id: 'minibus', label: 'Minibus (1-20 passengers)', capacity: 20, luggage: 15, price: 180 },
                { id: 'bus', label: 'Bus (20+ passengers)', capacity: 50, luggage: 30, price: 300 }
            ];

            const filteredTransfers = transfers.filter(t => {
                const matchesSearch =
                    t.customerName?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    t.pickupLocation?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    t.dropoffLocation?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    t.confirmationNumber?.toLowerCase().includes(searchTerm.toLowerCase());

                const matchesStatus = filterStatus === 'all' || t.status === filterStatus;

                return matchesSearch && matchesStatus;
            });

            const addTransfer = (transfer) => {
                if (editingTransfer) {
                    setTransfers(transfers.map(t => t.id === editingTransfer.id ? transfer : t));
                } else {
                    const confirmationNumber = 'TRF-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                    setTransfers([...transfers, { ...transfer, id: Date.now(), confirmationNumber }]);
                }
                setShowModal(false);
                setEditingTransfer(null);
            };

            const deleteTransfer = (id) => {
                if (confirm('Are you sure you want to delete this transfer booking?')) {
                    setTransfers(transfers.filter(t => t.id !== id));
                }
            };

            const exportTransferToPDF = (transfer) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const vehicle = VEHICLE_TYPES.find(v => v.id === transfer.vehicleType);
                const transferType = TRANSFER_TYPES.find(t => t.id === transfer.transferType);
                const pickupDate = new Date(transfer.pickupDateTime);

                // Colors
                const tealColor = [26, 122, 138];
                const orangeColor = [255, 140, 66];

                // Logo area - Circle with text "KETU KAKAHALA"
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(28);
                doc.setFont(undefined, 'bold');
                doc.text('KETU', 75, 25);
                doc.setFontSize(22);
                doc.text('KAKAHALA', 75, 35);

                // Company Details
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('KETU KAKAHALA TRADING ENTERPRISES CC', 105, 50, { align: 'center' });
                doc.setFontSize(9);
                doc.setFont(undefined, 'normal');
                doc.text('PO Box 286, Okahandja', 105, 56, { align: 'center' });

                // Invoice Title
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('INVOICE', 105, 70, { align: 'center' });

                // Invoice Details Box
                doc.setDrawColor(0);
                doc.setLineWidth(0.5);
                doc.rect(20, 80, 170, 30);
                doc.line(105, 80, 105, 110);

                // Left side - Invoice Number and Date
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('Invoice Number:', 25, 88);
                doc.setFont(undefined, 'normal');
                doc.text(transfer.confirmationNumber || `INV-${transfer.id}`, 25, 94);

                doc.setFont(undefined, 'bold');
                doc.text('Date:', 25, 102);
                doc.setFont(undefined, 'normal');
                doc.text(pickupDate.toLocaleDateString('en-GB'), 25, 108);

                // Right side - Bill To
                doc.setFont(undefined, 'bold');
                doc.text('Bill To:', 110, 88);
                doc.setFont(undefined, 'normal');
                const customerLines = [transfer.customerName || 'N/A'];
                if (transfer.customerEmail) customerLines.push(transfer.customerEmail);
                if (transfer.customerPhone) customerLines.push(transfer.customerPhone);

                let billToY = 94;
                customerLines.forEach(line => {
                    doc.text(line, 110, billToY);
                    billToY += 6;
                });

                // Service Table Header
                let tableY = 125;
                doc.setFillColor(...tealColor);
                doc.rect(20, tableY, 170, 10, 'F');

                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('Description', 25, tableY + 7);
                doc.text('Passengers', 130, tableY + 7);
                doc.text('Amount', 165, tableY + 7);

                // Service Details
                tableY += 10;
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');

                // Draw table borders
                doc.setDrawColor(0);
                doc.rect(20, tableY, 170, 35);
                doc.line(125, tableY, 125, tableY + 35);
                doc.line(155, tableY, 155, tableY + 35);

                // Transfer Service
                doc.setFont(undefined, 'bold');
                doc.text('Transfer Service', 25, tableY + 7);
                doc.setFont(undefined, 'normal');
                doc.text(`From: ${transfer.pickupLocation || 'N/A'}`, 25, tableY + 14);
                doc.text(`To: ${transfer.dropoffLocation || 'N/A'}`, 25, tableY + 21);

                if (transfer.pickupDateTime) {
                    const dateStr = pickupDate.toLocaleDateString('en-GB');
                    const timeStr = pickupDate.toLocaleTimeString('en-GB', {hour: '2-digit', minute: '2-digit'});
                    doc.text(`Date: ${dateStr} at ${timeStr}`, 25, tableY + 28);
                }

                doc.text(String(transfer.passengers || 0), 135, tableY + 15);
                const amountText = `N$ ${parseFloat(transfer.totalPrice || 0).toFixed(2)}`;
                doc.text(amountText, 185, tableY + 15, null, null, 'right');

                // Total
                tableY += 35;
                doc.setDrawColor(0);
                doc.rect(20, tableY, 170, 10);
                doc.line(125, tableY, 125, tableY + 10);
                doc.line(155, tableY, 155, tableY + 10);

                doc.setFont(undefined, 'bold');
                doc.text('TOTAL:', 130, tableY + 7);
                doc.setFontSize(11);
                const totalText = `N$ ${parseFloat(transfer.totalPrice || 0).toFixed(2)}`;
                doc.text(totalText, 185, tableY + 7, null, null, 'right');

                // Payment Details
                tableY += 25;
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Payment Details:', 20, tableY);

                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                tableY += 8;
                doc.text('Bank: First National Bank', 20, tableY);
                tableY += 6;
                doc.text('Account Name: Emmanuel Joseph', 20, tableY);
                tableY += 6;
                doc.text('Account Number: 62272255673', 20, tableY);
                tableY += 6;
                doc.text(`Reference: ${transfer.confirmationNumber || `INV-${transfer.id}`}`, 20, tableY);

                // Additional Info Section (if any)
                if (transfer.vehicleType || transfer.flightNumber || transfer.specialRequests) {
                    tableY += 15;
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'bold');
                    doc.text('Additional Information:', 20, tableY);

                    doc.setFontSize(9);
                    doc.setFont(undefined, 'normal');
                    tableY += 7;

                    if (vehicle) {
                        doc.text(`Vehicle Type: ${vehicle.label}`, 20, tableY);
                        tableY += 5;
                    }
                    if (transfer.flightNumber) {
                        doc.text(`Flight Number: ${transfer.flightNumber}`, 20, tableY);
                        tableY += 5;
                    }
                    if (transfer.specialRequests) {
                        doc.text('Special Requests:', 20, tableY);
                        tableY += 5;
                        const splitText = doc.splitTextToSize(transfer.specialRequests, 170);
                        doc.text(splitText, 20, tableY);
                    }
                }

                // Footer
                doc.setFontSize(9);
                doc.setFont(undefined, 'italic');
                doc.setTextColor(100, 100, 100);
                doc.text('Thank you for your business!', 105, 280, { align: 'center' });

                // Save PDF
                const invoiceNum = transfer.confirmationNumber || `INV-${transfer.id}`;
                doc.save(`Ketu_Kakahala_Invoice_${invoiceNum}.pdf`);
            };

            const getStatusBadgeClass = (status) => {
                switch(status) {
                    case 'confirmed': return 'badge-active';
                    case 'completed': return 'badge-completed';
                    case 'cancelled': return 'badge-maintenance';
                    case 'pending': return 'badge-rented';
                    default: return 'badge-available';
                }
            };

            return (
                <div>
                    <div className="header">
                        <h2>Private Transfers</h2>
                        <p>Manage airport pickups, hotel transfers, and point-to-point transportation</p>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input
                                type="text"
                                className="search-box"
                                placeholder="Search transfers by customer, location, or confirmation number..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <select
                                className="form-control"
                                style={{maxWidth: '200px'}}
                                value={filterStatus}
                                onChange={(e) => setFilterStatus(e.target.value)}
                            >
                                <option value="all">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                            <button
                                className="btn btn-primary"
                                onClick={() => {
                                    setEditingTransfer(null);
                                    setShowModal(true);
                                }}
                            >
                                ‚ûï Book New Transfer
                            </button>
                        </div>

                        {filteredTransfers.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üöê</div>
                                <p>No transfer bookings found</p>
                                <p style={{fontSize: '14px', marginTop: '10px'}}>Click "Book New Transfer" to create your first transfer booking</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Confirmation #</th>
                                        <th>Customer</th>
                                        <th>Transfer Type</th>
                                        <th>Date & Time</th>
                                        <th>Route</th>
                                        <th>Vehicle Type</th>
                                        <th>Passengers</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredTransfers.map(transfer => (
                                        <tr key={transfer.id}>
                                            <td style={{fontWeight: '600', color: 'var(--primary-teal)'}}>{transfer.confirmationNumber}</td>
                                            <td>
                                                <div>{transfer.customerName}</div>
                                                <div style={{fontSize: '12px', color: 'var(--text-light)'}}>{transfer.customerPhone}</div>
                                            </td>
                                            <td>
                                                {TRANSFER_TYPES.find(t => t.id === transfer.transferType)?.icon} {TRANSFER_TYPES.find(t => t.id === transfer.transferType)?.label}
                                            </td>
                                            <td>
                                                <div>{new Date(transfer.pickupDateTime).toLocaleDateString()}</div>
                                                <div style={{fontSize: '12px', color: 'var(--text-light)'}}>{new Date(transfer.pickupDateTime).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}</div>
                                            </td>
                                            <td>
                                                <div style={{fontSize: '13px'}}>
                                                    <div>üìç {transfer.pickupLocation}</div>
                                                    <div style={{margin: '5px 0', color: 'var(--text-light)'}}>‚Üì</div>
                                                    <div>üìç {transfer.dropoffLocation}</div>
                                                </div>
                                            </td>
                                            <td>{VEHICLE_TYPES.find(v => v.id === transfer.vehicleType)?.label}</td>
                                            <td>{transfer.passengers}</td>
                                            <td style={{fontWeight: '600'}}>N${parseFloat(transfer.totalPrice || 0).toFixed(2)}</td>
                                            <td>
                                                <span className={`badge ${getStatusBadgeClass(transfer.status)}`}>
                                                    {transfer.status}
                                                </span>
                                            </td>
                                            <td>
                                                <div style={{display: 'flex', gap: '8px', flexWrap: 'wrap'}}>
                                                    <button
                                                        className="btn btn-primary"
                                                        style={{padding: '8px 12px', fontSize: '12px'}}
                                                        onClick={() => exportTransferToPDF(transfer)}
                                                        title="Export to PDF"
                                                    >
                                                        üìÑ PDF
                                                    </button>
                                                    <button
                                                        className="btn btn-primary"
                                                        style={{padding: '8px 12px', fontSize: '12px'}}
                                                        onClick={() => {
                                                            setEditingTransfer(transfer);
                                                            setShowModal(true);
                                                        }}
                                                    >
                                                        ‚úèÔ∏è Edit
                                                    </button>
                                                    <button
                                                        className="btn btn-danger"
                                                        style={{padding: '8px 12px', fontSize: '12px'}}
                                                        onClick={() => deleteTransfer(transfer.id)}
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {showModal && (
                        <TransferModal
                            transfer={editingTransfer}
                            onSave={addTransfer}
                            onClose={() => {
                                setShowModal(false);
                                setEditingTransfer(null);
                            }}
                            customers={customers}
                            transferTypes={TRANSFER_TYPES}
                            vehicleTypes={VEHICLE_TYPES}
                        />
                    )}
                </div>
            );
        }

        // Transfer Modal Component
        function TransferModal({ transfer, onSave, onClose, customers, transferTypes, vehicleTypes }) {
            const [formData, setFormData] = useState(transfer || {
                customerName: '',
                customerEmail: '',
                customerPhone: '',
                transferType: 'airport-pickup',
                pickupLocation: '',
                dropoffLocation: '',
                pickupDateTime: '',
                vehicleType: 'sedan',
                passengers: 1,
                luggage: 0,
                flightNumber: '',
                specialRequests: '',
                totalPrice: 50,
                status: 'pending'
            });

            const updateFormData = (field, value) => {
                const newData = { ...formData, [field]: value };

                if (field === 'vehicleType') {
                    const vehicle = vehicleTypes.find(v => v.id === value);
                    if (vehicle) {
                        newData.totalPrice = vehicle.price;
                    }
                }

                setFormData(newData);
            };

            const handleCustomerSelect = (e) => {
                const customerId = e.target.value;
                const customer = customers.find(c => c.id === parseInt(customerId));
                if (customer) {
                    setFormData({
                        ...formData,
                        customerName: customer.name,
                        customerEmail: customer.email,
                        customerPhone: customer.phone
                    });
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();

                if (!formData.customerName || !formData.customerPhone || !formData.pickupLocation ||
                    !formData.dropoffLocation || !formData.pickupDateTime) {
                    alert('Please fill in all required fields');
                    return;
                }

                const selectedVehicle = vehicleTypes.find(v => v.id === formData.vehicleType);
                if (formData.passengers > selectedVehicle.capacity) {
                    alert(`Selected vehicle can only accommodate ${selectedVehicle.capacity} passengers`);
                    return;
                }

                onSave(formData);
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h3>{transfer ? 'Edit Transfer Booking' : 'Book New Transfer'}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>

                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Select Existing Customer (Optional)</label>
                                <select className="form-control" onChange={handleCustomerSelect}>
                                    <option value="">-- New Customer --</option>
                                    {customers.map(customer => (
                                        <option key={customer.id} value={customer.id}>
                                            {customer.customerType === 'tour-operator' && customer.companyName
                                                ? `${customer.companyName} (${customer.name}) - ${customer.phone}`
                                                : `${customer.name} - ${customer.phone}`}
                                            {customer.customerType === 'tour-operator' ? ' [Tour Operator]' : ''}
                                        </option>
                                    ))}
                                </select>
                            </div>

                            <div className="form-row">
                                <div className="form-group">
                                    <label>Customer Name *</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.customerName}
                                        onChange={(e) => updateFormData('customerName', e.target.value)}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Phone Number *</label>
                                    <input
                                        type="tel"
                                        className="form-control"
                                        value={formData.customerPhone}
                                        onChange={(e) => updateFormData('customerPhone', e.target.value)}
                                        required
                                    />
                                </div>
                            </div>

                            <div className="form-group">
                                <label>Email Address</label>
                                <input
                                    type="email"
                                    className="form-control"
                                    value={formData.customerEmail}
                                    onChange={(e) => updateFormData('customerEmail', e.target.value)}
                                />
                            </div>

                            <div className="form-row">
                                <div className="form-group">
                                    <label>Transfer Type *</label>
                                    <select
                                        className="form-control"
                                        value={formData.transferType}
                                        onChange={(e) => updateFormData('transferType', e.target.value)}
                                        required
                                    >
                                        {transferTypes.map(type => (
                                            <option key={type.id} value={type.id}>
                                                {type.icon} {type.label}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Pickup Date & Time *</label>
                                    <input
                                        type="datetime-local"
                                        className="form-control"
                                        value={formData.pickupDateTime}
                                        onChange={(e) => updateFormData('pickupDateTime', e.target.value)}
                                        required
                                    />
                                </div>
                            </div>

                            <div className="form-group">
                                <label>Pickup Location *</label>
                                <input
                                    type="text"
                                    className="form-control"
                                    placeholder="e.g., Hosea Kutako International Airport"
                                    value={formData.pickupLocation}
                                    onChange={(e) => updateFormData('pickupLocation', e.target.value)}
                                    required
                                />
                            </div>

                            <div className="form-group">
                                <label>Drop-off Location *</label>
                                <input
                                    type="text"
                                    className="form-control"
                                    placeholder="e.g., Hilton Windhoek"
                                    value={formData.dropoffLocation}
                                    onChange={(e) => updateFormData('dropoffLocation', e.target.value)}
                                    required
                                />
                            </div>

                            <div className="form-row">
                                <div className="form-group">
                                    <label>Vehicle Type *</label>
                                    <select
                                        className="form-control"
                                        value={formData.vehicleType}
                                        onChange={(e) => updateFormData('vehicleType', e.target.value)}
                                        required
                                    >
                                        {vehicleTypes.map(vehicle => (
                                            <option key={vehicle.id} value={vehicle.id}>
                                                {vehicle.label} - N${vehicle.price}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Number of Passengers *</label>
                                    <input
                                        type="number"
                                        className="form-control"
                                        min="1"
                                        value={formData.passengers}
                                        onChange={(e) => updateFormData('passengers', parseInt(e.target.value))}
                                        required
                                    />
                                </div>
                            </div>

                            <div className="form-row">
                                <div className="form-group">
                                    <label>Number of Luggage</label>
                                    <input
                                        type="number"
                                        className="form-control"
                                        min="0"
                                        value={formData.luggage}
                                        onChange={(e) => updateFormData('luggage', parseInt(e.target.value))}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Flight Number (if applicable)</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        placeholder="e.g., SA220"
                                        value={formData.flightNumber}
                                        onChange={(e) => updateFormData('flightNumber', e.target.value)}
                                    />
                                </div>
                            </div>

                            <div className="form-group">
                                <label>Special Requests / Notes</label>
                                <textarea
                                    className="form-control"
                                    rows="3"
                                    placeholder="Child seats, wheelchair accessible, etc."
                                    value={formData.specialRequests}
                                    onChange={(e) => updateFormData('specialRequests', e.target.value)}
                                />
                            </div>

                            <div className="form-row">
                                <div className="form-group">
                                    <label>Total Price (N$) *</label>
                                    <input
                                        type="number"
                                        className="form-control"
                                        min="0"
                                        step="0.01"
                                        value={formData.totalPrice}
                                        onChange={(e) => updateFormData('totalPrice', parseFloat(e.target.value))}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Status</label>
                                    <select
                                        className="form-control"
                                        value={formData.status}
                                        onChange={(e) => updateFormData('status', e.target.value)}
                                    >
                                        <option value="pending">Pending</option>
                                        <option value="confirmed">Confirmed</option>
                                        <option value="completed">Completed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                </div>
                            </div>

                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save Transfer Booking
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Quotes Component
        function Quotes({ quotes, setQuotes, vehicles, customers, bookings, setBookings }) {
            const [showModal, setShowModal] = useState(false);
            const [editingQuote, setEditingQuote] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');

            const filteredQuotes = quotes.filter(q => 
                q.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                q.vehicleName.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const addQuote = (quote) => {
                if (editingQuote) {
                    setQuotes(quotes.map(q => q.id === editingQuote.id ? quote : q));
                } else {
                    setQuotes([...quotes, { ...quote, id: Date.now(), status: 'pending' }]);
                }
                setShowModal(false);
                setEditingQuote(null);
            };

            const deleteQuote = (id) => {
                if (confirm('Are you sure you want to delete this quote?')) {
                    setQuotes(quotes.filter(q => q.id !== id));
                }
            };

            const convertToBooking = (quote) => {
                // Convert quote to booking
                const booking = {
                    id: Date.now(),
                    customerName: quote.customerName,
                    customerEmail: quote.customerEmail,
                    customerPhone: quote.customerPhone,
                    vehicleId: quote.vehicleId,
                    vehicleName: quote.vehicleName,
                    vehicleClass: quote.vehicleClass,
                    startDate: quote.startDate,
                    endDate: quote.endDate,
                    totalAmount: quote.totalAmount,
                    totalRevenue: quote.totalAmount,
                    totalPaid: 0,
                    totalRefunded: 0,
                    outstandingBalance: quote.totalAmount,
                    status: 'active',
                    notes: `Converted from Quote #${quote.id}${quote.notes ? ' - ' + quote.notes : ''}`,
                    licensePlate: vehicles.find(v => v.id === quote.vehicleId)?.licensePlate || '',
                    totalDays: Math.ceil((new Date(quote.endDate) - new Date(quote.startDate)) / (1000 * 60 * 60 * 24)) + 1
                };

                // Add booking to the bookings state
                setBookings([...bookings, booking]);

                // Update quote status to accepted
                setQuotes(quotes.map(q => q.id === quote.id ? {...q, status: 'accepted'} : q));

                alert(`‚úÖ Success! Quote #${quote.id} has been converted to Booking #${booking.id}!\n\nThe new reservation is now available in the Reservations section.`);
            };

            const generateQuotePDF = (quote) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let y = 15;
                const leftMargin = 15;
                const pageWidth = 210;
                
                // Add logo at the top
                doc.addImage(KETU_LOGO, 'JPEG', pageWidth/2 - 40, y, 80, 20);
                y += 25;
                
                // Title
                doc.setFontSize(20);
                doc.setTextColor(26, 122, 138);
                doc.setFont(undefined, 'bold');
                doc.text('RENTAL QUOTATION', pageWidth/2, y, { align: 'center' });
                
                y += 5;
                doc.setFontSize(9);
                doc.setFont(undefined, 'italic');
                doc.setTextColor(0, 0, 0);
                doc.text('Your personalized vehicle rental quote', pageWidth/2, y, { align: 'center' });
                
                y += 10;
                doc.setDrawColor(255, 140, 66);
                doc.setLineWidth(0.5);
                doc.line(leftMargin, y, pageWidth - leftMargin, y);
                y += 8;
                
                // Quote details header
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.text(`Quote Number: #${quote.id}`, leftMargin, y);
                doc.text(`Date: ${new Date().toLocaleDateString()}`, pageWidth - 60, y);
                y += 5;
                doc.text(`Valid Until: ${new Date(Date.now() + 30*24*60*60*1000).toLocaleDateString()}`, leftMargin, y);
                doc.text(`Status: ${quote.status.toUpperCase()}`, pageWidth - 60, y);
                y += 12;
                
                // Company Information
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.setFillColor(26, 122, 138);
                doc.rect(leftMargin, y, pageWidth - 2*leftMargin, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.text('FROM: KETU KAKAHALA TRADING ENTERPRISES', leftMargin + 5, y + 5);
                y += 12;
                
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.text('Ketu Kakahala Trading Enterprises', leftMargin + 5, y);
                y += 5;
                doc.text('Vehicle Rental Services', leftMargin + 5, y);
                y += 5;
                doc.text('Windhoek, Namibia', leftMargin + 5, y);
                y += 5;
                doc.text('Email: rentals@ketukakahala.com', leftMargin + 5, y);
                y += 5;
                doc.text('Phone: +264 (0) XX XXX XXXX', leftMargin + 5, y);
                y += 12;
                
                // Customer Information
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.setFillColor(255, 140, 66);
                doc.rect(leftMargin, y, pageWidth - 2*leftMargin, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.text('TO: CUSTOMER INFORMATION', leftMargin + 5, y + 5);
                y += 12;
                
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.text(`Name: ${quote.customerName}`, leftMargin + 5, y);
                y += 5;
                if (quote.customerEmail) {
                    doc.text(`Email: ${quote.customerEmail}`, leftMargin + 5, y);
                    y += 5;
                }
                if (quote.customerPhone) {
                    doc.text(`Phone: ${quote.customerPhone}`, leftMargin + 5, y);
                    y += 5;
                }
                y += 10;
                
                // Vehicle Details
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.setTextColor(26, 122, 138);
                doc.text('VEHICLE DETAILS', leftMargin, y);
                y += 7;
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Vehicle: ${quote.vehicleName}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Class: ${quote.vehicleClass || 'Premium'}`, leftMargin + 5, y);
                y += 10;
                
                // Rental Period
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.setTextColor(26, 122, 138);
                doc.text('RENTAL PERIOD', leftMargin, y);
                y += 7;
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Pick-up Date: ${new Date(quote.startDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`, leftMargin + 5, y);
                y += 5;
                doc.text(`Return Date: ${new Date(quote.endDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`, leftMargin + 5, y);
                y += 5;
                const days = Math.ceil((new Date(quote.endDate) - new Date(quote.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                doc.text(`Total Rental Days: ${days}`, leftMargin + 5, y);
                y += 10;
                
                // Pricing Table
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.setTextColor(26, 122, 138);
                doc.text('PRICING BREAKDOWN', leftMargin, y);
                y += 7;
                
                // Table header
                doc.setFillColor(240, 240, 240);
                doc.rect(leftMargin, y, pageWidth - 2*leftMargin, 8, 'F');
                doc.setFont(undefined, 'bold');
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text('Description', leftMargin + 5, y + 5);
                doc.text('Amount', pageWidth - 50, y + 5);
                y += 10;
                
                // Table rows
                doc.setFont(undefined, 'normal');
                const dailyRate = parseFloat(quote.totalAmount) / days;
                doc.text(`Daily Rate (${days} days √ó N$${dailyRate.toFixed(2)})`, leftMargin + 5, y);
                doc.text(`N$${parseFloat(quote.totalAmount).toFixed(2)}`, pageWidth - 50, y);
                y += 5;
                
                doc.text('Insurance (Included)', leftMargin + 5, y);
                doc.text('Included', pageWidth - 50, y);
                y += 5;
                
                doc.text('Basic Mileage', leftMargin + 5, y);
                doc.text('Included', pageWidth - 50, y);
                y += 10;
                
                // Total line
                doc.setDrawColor(200, 200, 200);
                doc.setLineWidth(0.5);
                doc.line(leftMargin, y, pageWidth - leftMargin, y);
                y += 7;
                
                doc.setFont(undefined, 'bold');
                doc.setFontSize(12);
                doc.setTextColor(26, 122, 138);
                doc.text('TOTAL ESTIMATED COST', leftMargin + 5, y);
                doc.text(`N$${parseFloat(quote.totalAmount).toFixed(2)}`, pageWidth - 50, y);
                y += 12;
                
                // Important Notes
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.setTextColor(255, 140, 66);
                doc.text('IMPORTANT NOTES', leftMargin, y);
                y += 7;
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                const notes = [
                    '‚Ä¢ This quote is valid for 30 days from the date of issue',
                    '‚Ä¢ Prices are subject to availability and may change',
                    '‚Ä¢ A valid driver\'s license is required',
                    '‚Ä¢ Security deposit will be required at pickup',
                    '‚Ä¢ Full payment required before vehicle pickup',
                    '‚Ä¢ Additional charges may apply for extra mileage, late returns, or damage',
                    '‚Ä¢ Insurance excess applies in case of accident or damage',
                ];
                
                notes.forEach(note => {
                    doc.text(note, leftMargin + 5, y);
                    y += 5;
                });
                
                y += 10;
                
                // Terms and Conditions
                doc.setFont(undefined, 'bold');
                doc.setFontSize(11);
                doc.setTextColor(26, 122, 138);
                doc.text('TERMS & CONDITIONS', leftMargin, y);
                y += 7;
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(8);
                doc.setTextColor(80, 80, 80);
                const terms = [
                    'This quotation is provided for information purposes only and does not constitute a binding agreement.',
                    'Final rental terms will be confirmed upon booking. All rentals subject to our standard terms and conditions.',
                    'Cancellation policy: Full refund if cancelled 48+ hours before pickup, 50% refund 24-48 hours, no refund <24 hours.'
                ];
                
                terms.forEach(term => {
                    const lines = doc.splitTextToSize(term, pageWidth - 2*leftMargin - 10);
                    lines.forEach(line => {
                        doc.text(line, leftMargin + 5, y);
                        y += 4;
                    });
                    y += 2;
                });
                
                // Check if we need a new page
                if (y > 250) {
                    doc.addPage();
                    y = 20;
                }
                
                y += 10;
                
                // Call to Action
                doc.setFillColor(26, 122, 138);
                doc.rect(leftMargin, y, pageWidth - 2*leftMargin, 25, 'F');
                y += 8;
                
                doc.setFont(undefined, 'bold');
                doc.setFontSize(12);
                doc.setTextColor(255, 255, 255);
                doc.text('Ready to Book?', pageWidth/2, y, { align: 'center' });
                y += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.text('Contact us to confirm your reservation', pageWidth/2, y, { align: 'center' });
                y += 5;
                doc.text('Email: rentals@ketukakahala.com | Phone: +264 (0) XX XXX XXXX', pageWidth/2, y, { align: 'center' });
                
                y += 15;
                
                // Footer
                doc.setDrawColor(255, 140, 66);
                doc.setLineWidth(0.5);
                doc.line(leftMargin, y, pageWidth - leftMargin, y);
                y += 5;
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Ketu Kakahala Trading Enterprises | Vehicle Rental Services', pageWidth/2, y, { align: 'center' });
                y += 4;
                doc.text(`Quote generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`, pageWidth/2, y, { align: 'center' });
                
                doc.save(`Ketu-Kakahala-Quote-${quote.id}.pdf`);
            };

            return (
                <div>
                    <div className="header">
                        <h2>Quotes Management</h2>
                        <p>Manage rental quotes and proposals</p>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Search quotes..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button 
                                className="btn btn-primary"
                                onClick={() => {
                                    setEditingQuote(null);
                                    setShowModal(true);
                                }}
                            >
                                ‚ûï New Quote
                            </button>
                        </div>

                        {filteredQuotes.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üìã</div>
                                <p>No quotes found</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Quote ID</th>
                                        <th>Customer</th>
                                        <th>Vehicle</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredQuotes.map(quote => (
                                        <tr key={quote.id}>
                                            <td>#{quote.id}</td>
                                            <td>{quote.customerName}</td>
                                            <td>{quote.vehicleName}</td>
                                            <td>{new Date(quote.startDate).toLocaleDateString()}</td>
                                            <td>{new Date(quote.endDate).toLocaleDateString()}</td>
                                            <td>N${quote.totalAmount}</td>
                                            <td>
                                                <span className={`badge badge-${quote.status === 'accepted' ? 'active' : quote.status === 'pending' ? 'rented' : 'maintenance'}`}>
                                                    {quote.status}
                                                </span>
                                            </td>
                                            <td>
                                                <div style={{ display: 'flex', gap: '5px' }}>
                                                    {quote.status === 'pending' && (
                                                        <button 
                                                            className="btn btn-success"
                                                            style={{padding: '8px 12px'}}
                                                            onClick={() => convertToBooking(quote)}
                                                            title="Convert to Booking"
                                                        >
                                                            ‚úì Convert
                                                        </button>
                                                    )}
                                                    <button 
                                                        className="btn btn-primary"
                                                        style={{padding: '8px 12px'}}
                                                        onClick={() => generateQuotePDF(quote)}
                                                        title="Generate PDF"
                                                    >
                                                        üìÑ PDF
                                                    </button>
                                                    <button 
                                                        className="btn btn-primary"
                                                        style={{padding: '8px 12px'}}
                                                        onClick={() => {
                                                            setEditingQuote(quote);
                                                            setShowModal(true);
                                                        }}
                                                        title="Edit"
                                                    >
                                                        ‚úèÔ∏è
                                                    </button>
                                                    <button 
                                                        className="btn btn-danger"
                                                        style={{padding: '8px 12px'}}
                                                        onClick={() => deleteQuote(quote.id)}
                                                        title="Delete"
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {showModal && (
                        <QuoteModal 
                            quote={editingQuote}
                            vehicles={vehicles}
                            customers={customers}
                            onSave={addQuote}
                            onClose={() => {
                                setShowModal(false);
                                setEditingQuote(null);
                            }}
                        />
                    )}
                </div>
            );
        }
        // Quote Modal Component
        function QuoteModal({ quote, vehicles, customers, onSave, onClose }) {
            const [formData, setFormData] = useState(quote || {
                customerName: '',
                customerEmail: '',
                customerPhone: '',
                vehicleId: '',
                vehicleName: '',
                vehicleClass: '',
                startDate: '',
                endDate: '',
                totalAmount: 0,
                notes: ''
            });

            const [showCustomerSuggestions, setShowCustomerSuggestions] = useState(false);
            const [filteredCustomers, setFilteredCustomers] = useState([]);

            const handleCustomerNameChange = (value) => {
                setFormData({...formData, customerName: value});

                if (value.trim().length > 0) {
                    const matches = customers.filter(c =>
                        c.name.toLowerCase().includes(value.toLowerCase()) ||
                        c.email.toLowerCase().includes(value.toLowerCase()) ||
                        c.phone.includes(value)
                    );
                    setFilteredCustomers(matches);
                    setShowCustomerSuggestions(matches.length > 0);
                } else {
                    setShowCustomerSuggestions(false);
                    setFilteredCustomers([]);
                }
            };

            const selectCustomer = (customer) => {
                setFormData({
                    ...formData,
                    customerName: customer.name,
                    customerEmail: customer.email,
                    customerPhone: customer.phone
                });
                setShowCustomerSuggestions(false);
                setFilteredCustomers([]);
            };

            const handleVehicleChange = (vehicleId) => {
                const vehicle = vehicles.find(v => v.id === parseInt(vehicleId));
                if (vehicle) {
                    setFormData({
                        ...formData,
                        vehicleId: vehicle.id,
                        vehicleName: `${vehicle.make} ${vehicle.model}`,
                        vehicleClass: vehicle.vehicleClass
                    });
                    calculateTotal(formData.startDate, formData.endDate, vehicle.dailyRate);
                }
            };

            const calculateTotal = (startDate, endDate, dailyRate) => {
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                    const vehicle = vehicles.find(v => v.id === formData.vehicleId);
                    const rate = dailyRate || (vehicle ? vehicle.dailyRate : 0);
                    setFormData(prev => ({...prev, totalAmount: (days * rate).toFixed(2)}));
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h3>{quote ? 'Edit Quote' : 'New Quote'}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group" style={{ position: 'relative' }}>
                                <label>Customer Name</label>
                                <input
                                    type="text"
                                    className="form-control"
                                    value={formData.customerName}
                                    onChange={(e) => handleCustomerNameChange(e.target.value)}
                                    onFocus={(e) => {
                                        if (e.target.value.trim().length > 0 && filteredCustomers.length > 0) {
                                            setShowCustomerSuggestions(true);
                                        }
                                    }}
                                    onBlur={() => {
                                        setTimeout(() => setShowCustomerSuggestions(false), 200);
                                    }}
                                    placeholder="Start typing to search existing customers..."
                                    required
                                />

                                {showCustomerSuggestions && filteredCustomers.length > 0 && (
                                    <div style={{
                                        position: 'absolute',
                                        top: '100%',
                                        left: 0,
                                        right: 0,
                                        maxHeight: '200px',
                                        overflowY: 'auto',
                                        background: 'white',
                                        border: '1px solid #ddd',
                                        borderRadius: '4px',
                                        boxShadow: '0 2px 8px rgba(0,0,0,0.15)',
                                        zIndex: 1000,
                                        marginTop: '2px'
                                    }}>
                                        {filteredCustomers.map(customer => (
                                            <div
                                                key={customer.id}
                                                onClick={() => selectCustomer(customer)}
                                                style={{
                                                    padding: '10px 12px',
                                                    cursor: 'pointer',
                                                    borderBottom: '1px solid #f0f0f0',
                                                    transition: 'background 0.2s'
                                                }}
                                                onMouseEnter={(e) => e.target.style.background = '#f5f5f5'}
                                                onMouseLeave={(e) => e.target.style.background = 'white'}
                                            >
                                                <div style={{ fontWeight: 'bold', marginBottom: '3px' }}>{customer.name}</div>
                                                <div style={{ fontSize: '12px', color: '#666' }}>
                                                    {customer.email} {customer.phone && `‚Ä¢ ${customer.phone}`}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Email</label>
                                    <input 
                                        type="email"
                                        className="form-control"
                                        value={formData.customerEmail}
                                        onChange={(e) => setFormData({...formData, customerEmail: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Phone</label>
                                    <input 
                                        type="tel"
                                        className="form-control"
                                        value={formData.customerPhone}
                                        onChange={(e) => setFormData({...formData, customerPhone: e.target.value})}
                                    />
                                </div>
                            </div>
                            <div className="form-group">
                                <label>Vehicle</label>
                                <select 
                                    className="form-control"
                                    value={formData.vehicleId}
                                    onChange={(e) => handleVehicleChange(e.target.value)}
                                    required
                                >
                                    <option value="">Select a vehicle</option>
                                    {vehicles.map(vehicle => (
                                        <option key={vehicle.id} value={vehicle.id}>
                                            {vehicle.make} {vehicle.model} ({vehicle.vehicleClass}) - N${vehicle.dailyRate}/day
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Start Date</label>
                                    <input 
                                        type="date"
                                        className="form-control"
                                        value={formData.startDate}
                                        onChange={(e) => {
                                            setFormData({...formData, startDate: e.target.value});
                                            calculateTotal(e.target.value, formData.endDate);
                                        }}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>End Date</label>
                                    <input 
                                        type="date"
                                        className="form-control"
                                        value={formData.endDate}
                                        onChange={(e) => {
                                            setFormData({...formData, endDate: e.target.value});
                                            calculateTotal(formData.startDate, e.target.value);
                                        }}
                                        required
                                    />
                                </div>
                            </div>
                            <div className="form-group">
                                <label>Estimated Amount (N$)</label>
                                <input 
                                    type="number"
                                    className="form-control"
                                    value={formData.totalAmount}
                                    onChange={(e) => setFormData({...formData, totalAmount: e.target.value})}
                                    required
                                    step="0.01"
                                />
                            </div>
                            <div className="form-group">
                                <label>Notes</label>
                                <textarea 
                                    className="form-control"
                                    value={formData.notes}
                                    onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                    rows="3"
                                />
                            </div>
                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save Quote
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Customers Component
        function Customers({ customers, setCustomers, bookings, showToast }) {
            const [showModal, setShowModal] = useState(false);
            const [editingCustomer, setEditingCustomer] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCustomer, setSelectedCustomer] = useState(null);
            const [showDetailModal, setShowDetailModal] = useState(false);

            const filteredCustomers = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                c.email.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const addCustomer = (customer) => {
                if (editingCustomer) {
                    setCustomers(customers.map(c => c.id === editingCustomer.id ? customer : c));
                    if (showToast) showToast('success', 'Customer Updated', 'Customer information has been updated.');
                } else {
                    setCustomers([...customers, { ...customer, id: Date.now() }]);
                    if (showToast) showToast('success', 'Customer Added', 'New customer has been added successfully.');
                }
                setShowModal(false);
                setEditingCustomer(null);
            };

            const getCustomerBookings = (customerId) => {
                const customer = customers.find(c => c.id === customerId);
                if (!customer) return [];
                return bookings.filter(b =>
                    b.customerEmail === customer.email ||
                    b.customerName === customer.name
                );
            };

            const deleteCustomer = (id) => {
                if (confirm('Are you sure you want to delete this customer?')) {
                    setCustomers(customers.filter(c => c.id !== id));
                }
            };

            return (
                <div>
                    <div className="header">
                        <h2>Customer Management</h2>
                        <p>Manage your customer database</p>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Search customers..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button 
                                className="btn btn-primary"
                                onClick={() => {
                                    setEditingCustomer(null);
                                    setShowModal(true);
                                }}
                            >
                                ‚ûï Add Customer
                            </button>
                        </div>

                        {filteredCustomers.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üë•</div>
                                <p>No customers found</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Contact</th>
                                        <th>License</th>
                                        <th>Docs Verified</th>
                                        <th>Bookings</th>
                                        <th>Total Spent</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredCustomers.map(customer => {
                                        const customerBookings = getCustomerBookings(customer.id);
                                        const totalSpent = customerBookings.reduce((sum, b) => sum + parseFloat(b.totalAmount || 0), 0);
                                        const verifiedDocs = [
                                            customer.licenseVerified,
                                            customer.idVerified,
                                            customer.addressVerified
                                        ].filter(Boolean).length;

                                        return (
                                            <tr key={customer.id}>
                                                <td>
                                                    <div style={{ cursor: 'pointer', color: 'var(--primary-teal)', fontWeight: 'bold' }}
                                                         onClick={() => setSelectedCustomer(customer)}>
                                                        {customer.name}
                                                    </div>
                                                    {customer.customerType === 'tour-operator' && customer.companyName && (
                                                        <div style={{ fontSize: '12px', color: '#666' }}>{customer.companyName}</div>
                                                    )}
                                                </td>
                                                <td>
                                                    {customer.customerType === 'tour-operator' ? (
                                                        <span className="badge badge-active">Tour Operator</span>
                                                    ) : (
                                                        <span className="badge badge-available">Individual</span>
                                                    )}
                                                </td>
                                                <td>
                                                    <div>{customer.email}</div>
                                                    <div style={{ fontSize: '12px', color: '#666' }}>{customer.phone}</div>
                                                </td>
                                                <td>{customer.licenseNumber || '-'}</td>
                                                <td>
                                                    <div style={{ fontSize: '12px' }}>
                                                        {verifiedDocs}/3
                                                        <div style={{ display: 'flex', gap: '4px', marginTop: '4px' }}>
                                                            <span title="License" style={{ color: customer.licenseVerified ? '#27ae60' : '#ddd' }}>
                                                                {customer.licenseVerified ? '‚úì' : '‚óã'} L
                                                            </span>
                                                            <span title="ID" style={{ color: customer.idVerified ? '#27ae60' : '#ddd' }}>
                                                                {customer.idVerified ? '‚úì' : '‚óã'} ID
                                                            </span>
                                                            <span title="Address" style={{ color: customer.addressVerified ? '#27ae60' : '#ddd' }}>
                                                                {customer.addressVerified ? '‚úì' : '‚óã'} A
                                                            </span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td style={{ textAlign: 'center', fontWeight: 'bold', fontSize: '16px' }}>
                                                    {customerBookings.length}
                                                </td>
                                                <td style={{ fontWeight: 'bold', color: 'var(--primary-teal)' }}>
                                                    N${totalSpent.toFixed(2)}
                                                </td>
                                                <td>
                                                    <button
                                                        className="btn btn-primary"
                                                        style={{marginRight: '10px', padding: '8px 16px'}}
                                                        onClick={() => {
                                                            setSelectedCustomer(customer);
                                                            setShowDetailModal(true);
                                                        }}
                                                        title="View Details"
                                                    >
                                                        üëÅÔ∏è View
                                                    </button>
                                                    <button
                                                        className="btn btn-primary"
                                                        style={{marginRight: '10px', padding: '8px 16px'}}
                                                        onClick={() => {
                                                            setEditingCustomer(customer);
                                                            setShowModal(true);
                                                        }}
                                                    >
                                                        ‚úèÔ∏è Edit
                                                    </button>
                                                    <button 
                                                    className="btn btn-danger"
                                                    style={{padding: '8px 16px'}}
                                                    onClick={() => deleteCustomer(customer.id)}
                                                >
                                                    üóëÔ∏è Delete
                                                </button>
                                            </td>
                                        </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {showModal && (
                        <CustomerModal
                            customer={editingCustomer}
                            onSave={addCustomer}
                            onClose={() => {
                                setShowModal(false);
                                setEditingCustomer(null);
                            }}
                        />
                    )}

                    {showDetailModal && selectedCustomer && (
                        <CustomerDetailModal
                            customer={selectedCustomer}
                            bookings={bookings}
                            customers={customers}
                            setCustomers={setCustomers}
                            onClose={() => {
                                setShowDetailModal(false);
                                setSelectedCustomer(null);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Customer Modal Component
        function CustomerModal({ customer, onSave, onClose }) {
            const [formData, setFormData] = useState(customer || {
                name: '',
                email: '',
                phone: '',
                address: '',
                licenseNumber: '',
                customerType: 'individual',
                companyName: '',
                licenseVerified: false,
                idVerified: false,
                addressVerified: false
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h3>{customer ? 'Edit Customer' : 'Add New Customer'}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Customer Type</label>
                                <select
                                    className="form-control"
                                    value={formData.customerType}
                                    onChange={(e) => setFormData({...formData, customerType: e.target.value})}
                                    required
                                >
                                    <option value="individual">Individual Customer</option>
                                    <option value="tour-operator">Tour Operator / Company</option>
                                </select>
                            </div>

                            <div className="form-group">
                                <label>{formData.customerType === 'tour-operator' ? 'Contact Person Name' : 'Full Name'}</label>
                                <input
                                    type="text"
                                    className="form-control"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    required
                                />
                            </div>

                            {formData.customerType === 'tour-operator' && (
                                <div className="form-group">
                                    <label>Company / Tour Operator Name</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.companyName}
                                        onChange={(e) => setFormData({...formData, companyName: e.target.value})}
                                        required
                                    />
                                </div>
                            )}

                            <div className="form-row">
                                <div className="form-group">
                                    <label>Email</label>
                                    <input 
                                        type="email"
                                        className="form-control"
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Phone</label>
                                    <input 
                                        type="tel"
                                        className="form-control"
                                        value={formData.phone}
                                        onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                        required
                                    />
                                </div>
                            </div>
                            <div className="form-group">
                                <label>Address</label>
                                <input 
                                    type="text"
                                    className="form-control"
                                    value={formData.address}
                                    onChange={(e) => setFormData({...formData, address: e.target.value})}
                                />
                            </div>
                            <div className="form-group">
                                <label>Driver's License Number</label>
                                <input
                                    type="text"
                                    className="form-control"
                                    value={formData.licenseNumber}
                                    onChange={(e) => setFormData({...formData, licenseNumber: e.target.value})}
                                />
                            </div>

                            <div className="form-group">
                                <label style={{ display: 'block', marginBottom: '10px', fontWeight: 'bold' }}>Document Verification</label>
                                <div style={{ display: 'flex', gap: '20px', flexWrap: 'wrap' }}>
                                    <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>
                                        <input
                                            type="checkbox"
                                            checked={formData.licenseVerified || false}
                                            onChange={(e) => setFormData({...formData, licenseVerified: e.target.checked})}
                                            style={{ marginRight: '5px' }}
                                        />
                                        Driver's License
                                    </label>
                                    <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>
                                        <input
                                            type="checkbox"
                                            checked={formData.idVerified || false}
                                            onChange={(e) => setFormData({...formData, idVerified: e.target.checked})}
                                            style={{ marginRight: '5px' }}
                                        />
                                        ID/Passport
                                    </label>
                                    <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>
                                        <input
                                            type="checkbox"
                                            checked={formData.addressVerified || false}
                                            onChange={(e) => setFormData({...formData, addressVerified: e.target.checked})}
                                            style={{ marginRight: '5px' }}
                                        />
                                        Address Proof
                                    </label>
                                </div>
                            </div>

                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save Customer
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Customer Detail Modal Component
        function CustomerDetailModal({ customer, bookings, customers, setCustomers, onClose }) {
            const [activeTab, setActiveTab] = useState('overview');

            const customerBookings = bookings.filter(b =>
                b.customerEmail === customer.email ||
                b.customerName === customer.name
            );

            const totalSpent = customerBookings.reduce((sum, b) => sum + parseFloat(b.totalAmount || 0), 0);
            const completedBookings = customerBookings.filter(b => b.status === 'Completed').length;
            const activeBookings = customerBookings.filter(b => b.status === 'Active').length;

            const toggleVerification = (field) => {
                const updatedCustomers = customers.map(c =>
                    c.id === customer.id ? { ...c, [field]: !c[field] } : c
                );
                setCustomers(updatedCustomers);
            };

            return (
                <div className="modal-overlay">
                    <div className="modal" style={{ maxWidth: '900px' }}>
                        <div className="modal-header">
                            <h3>{customer.name}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>

                        <div style={{ borderBottom: '1px solid #ddd', marginBottom: '20px' }}>
                            <div style={{ display: 'flex', gap: '10px' }}>
                                <button
                                    onClick={() => setActiveTab('overview')}
                                    style={{
                                        padding: '10px 20px',
                                        border: 'none',
                                        background: activeTab === 'overview' ? '#1a7a8a' : 'transparent',
                                        color: activeTab === 'overview' ? 'white' : '#666',
                                        cursor: 'pointer',
                                        borderRadius: '5px 5px 0 0',
                                        fontWeight: activeTab === 'overview' ? 'bold' : 'normal'
                                    }}
                                >
                                    Overview
                                </button>
                                <button
                                    onClick={() => setActiveTab('bookings')}
                                    style={{
                                        padding: '10px 20px',
                                        border: 'none',
                                        background: activeTab === 'bookings' ? '#1a7a8a' : 'transparent',
                                        color: activeTab === 'bookings' ? 'white' : '#666',
                                        cursor: 'pointer',
                                        borderRadius: '5px 5px 0 0',
                                        fontWeight: activeTab === 'bookings' ? 'bold' : 'normal'
                                    }}
                                >
                                    Booking History
                                </button>
                                <button
                                    onClick={() => setActiveTab('documents')}
                                    style={{
                                        padding: '10px 20px',
                                        border: 'none',
                                        background: activeTab === 'documents' ? '#1a7a8a' : 'transparent',
                                        color: activeTab === 'documents' ? 'white' : '#666',
                                        cursor: 'pointer',
                                        borderRadius: '5px 5px 0 0',
                                        fontWeight: activeTab === 'documents' ? 'bold' : 'normal'
                                    }}
                                >
                                    Documents
                                </button>
                            </div>
                        </div>

                        {activeTab === 'overview' && (
                            <div>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px', marginBottom: '20px' }}>
                                    <div style={{ padding: '20px', background: '#f5f5f5', borderRadius: '8px' }}>
                                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '5px' }}>Total Bookings</div>
                                        <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#1a7a8a' }}>{customerBookings.length}</div>
                                    </div>
                                    <div style={{ padding: '20px', background: '#f5f5f5', borderRadius: '8px' }}>
                                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '5px' }}>Total Spent</div>
                                        <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#1a7a8a' }}>N${totalSpent.toFixed(2)}</div>
                                    </div>
                                    <div style={{ padding: '20px', background: '#f5f5f5', borderRadius: '8px' }}>
                                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '5px' }}>Active Bookings</div>
                                        <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#1a7a8a' }}>{activeBookings}</div>
                                    </div>
                                    <div style={{ padding: '20px', background: '#f5f5f5', borderRadius: '8px' }}>
                                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '5px' }}>Completed</div>
                                        <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#1a7a8a' }}>{completedBookings}</div>
                                    </div>
                                </div>

                                <div style={{ marginTop: '20px' }}>
                                    <h4>Contact Information</h4>
                                    <table style={{ width: '100%', marginTop: '10px' }}>
                                        <tbody>
                                            <tr>
                                                <td style={{ padding: '8px', fontWeight: 'bold', width: '150px' }}>Email:</td>
                                                <td style={{ padding: '8px' }}>{customer.email}</td>
                                            </tr>
                                            <tr style={{ background: '#f9f9f9' }}>
                                                <td style={{ padding: '8px', fontWeight: 'bold' }}>Phone:</td>
                                                <td style={{ padding: '8px' }}>{customer.phone}</td>
                                            </tr>
                                            <tr>
                                                <td style={{ padding: '8px', fontWeight: 'bold' }}>Address:</td>
                                                <td style={{ padding: '8px' }}>{customer.address || 'N/A'}</td>
                                            </tr>
                                            <tr style={{ background: '#f9f9f9' }}>
                                                <td style={{ padding: '8px', fontWeight: 'bold' }}>License Number:</td>
                                                <td style={{ padding: '8px' }}>{customer.licenseNumber || 'N/A'}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'bookings' && (
                            <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                                {customerBookings.length === 0 ? (
                                    <p style={{ textAlign: 'center', color: '#666', padding: '40px' }}>No bookings found for this customer.</p>
                                ) : (
                                    <table className="table">
                                        <thead>
                                            <tr>
                                                <th>Booking ID</th>
                                                <th>Vehicle</th>
                                                <th>Dates</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {customerBookings.map(booking => (
                                                <tr key={booking.id}>
                                                    <td>#{booking.id}</td>
                                                    <td>{booking.vehicleName}</td>
                                                    <td>
                                                        <div style={{ fontSize: '12px' }}>
                                                            <div>{new Date(booking.pickupDate).toLocaleDateString()}</div>
                                                            <div style={{ color: '#666' }}>to {new Date(booking.returnDate).toLocaleDateString()}</div>
                                                        </div>
                                                    </td>
                                                    <td>N${parseFloat(booking.totalAmount).toFixed(2)}</td>
                                                    <td>
                                                        <span className={`status-badge status-${booking.status?.toLowerCase() || 'pending'}`}>
                                                            {booking.status || 'Pending'}
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                )}
                            </div>
                        )}

                        {activeTab === 'documents' && (
                            <div>
                                <div style={{ marginBottom: '20px' }}>
                                    <h4>Document Verification Status</h4>
                                    <p style={{ color: '#666', fontSize: '14px' }}>Click to toggle verification status</p>
                                </div>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>
                                    <div
                                        onClick={() => toggleVerification('licenseVerified')}
                                        style={{
                                            padding: '20px',
                                            background: customer.licenseVerified ? '#e8f5e9' : '#fff3e0',
                                            border: `2px solid ${customer.licenseVerified ? '#4caf50' : '#ff9800'}`,
                                            borderRadius: '8px',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}
                                    >
                                        <div>
                                            <div style={{ fontWeight: 'bold', fontSize: '16px' }}>Driver's License</div>
                                            <div style={{ fontSize: '14px', color: '#666', marginTop: '5px' }}>
                                                {customer.licenseNumber || 'Not provided'}
                                            </div>
                                        </div>
                                        <div style={{ fontSize: '24px' }}>
                                            {customer.licenseVerified ? '‚úì' : '‚óã'}
                                        </div>
                                    </div>

                                    <div
                                        onClick={() => toggleVerification('idVerified')}
                                        style={{
                                            padding: '20px',
                                            background: customer.idVerified ? '#e8f5e9' : '#fff3e0',
                                            border: `2px solid ${customer.idVerified ? '#4caf50' : '#ff9800'}`,
                                            borderRadius: '8px',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}
                                    >
                                        <div>
                                            <div style={{ fontWeight: 'bold', fontSize: '16px' }}>ID/Passport</div>
                                            <div style={{ fontSize: '14px', color: '#666', marginTop: '5px' }}>
                                                National ID or Passport
                                            </div>
                                        </div>
                                        <div style={{ fontSize: '24px' }}>
                                            {customer.idVerified ? '‚úì' : '‚óã'}
                                        </div>
                                    </div>

                                    <div
                                        onClick={() => toggleVerification('addressVerified')}
                                        style={{
                                            padding: '20px',
                                            background: customer.addressVerified ? '#e8f5e9' : '#fff3e0',
                                            border: `2px solid ${customer.addressVerified ? '#4caf50' : '#ff9800'}`,
                                            borderRadius: '8px',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}
                                    >
                                        <div>
                                            <div style={{ fontWeight: 'bold', fontSize: '16px' }}>Address Proof</div>
                                            <div style={{ fontSize: '14px', color: '#666', marginTop: '5px' }}>
                                                Utility bill or bank statement
                                            </div>
                                        </div>
                                        <div style={{ fontSize: '24px' }}>
                                            {customer.addressVerified ? '‚úì' : '‚óã'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="action-buttons" style={{ marginTop: '20px' }}>
                            <button type="button" className="btn btn-secondary" onClick={onClose}>
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Payments Component
        function Payments({ payments, setPayments, bookings, setBookings, showToast, sendNotification }) {
            const [showModal, setShowModal] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');

            const filteredPayments = payments.filter(p => 
                p.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                p.bookingId.toString().includes(searchTerm)
            );

            const addPayment = (payment) => {
                const newPayment = { ...payment, id: Date.now() };
                setPayments([...payments, newPayment]);

                // Update booking balance
                let updatedBooking = null;
                if (payment.bookingId) {
                    setBookings(bookings.map(b => {
                        if (b.id === parseInt(payment.bookingId)) {
                            const currentPaid = parseFloat(b.totalPaid || 0);
                            const newTotalPaid = currentPaid + parseFloat(payment.amount);
                            const outstanding = parseFloat(b.totalAmount) - newTotalPaid;

                            updatedBooking = {
                                ...b,
                                totalPaid: newTotalPaid.toFixed(2),
                                outstandingBalance: outstanding.toFixed(2)
                            };
                            return updatedBooking;
                        }
                        return b;
                    }));

                    // Send payment receipt notification
                    if (sendNotification && updatedBooking) {
                        const receiptMessage = `Dear ${payment.customerName},\n\nThank you for your payment!\n\nPayment Receipt:\n- Receipt ID: #${newPayment.id}\n- Booking ID: #${payment.bookingId}\n- Amount Paid: N$${parseFloat(payment.amount).toFixed(2)}\n- Payment Method: ${payment.method}\n- Date: ${new Date(payment.date).toLocaleDateString()}\n\nBooking Balance:\n- Total Amount: N$${updatedBooking.totalAmount}\n- Total Paid: N$${updatedBooking.totalPaid}\n- Outstanding Balance: N$${updatedBooking.outstandingBalance}\n\n${parseFloat(updatedBooking.outstandingBalance) <= 0 ? '‚úì Your booking is fully paid!' : 'Remaining balance to be paid before pickup.'}\n\nThank you for your business!\n\nKetu Kakahala Vehicle Rentals`;

                        sendNotification(
                            'both',
                            { name: payment.customerName, email: updatedBooking.customerEmail, phone: updatedBooking.customerPhone },
                            'Payment Receipt Confirmation',
                            receiptMessage,
                            parseInt(payment.bookingId)
                        );
                    }
                }

                if (showToast) showToast('success', 'Payment Recorded', `Payment of N$${payment.amount} has been recorded successfully.`);
                setShowModal(false);
            };

            return (
                <div>
                    <div className="header">
                        <h2>Payment Management</h2>
                        <p>Track rental payments</p>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Search payments..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button 
                                className="btn btn-primary"
                                onClick={() => setShowModal(true)}
                            >
                                ‚ûï Record Payment
                            </button>
                        </div>

                        {filteredPayments.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üí∞</div>
                                <p>No payments recorded</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Payment ID</th>
                                        <th>Booking ID</th>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredPayments.map(payment => (
                                        <tr key={payment.id}>
                                            <td>#{payment.id}</td>
                                            <td>#{payment.bookingId}</td>
                                            <td>{payment.customerName}</td>
                                            <td>${payment.amount}</td>
                                            <td>{payment.method}</td>
                                            <td>{new Date(payment.date).toLocaleDateString()}</td>
                                            <td>
                                                <span className="badge badge-active">
                                                    {payment.status}
                                                </span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {showModal && (
                        <PaymentModal 
                            bookings={bookings}
                            onSave={addPayment}
                            onClose={() => setShowModal(false)}
                        />
                    )}
                </div>
            );
        }

        // Payment Modal Component
        function PaymentModal({ bookings, onSave, onClose }) {
            const [formData, setFormData] = useState({
                bookingId: '',
                customerName: '',
                amount: '',
                method: 'cash',
                date: new Date().toISOString().split('T')[0],
                status: 'completed'
            });

            const handleBookingChange = (bookingId) => {
                const booking = bookings.find(b => b.id === parseInt(bookingId));
                if (booking) {
                    setFormData({
                        ...formData,
                        bookingId: booking.id,
                        customerName: booking.customerName,
                        amount: booking.totalAmount
                    });
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h3>Record Payment</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Booking</label>
                                <select 
                                    className="form-control"
                                    value={formData.bookingId}
                                    onChange={(e) => handleBookingChange(e.target.value)}
                                    required
                                >
                                    <option value="">Select a booking</option>
                                    {bookings.map(booking => (
                                        <option key={booking.id} value={booking.id}>
                                            #{booking.id} - {booking.customerName} - ${booking.totalAmount}
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Amount ($)</label>
                                    <input 
                                        type="number"
                                        className="form-control"
                                        value={formData.amount}
                                        onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                        required
                                        step="0.01"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Payment Method</label>
                                    <select 
                                        className="form-control"
                                        value={formData.method}
                                        onChange={(e) => setFormData({...formData, method: e.target.value})}
                                    >
                                        <option value="cash">Cash</option>
                                        <option value="card">Card</option>
                                        <option value="bank_transfer">Bank Transfer</option>
                                        <option value="mobile_money">Mobile Money</option>
                                    </select>
                                </div>
                            </div>
                            <div className="form-group">
                                <label>Payment Date</label>
                                <input 
                                    type="date"
                                    className="form-control"
                                    value={formData.date}
                                    onChange={(e) => setFormData({...formData, date: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Record Payment
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Reports Component
        function Reports({ vehicles, bookings, payments, customers }) {
            const [selectedReport, setSelectedReport] = useState(null);
            const [dateRange, setDateRange] = useState({
                startDate: new Date(new Date().setDate(new Date().getDate() - 30)).toISOString().split('T')[0],
                endDate: new Date().toISOString().split('T')[0]
            });

            const reportTypes = [
                {
                    id: 'analytics-dashboard',
                    icon: 'üìä',
                    title: 'Analytics Dashboard',
                    description: 'Visual analytics with revenue trends, vehicle utilization, popular vehicles, and peak booking periods.'
                },
                {
                    id: 'revenue-returns',
                    icon: 'üí∞',
                    title: 'Revenue Based on Returns',
                    description: 'Shows an overview of revenues based on completed Reservations (returned vehicles).'
                },
                {
                    id: 'revenue-payment',
                    icon: 'üí≥',
                    title: 'Revenue per Payment Option',
                    description: 'Shows an overview of revenues per payment option.'
                },
                {
                    id: 'monthly-overview',
                    icon: 'üìÖ',
                    title: 'Monthly Overview',
                    description: 'Shows an overview of revenues per month.'
                },
                {
                    id: 'location-performance',
                    icon: 'üìç',
                    title: 'Location Performance',
                    description: 'Shows an overview of reservations between a range of dates.'
                },
                {
                    id: 'end-of-day',
                    icon: 'üåÖ',
                    title: 'End of the Day Overview',
                    description: 'Shows an overview of revenues until end of the day.'
                },
                {
                    id: 'daily-manifest',
                    icon: 'üìã',
                    title: 'Daily Manifest',
                    description: 'A daily report of all pickups, returns, overdues and scheduled repairs'
                },
                {
                    id: 'sales-tax',
                    icon: 'üßæ',
                    title: 'Sales Tax',
                    description: 'A Sales Tax report of all Reservations'
                },
                {
                    id: 'additional-charges',
                    icon: '‚ûï',
                    title: 'Additional Charges',
                    description: 'Shows an overview of Additional Charges and their sold days.'
                },
                {
                    id: 'damages',
                    icon: 'üîß',
                    title: 'Damages',
                    description: 'Shows an overview of damage charges in reservations'
                },
                {
                    id: 'cancellations',
                    icon: '‚ùå',
                    title: 'Cancellations',
                    description: 'Shows an overview of cancelled Reservations'
                },
                {
                    id: 'extensions',
                    icon: '‚è∞',
                    title: 'Extensions Report',
                    description: 'Show an overview of the extensions'
                },
                {
                    id: 'commissions',
                    icon: 'üíº',
                    title: 'Commissions per Commission Partner',
                    description: 'Commission report for Commission Partners based on all reservations'
                }
            ];

            if (selectedReport) {
                if (selectedReport === 'analytics-dashboard') {
                    return (
                        <AnalyticsDashboard
                            bookings={bookings}
                            payments={payments}
                            vehicles={vehicles}
                            onBack={() => setSelectedReport(null)}
                        />
                    );
                }
                return (
                    <ReportView
                        reportType={selectedReport}
                        bookings={bookings}
                        payments={payments}
                        vehicles={vehicles}
                        dateRange={dateRange}
                        onBack={() => setSelectedReport(null)}
                    />
                );
            }

            return (
                <div>
                    <div className="header">
                        <h2>Reports</h2>
                        <p>Comprehensive business analytics and reporting</p>
                    </div>

                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',
                        gap: '20px',
                        marginBottom: '30px'
                    }}>
                        {reportTypes.map(report => (
                            <div
                                key={report.id}
                                onClick={() => setSelectedReport(report.id)}
                                style={{
                                    backgroundColor: 'white',
                                    padding: '25px',
                                    borderRadius: '12px',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                                    border: '2px solid transparent'
                                }}
                                onMouseEnter={(e) => {
                                    e.currentTarget.style.transform = 'translateY(-4px)';
                                    e.currentTarget.style.boxShadow = '0 6px 20px rgba(26, 122, 138, 0.15)';
                                    e.currentTarget.style.borderColor = 'var(--primary-teal)';
                                }}
                                onMouseLeave={(e) => {
                                    e.currentTarget.style.transform = 'translateY(0)';
                                    e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                                    e.currentTarget.style.borderColor = 'transparent';
                                }}
                            >
                                <div style={{
                                    fontSize: '32px',
                                    marginBottom: '15px'
                                }}>
                                    {report.icon}
                                </div>
                                <h3 style={{
                                    fontSize: '18px',
                                    color: 'var(--text-dark)',
                                    marginBottom: '10px'
                                }}>
                                    {report.title}
                                </h3>
                                <p style={{
                                    fontSize: '14px',
                                    color: 'var(--text-light)',
                                    lineHeight: '1.5'
                                }}>
                                    {report.description}
                                </p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Analytics Dashboard Component
        function AnalyticsDashboard({ bookings, payments, vehicles, transfers, onBack }) {
            const revenueChartRef = useRef(null);
            const utilizationChartRef = useRef(null);
            const popularVehicleChartRef = useRef(null);
            const bookingPeriodChartRef = useRef(null);

            useEffect(() => {
                // Revenue Trends Chart
                if (revenueChartRef.current) {
                    const ctx = revenueChartRef.current.getContext('2d');

                    // Calculate monthly revenue
                    const monthlyRevenue = {};
                    const last6Months = [];
                    for (let i = 5; i >= 0; i--) {
                        const date = new Date();
                        date.setMonth(date.getMonth() - i);
                        const monthKey = date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                        monthlyRevenue[monthKey] = 0;
                        last6Months.push(monthKey);
                    }

                    bookings.forEach(b => {
                        const monthKey = new Date(b.startDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                        if (monthlyRevenue.hasOwnProperty(monthKey)) {
                            monthlyRevenue[monthKey] += parseFloat(b.totalAmount || 0);
                        }
                    });

                    const revenueChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: last6Months,
                            datasets: [{
                                label: 'Revenue (N$)',
                                data: last6Months.map(month => monthlyRevenue[month]),
                                borderColor: 'rgb(26, 122, 138)',
                                backgroundColor: 'rgba(26, 122, 138, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                title: {
                                    display: true,
                                    text: 'Revenue Trends (Last 6 Months)',
                                    font: { size: 16 }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return 'N$ ' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });

                    return () => revenueChart.destroy();
                }
            }, [bookings]);

            useEffect(() => {
                // Vehicle Utilization Chart
                if (utilizationChartRef.current) {
                    const ctx = utilizationChartRef.current.getContext('2d');

                    const vehicleBookings = {};
                    vehicles.forEach(v => {
                        vehicleBookings[v.name] = bookings.filter(b => b.vehicleId === v.id).length;
                    });

                    const utilizationChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(vehicleBookings),
                            datasets: [{
                                label: 'Number of Bookings',
                                data: Object.values(vehicleBookings),
                                backgroundColor: 'rgba(255, 140, 66, 0.7)',
                                borderColor: 'rgb(255, 140, 66)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Vehicle Utilization',
                                    font: { size: 16 }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            }
                        }
                    });

                    return () => utilizationChart.destroy();
                }
            }, [vehicles, bookings]);

            useEffect(() => {
                // Popular Vehicles Chart
                if (popularVehicleChartRef.current) {
                    const ctx = popularVehicleChartRef.current.getContext('2d');

                    const vehicleRevenue = {};
                    vehicles.forEach(v => {
                        const vehicleBookingRevenue = bookings
                            .filter(b => b.vehicleId === v.id)
                            .reduce((sum, b) => sum + parseFloat(b.totalAmount || 0), 0);
                        vehicleRevenue[v.name] = vehicleBookingRevenue;
                    });

                    const sortedVehicles = Object.entries(vehicleRevenue)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 10);

                    const popularChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: sortedVehicles.map(v => v[0]),
                            datasets: [{
                                label: 'Revenue (N$)',
                                data: sortedVehicles.map(v => v[1]),
                                backgroundColor: [
                                    'rgba(26, 122, 138, 0.8)',
                                    'rgba(255, 140, 66, 0.8)',
                                    'rgba(39, 174, 96, 0.8)',
                                    'rgba(243, 156, 18, 0.8)',
                                    'rgba(231, 76, 60, 0.8)',
                                    'rgba(155, 89, 182, 0.8)',
                                    'rgba(52, 152, 219, 0.8)',
                                    'rgba(241, 196, 15, 0.8)',
                                    'rgba(46, 204, 113, 0.8)',
                                    'rgba(230, 126, 34, 0.8)'
                                ],
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        boxWidth: 15,
                                        padding: 10
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Top 10 Vehicles by Revenue',
                                    font: { size: 16 }
                                }
                            }
                        }
                    });

                    return () => popularChart.destroy();
                }
            }, [vehicles, bookings]);

            useEffect(() => {
                // Peak Booking Periods Chart
                if (bookingPeriodChartRef.current) {
                    const ctx = bookingPeriodChartRef.current.getContext('2d');

                    const dayOfWeekBookings = {
                        'Sunday': 0,
                        'Monday': 0,
                        'Tuesday': 0,
                        'Wednesday': 0,
                        'Thursday': 0,
                        'Friday': 0,
                        'Saturday': 0
                    };

                    bookings.forEach(b => {
                        const dayName = new Date(b.startDate).toLocaleDateString('en-US', { weekday: 'long' });
                        dayOfWeekBookings[dayName]++;
                    });

                    const periodChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(dayOfWeekBookings),
                            datasets: [{
                                label: 'Number of Bookings',
                                data: Object.values(dayOfWeekBookings),
                                backgroundColor: 'rgba(26, 122, 138, 0.7)',
                                borderColor: 'rgb(26, 122, 138)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Peak Booking Days',
                                    font: { size: 16 }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            }
                        }
                    });

                    return () => periodChart.destroy();
                }
            }, [bookings]);

            // Calculate summary stats
            const totalRevenue = bookings.reduce((sum, b) => sum + parseFloat(b.totalAmount || 0), 0);
            const totalBookings = bookings.length;
            const activeBookings = bookings.filter(b => b.status === 'active').length;
            const completedBookings = bookings.filter(b => b.status === 'completed').length;

            return (
                <div>
                    <div className="header">
                        <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                            <button
                                className="btn btn-secondary"
                                onClick={onBack}
                                style={{ padding: '10px 20px' }}
                            >
                                ‚Üê Back to Reports
                            </button>
                            <div>
                                <h2>Analytics Dashboard</h2>
                                <p>Visual insights and business analytics</p>
                            </div>
                        </div>
                    </div>

                    {/* Summary Cards */}
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                        gap: '20px',
                        marginBottom: '30px'
                    }}>
                        <div className="card" style={{ padding: '20px', textAlign: 'center' }}>
                            <div style={{ fontSize: '32px', color: 'var(--primary-teal)', marginBottom: '10px' }}>üí∞</div>
                            <h3 style={{ fontSize: '24px', color: 'var(--primary-teal)', marginBottom: '5px' }}>
                                N$ {totalRevenue.toLocaleString()}
                            </h3>
                            <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Total Revenue</p>
                        </div>
                        <div className="card" style={{ padding: '20px', textAlign: 'center' }}>
                            <div style={{ fontSize: '32px', color: 'var(--primary-orange)', marginBottom: '10px' }}>üìÖ</div>
                            <h3 style={{ fontSize: '24px', color: 'var(--primary-orange)', marginBottom: '5px' }}>
                                {totalBookings}
                            </h3>
                            <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Total Bookings</p>
                        </div>
                        <div className="card" style={{ padding: '20px', textAlign: 'center' }}>
                            <div style={{ fontSize: '32px', color: 'var(--success)', marginBottom: '10px' }}>‚úì</div>
                            <h3 style={{ fontSize: '24px', color: 'var(--success)', marginBottom: '5px' }}>
                                {completedBookings}
                            </h3>
                            <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Completed</p>
                        </div>
                        <div className="card" style={{ padding: '20px', textAlign: 'center' }}>
                            <div style={{ fontSize: '32px', color: 'var(--warning)', marginBottom: '10px' }}>‚ö°</div>
                            <h3 style={{ fontSize: '24px', color: 'var(--warning)', marginBottom: '5px' }}>
                                {activeBookings}
                            </h3>
                            <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Active</p>
                        </div>
                    </div>

                    {/* Charts Grid */}
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fit, minmax(450px, 1fr))',
                        gap: '20px'
                    }}>
                        <div className="card" style={{ padding: '20px' }}>
                            <div style={{ height: '300px' }}>
                                <canvas ref={revenueChartRef}></canvas>
                            </div>
                        </div>
                        <div className="card" style={{ padding: '20px' }}>
                            <div style={{ height: '300px' }}>
                                <canvas ref={utilizationChartRef}></canvas>
                            </div>
                        </div>
                        <div className="card" style={{ padding: '20px' }}>
                            <div style={{ height: '300px' }}>
                                <canvas ref={popularVehicleChartRef}></canvas>
                            </div>
                        </div>
                        <div className="card" style={{ padding: '20px' }}>
                            <div style={{ height: '300px' }}>
                                <canvas ref={bookingPeriodChartRef}></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Report View Component
        function ReportView({ reportType, bookings, payments, vehicles, dateRange, onBack }) {
            const getReportTitle = () => {
                const titles = {
                    'revenue-returns': 'Revenue Based on Returns',
                    'revenue-payment': 'Revenue per Payment Option',
                    'monthly-overview': 'Monthly Overview',
                    'location-performance': 'Location Performance',
                    'end-of-day': 'End of the Day Overview',
                    'daily-manifest': 'Daily Manifest',
                    'sales-tax': 'Sales Tax Report',
                    'additional-charges': 'Additional Charges',
                    'damages': 'Damages Report',
                    'cancellations': 'Cancellations Report',
                    'extensions': 'Extensions Report',
                    'commissions': 'Commissions Report'
                };
                return titles[reportType];
            };

            const generateReportData = () => {
                const completedBookings = bookings.filter(b => b.status === 'completed');
                
                switch(reportType) {
                    case 'revenue-returns':
                        return {
                            totalRevenue: completedBookings.reduce((sum, b) => sum + parseFloat(b.totalAmount || 0), 0),
                            totalBookings: completedBookings.length,
                            data: completedBookings
                        };
                    
                    case 'revenue-payment':
                        const paymentBreakdown = {};
                        payments.forEach(p => {
                            paymentBreakdown[p.method] = (paymentBreakdown[p.method] || 0) + parseFloat(p.amount || 0);
                        });
                        return { paymentBreakdown };
                    
                    case 'monthly-overview':
                        const monthlyData = {};
                        bookings.forEach(b => {
                            const month = new Date(b.startDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                            monthlyData[month] = (monthlyData[month] || 0) + parseFloat(b.totalAmount || 0);
                        });
                        return { monthlyData };
                    
                    case 'daily-manifest':
                        const today = new Date().toDateString();
                        const todayPickups = bookings.filter(b => new Date(b.startDate).toDateString() === today);
                        const todayReturns = bookings.filter(b => new Date(b.endDate).toDateString() === today);
                        const overdues = bookings.filter(b => 
                            new Date(b.endDate) < new Date() && b.status === 'active'
                        );
                        return { todayPickups, todayReturns, overdues };
                    
                    case 'cancellations':
                        const cancelled = bookings.filter(b => b.status === 'cancelled');
                        return { cancelled };
                    
                    case 'end-of-day':
                        const todayPayments = payments.filter(p => 
                            new Date(p.date).toDateString() === new Date().toDateString()
                        );
                        const todayRevenue = todayPayments.reduce((sum, p) => sum + parseFloat(p.amount || 0), 0);
                        return { todayRevenue, todayPayments: todayPayments.length };
                    
                    default:
                        return { message: 'Report data coming soon' };
                }
            };

            const reportData = generateReportData();

            const exportReport = () => {
                const csvContent = generateCSV();
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${reportType}-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            const generateCSV = () => {
                let csv = '';
                switch(reportType) {
                    case 'revenue-returns':
                        csv = 'Booking ID,Customer,Vehicle,Start Date,End Date,Amount\n';
                        reportData.data.forEach(b => {
                            csv += `${b.id},${b.customerName},${b.vehicleName},${b.startDate},${b.endDate},${b.totalAmount}\n`;
                        });
                        break;
                    case 'revenue-payment':
                        csv = 'Payment Method,Total Amount\n';
                        Object.entries(reportData.paymentBreakdown).forEach(([method, amount]) => {
                            csv += `${method},${amount}\n`;
                        });
                        break;
                    default:
                        csv = 'Report data\n';
                }
                return csv;
            };

            return (
                <div>
                    <div className="header">
                        <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                            <button 
                                className="btn btn-secondary"
                                onClick={onBack}
                                style={{ padding: '10px 20px' }}
                            >
                                ‚Üê Back to Reports
                            </button>
                            <div>
                                <h2>{getReportTitle()}</h2>
                                <p>Generated on {new Date().toLocaleDateString()}</p>
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <div style={{ display: 'flex', gap: '15px', alignItems: 'center' }}>
                                <input 
                                    type="date"
                                    className="form-control"
                                    style={{ width: 'auto' }}
                                />
                                <span>to</span>
                                <input 
                                    type="date"
                                    className="form-control"
                                    style={{ width: 'auto' }}
                                />
                            </div>
                            <button className="btn btn-primary" onClick={exportReport}>
                                üìä Export to CSV
                            </button>
                        </div>

                        {reportType === 'revenue-returns' && (
                            <div>
                                <div className="stats-grid" style={{ marginBottom: '30px' }}>
                                    <div className="stat-card">
                                        <h3>Total Revenue</h3>
                                        <p>N${reportData.totalRevenue.toFixed(2)}</p>
                                    </div>
                                    <div className="stat-card orange">
                                        <h3>Completed Bookings</h3>
                                        <p>{reportData.totalBookings}</p>
                                    </div>
                                    <div className="stat-card">
                                        <h3>Average Booking Value</h3>
                                        <p>N${reportData.totalBookings > 0 ? (reportData.totalRevenue / reportData.totalBookings).toFixed(2) : '0.00'}</p>
                                    </div>
                                </div>
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Booking ID</th>
                                            <th>Customer</th>
                                            <th>Vehicle</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {reportData.data.map(booking => (
                                            <tr key={booking.id}>
                                                <td>#{booking.id}</td>
                                                <td>{booking.customerName}</td>
                                                <td>{booking.vehicleName}</td>
                                                <td>{new Date(booking.startDate).toLocaleDateString()}</td>
                                                <td>{new Date(booking.endDate).toLocaleDateString()}</td>
                                                <td>N${booking.totalAmount}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {reportType === 'revenue-payment' && (
                            <div>
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Payment Method</th>
                                            <th>Total Amount</th>
                                            <th>Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {Object.entries(reportData.paymentBreakdown).map(([method, amount]) => {
                                            const total = Object.values(reportData.paymentBreakdown).reduce((a, b) => a + b, 0);
                                            const percentage = ((amount / total) * 100).toFixed(1);
                                            return (
                                                <tr key={method}>
                                                    <td style={{ textTransform: 'capitalize' }}>{method.replace('_', ' ')}</td>
                                                    <td>N${amount.toFixed(2)}</td>
                                                    <td>{percentage}%</td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {reportType === 'monthly-overview' && (
                            <div>
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Month</th>
                                            <th>Revenue</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {Object.entries(reportData.monthlyData).map(([month, revenue]) => (
                                            <tr key={month}>
                                                <td>{month}</td>
                                                <td>N${revenue.toFixed(2)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {reportType === 'daily-manifest' && (
                            <div>
                                <h3 style={{ marginBottom: '20px' }}>Today's Schedule</h3>
                                
                                <h4 style={{ color: 'var(--primary-teal)', marginTop: '20px' }}>Pickups ({reportData.todayPickups.length})</h4>
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Booking ID</th>
                                            <th>Customer</th>
                                            <th>Vehicle</th>
                                            <th>Time</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {reportData.todayPickups.map(b => (
                                            <tr key={b.id}>
                                                <td>#{b.id}</td>
                                                <td>{b.customerName}</td>
                                                <td>{b.vehicleName}</td>
                                                <td>{new Date(b.startDate).toLocaleTimeString()}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>

                                <h4 style={{ color: 'var(--primary-orange)', marginTop: '30px' }}>Returns ({reportData.todayReturns.length})</h4>
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Booking ID</th>
                                            <th>Customer</th>
                                            <th>Vehicle</th>
                                            <th>Time</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {reportData.todayReturns.map(b => (
                                            <tr key={b.id}>
                                                <td>#{b.id}</td>
                                                <td>{b.customerName}</td>
                                                <td>{b.vehicleName}</td>
                                                <td>{new Date(b.endDate).toLocaleTimeString()}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>

                                {reportData.overdues.length > 0 && (
                                    <>
                                        <h4 style={{ color: 'var(--danger)', marginTop: '30px' }}>Overdues ({reportData.overdues.length})</h4>
                                        <table className="table">
                                            <thead>
                                                <tr>
                                                    <th>Booking ID</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Due Date</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {reportData.overdues.map(b => (
                                                    <tr key={b.id}>
                                                        <td>#{b.id}</td>
                                                        <td>{b.customerName}</td>
                                                        <td>{b.vehicleName}</td>
                                                        <td style={{ color: 'var(--danger)' }}>{new Date(b.endDate).toLocaleDateString()}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </>
                                )}
                            </div>
                        )}

                        {reportType === 'end-of-day' && (
                            <div>
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <h3>Today's Revenue</h3>
                                        <p>N${reportData.todayRevenue.toFixed(2)}</p>
                                    </div>
                                    <div className="stat-card orange">
                                        <h3>Payments Received</h3>
                                        <p>{reportData.todayPayments}</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {reportType === 'cancellations' && (
                            <div>
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Booking ID</th>
                                            <th>Customer</th>
                                            <th>Vehicle</th>
                                            <th>Original Dates</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {reportData.cancelled.map(b => (
                                            <tr key={b.id}>
                                                <td>#{b.id}</td>
                                                <td>{b.customerName}</td>
                                                <td>{b.vehicleName}</td>
                                                <td>{new Date(b.startDate).toLocaleDateString()} - {new Date(b.endDate).toLocaleDateString()}</td>
                                                <td>N${b.totalAmount}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {!['revenue-returns', 'revenue-payment', 'monthly-overview', 'daily-manifest', 'end-of-day', 'cancellations'].includes(reportType) && (
                            <div className="empty-state">
                                <div className="empty-state-icon">üìä</div>
                                <p>{reportData.message || 'Report functionality coming soon'}</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Maintenance Component
        function Maintenance({ maintenance, setMaintenance, vehicles }) {
            const [showModal, setShowModal] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');

            const filteredMaintenance = maintenance.filter(m => 
                m.vehicleName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                m.description.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const addMaintenance = (record) => {
                setMaintenance([...maintenance, { ...record, id: Date.now() }]);
                setShowModal(false);
            };

            return (
                <div>
                    <div className="header">
                        <h2>Maintenance Scheduling</h2>
                        <p>Track vehicle maintenance</p>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Search maintenance records..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button 
                                className="btn btn-primary"
                                onClick={() => setShowModal(true)}
                            >
                                ‚ûï Schedule Maintenance
                            </button>
                        </div>

                        {filteredMaintenance.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üîß</div>
                                <p>No maintenance records</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Vehicle</th>
                                        <th>Description</th>
                                        <th>Date</th>
                                        <th>Cost</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredMaintenance.map(record => (
                                        <tr key={record.id}>
                                            <td>{record.vehicleName}</td>
                                            <td>{record.description}</td>
                                            <td>{new Date(record.date).toLocaleDateString()}</td>
                                            <td>${record.cost}</td>
                                            <td>
                                                <span className={`badge badge-${record.status === 'completed' ? 'completed' : 'active'}`}>
                                                    {record.status}
                                                </span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {showModal && (
                        <MaintenanceModal 
                            vehicles={vehicles}
                            onSave={addMaintenance}
                            onClose={() => setShowModal(false)}
                        />
                    )}
                </div>
            );
        }

        // Maintenance Modal Component
        function MaintenanceModal({ vehicles, onSave, onClose }) {
            const [formData, setFormData] = useState({
                vehicleId: '',
                vehicleName: '',
                description: '',
                date: new Date().toISOString().split('T')[0],
                cost: '',
                status: 'scheduled'
            });

            const handleVehicleChange = (vehicleId) => {
                const vehicle = vehicles.find(v => v.id === parseInt(vehicleId));
                if (vehicle) {
                    setFormData({
                        ...formData,
                        vehicleId: vehicle.id,
                        vehicleName: `${vehicle.make} ${vehicle.model}`
                    });
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h3>Schedule Maintenance</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Vehicle</label>
                                <select 
                                    className="form-control"
                                    value={formData.vehicleId}
                                    onChange={(e) => handleVehicleChange(e.target.value)}
                                    required
                                >
                                    <option value="">Select a vehicle</option>
                                    {vehicles.map(vehicle => (
                                        <option key={vehicle.id} value={vehicle.id}>
                                            {vehicle.make} {vehicle.model} - {vehicle.licensePlate}
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="form-group">
                                <label>Description</label>
                                <textarea 
                                    className="form-control"
                                    value={formData.description}
                                    onChange={(e) => setFormData({...formData, description: e.target.value})}
                                    required
                                    rows="3"
                                />
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Date</label>
                                    <input 
                                        type="date"
                                        className="form-control"
                                        value={formData.date}
                                        onChange={(e) => setFormData({...formData, date: e.target.value})}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Cost ($)</label>
                                    <input 
                                        type="number"
                                        className="form-control"
                                        value={formData.cost}
                                        onChange={(e) => setFormData({...formData, cost: e.target.value})}
                                        required
                                        step="0.01"
                                    />
                                </div>
                            </div>
                            <div className="form-group">
                                <label>Status</label>
                                <select 
                                    className="form-control"
                                    value={formData.status}
                                    onChange={(e) => setFormData({...formData, status: e.target.value})}
                                >
                                    <option value="scheduled">Scheduled</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save Record
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Documents Component
        function Documents({ documents, setDocuments, bookings, customers, vehicles }) {
            const [showUploadModal, setShowUploadModal] = useState(false);

            const handleFileUpload = (e) => {
                const files = Array.from(e.target.files);
                const newDocuments = files.map(file => ({
                    id: Date.now() + Math.random(),
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    uploadDate: new Date().toISOString(),
                    category: 'general'
                }));
                setDocuments([...documents, ...newDocuments]);
                setShowUploadModal(false);
            };

            const exportData = (type) => {
                let data, filename;
                
                switch(type) {
                    case 'vehicles':
                        data = vehicles;
                        filename = 'vehicles';
                        break;
                    case 'bookings':
                        data = bookings;
                        filename = 'bookings';
                        break;
                    case 'customers':
                        data = customers;
                        filename = 'customers';
                        break;
                    default:
                        return;
                }

                const csv = [
                    Object.keys(data[0] || {}).join(','),
                    ...data.map(item => Object.values(item).join(','))
                ].join('\n');

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${filename}-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            return (
                <div>
                    <div className="header">
                        <h2>Document Management</h2>
                        <p>Upload and export documents</p>
                    </div>

                    <div className="card">
                        <div className="card-title">Export Data</div>
                        <div style={{display: 'flex', gap: '15px', marginBottom: '30px'}}>
                            <button 
                                className="btn btn-primary"
                                onClick={() => exportData('vehicles')}
                            >
                                üìä Export Vehicles
                            </button>
                            <button 
                                className="btn btn-primary"
                                onClick={() => exportData('bookings')}
                            >
                                üìä Export Bookings
                            </button>
                            <button 
                                className="btn btn-primary"
                                onClick={() => exportData('customers')}
                            >
                                üìä Export Customers
                            </button>
                        </div>
                    </div>

                    <div className="card">
                        <div className="card-title">Uploaded Documents</div>
                        <div style={{marginBottom: '20px'}}>
                            <button 
                                className="btn btn-secondary"
                                onClick={() => setShowUploadModal(true)}
                            >
                                üì§ Upload Document
                            </button>
                        </div>

                        {documents.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üìÑ</div>
                                <p>No documents uploaded</p>
                            </div>
                        ) : (
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Size</th>
                                        <th>Upload Date</th>
                                        <th>Category</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {documents.map(doc => (
                                        <tr key={doc.id}>
                                            <td>{doc.name}</td>
                                            <td>{doc.type}</td>
                                            <td>{(doc.size / 1024).toFixed(2)} KB</td>
                                            <td>{new Date(doc.uploadDate).toLocaleDateString()}</td>
                                            <td>{doc.category}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {showUploadModal && (
                        <div className="modal-overlay">
                            <div className="modal">
                                <div className="modal-header">
                                    <h3>Upload Documents</h3>
                                    <button className="close-btn" onClick={() => setShowUploadModal(false)}>√ó</button>
                                </div>
                                <div className="file-upload">
                                    <p style={{fontSize: '48px', marginBottom: '15px'}}>üìÅ</p>
                                    <p style={{marginBottom: '15px'}}>Drag and drop files here or click to browse</p>
                                    <input 
                                        type="file"
                                        multiple
                                        onChange={handleFileUpload}
                                        style={{display: 'none'}}
                                        id="file-input"
                                    />
                                    <label htmlFor="file-input" className="btn btn-primary" style={{cursor: 'pointer'}}>
                                        Choose Files
                                    </label>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Users Component
        function Users({ users, setUsers, userRoles }) {
            const [showModal, setShowModal] = useState(false);
            const [editingUser, setEditingUser] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterStatus, setFilterStatus] = useState('enabled');

            const filteredUsers = users.filter(u => {
                const matchesSearch = u.fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     u.username.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     u.email.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesStatus = filterStatus === 'all' || 
                                     (filterStatus === 'enabled' && u.enabled) ||
                                     (filterStatus === 'disabled' && !u.enabled);
                return matchesSearch && matchesStatus;
            });

            const addUser = (user) => {
                if (editingUser) {
                    setUsers(users.map(u => u.id === editingUser.id ? user : u));
                } else {
                    setUsers([...users, { ...user, id: Date.now() }]);
                }
                setShowModal(false);
                setEditingUser(null);
            };

            const deleteUser = (id) => {
                if (confirm('Are you sure you want to delete this user?')) {
                    setUsers(users.filter(u => u.id !== id));
                }
            };

            const toggleUserStatus = (id) => {
                setUsers(users.map(u => u.id === id ? {...u, enabled: !u.enabled} : u));
            };

            return (
                <div>
                    <div className="header" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <div>
                            <h2>üë• Users</h2>
                            <p>Manage system users and their access</p>
                        </div>
                        <button 
                            className="btn btn-primary"
                            onClick={() => {
                                setEditingUser(null);
                                setShowModal(true);
                            }}
                        >
                            ‚ûï Add User
                        </button>
                    </div>

                    {/* Status Filter Tabs */}
                    <div style={{
                        backgroundColor: 'white',
                        padding: '15px 20px',
                        borderRadius: '12px',
                        marginBottom: '20px',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                        display: 'flex',
                        gap: '10px'
                    }}>
                        {['enabled', 'disabled', 'all'].map(status => (
                            <button
                                key={status}
                                onClick={() => setFilterStatus(status)}
                                style={{
                                    padding: '8px 16px',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer',
                                    backgroundColor: filterStatus === status ? 'var(--primary-teal)' : '#f0f0f0',
                                    color: filterStatus === status ? 'white' : 'var(--text-dark)',
                                    fontSize: '14px',
                                    fontWeight: filterStatus === status ? '500' : 'normal',
                                    textTransform: 'capitalize'
                                }}
                            >
                                {status}
                            </button>
                        ))}
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Start typing a name..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button className="btn btn-secondary">üíæ Save this search</button>
                        </div>

                        {filterStatus === 'enabled' && (
                            <div style={{ 
                                padding: '10px 15px', 
                                backgroundColor: '#e8f4f6', 
                                borderRadius: '6px', 
                                marginBottom: '15px',
                                fontSize: '14px',
                                color: 'var(--text-dark)'
                            }}>
                                <strong>Enabled</strong> equals Yes <span style={{ 
                                    backgroundColor: 'var(--primary-teal)', 
                                    color: 'white', 
                                    padding: '2px 8px', 
                                    borderRadius: '4px',
                                    marginLeft: '5px',
                                    cursor: 'pointer'
                                }}>√ó</span>
                            </div>
                        )}

                        <table className="table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Full Name</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Mobile Number</th>
                                    <th>Roles</th>
                                    <th>Enabled</th>
                                    <th>Last Activity</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredUsers.map(user => (
                                    <tr key={user.id}>
                                        <td>{user.id}</td>
                                        <td style={{ color: 'var(--primary-teal)' }}>{user.fullName}</td>
                                        <td>{user.username}</td>
                                        <td>{user.email}</td>
                                        <td>{user.mobileNumber || '-'}</td>
                                        <td>{user.roles.join(', ')}</td>
                                        <td>
                                            <span className={`badge ${user.enabled ? 'badge-active' : 'badge-maintenance'}`}>
                                                {user.enabled ? 'Yes' : 'No'}
                                            </span>
                                        </td>
                                        <td>{user.lastActivity}</td>
                                        <td>
                                            <div style={{ display: 'flex', gap: '5px' }}>
                                                <button 
                                                    className="btn btn-primary"
                                                    style={{ padding: '6px 12px', fontSize: '12px' }}
                                                    onClick={() => {
                                                        setEditingUser(user);
                                                        setShowModal(true);
                                                    }}
                                                >
                                                    ‚úèÔ∏è
                                                </button>
                                                <button 
                                                    className="btn btn-danger"
                                                    style={{ padding: '6px 12px', fontSize: '12px' }}
                                                    onClick={() => deleteUser(user.id)}
                                                >
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>

                        <div style={{ marginTop: '15px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                <span>Show</span>
                                <select style={{ padding: '5px', borderRadius: '4px', border: '1px solid #ddd' }}>
                                    <option>10</option>
                                    <option>25</option>
                                    <option>50</option>
                                </select>
                                <span>records</span>
                            </div>
                            <div style={{ color: '#666' }}>
                                Showing 1 to {filteredUsers.length} of {filteredUsers.length} entries
                            </div>
                            <div style={{ display: 'flex', gap: '5px' }}>
                                <button className="btn btn-secondary" style={{ padding: '6px 12px' }}>Previous</button>
                                <button className="btn btn-secondary" style={{ padding: '6px 12px' }}>Next</button>
                            </div>
                        </div>
                    </div>

                    {showModal && (
                        <UserModal 
                            user={editingUser}
                            userRoles={userRoles}
                            onSave={addUser}
                            onClose={() => {
                                setShowModal(false);
                                setEditingUser(null);
                            }}
                        />
                    )}
                </div>
            );
        }

        // User Modal Component
        function UserModal({ user, userRoles, onSave, onClose }) {
            const [formData, setFormData] = useState(user || {
                fullName: '',
                username: '',
                email: '',
                mobileNumber: '',
                password: '',
                roles: [],
                enabled: true,
                lastActivity: new Date().toLocaleString()
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            const toggleRole = (role) => {
                if (formData.roles.includes(role)) {
                    setFormData({...formData, roles: formData.roles.filter(r => r !== role)});
                } else {
                    setFormData({...formData, roles: [...formData.roles, role]});
                }
            };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h3>{user ? 'Edit User' : 'Add New User'}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Full Name</label>
                                <input 
                                    type="text"
                                    className="form-control"
                                    value={formData.fullName}
                                    onChange={(e) => setFormData({...formData, fullName: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Username</label>
                                    <input 
                                        type="text"
                                        className="form-control"
                                        value={formData.username}
                                        onChange={(e) => setFormData({...formData, username: e.target.value})}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Email</label>
                                    <input 
                                        type="email"
                                        className="form-control"
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        required
                                    />
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Mobile Number</label>
                                    <input 
                                        type="tel"
                                        className="form-control"
                                        value={formData.mobileNumber}
                                        onChange={(e) => setFormData({...formData, mobileNumber: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Password {user && '(leave blank to keep current)'}</label>
                                    <input 
                                        type="password"
                                        className="form-control"
                                        value={formData.password}
                                        onChange={(e) => setFormData({...formData, password: e.target.value})}
                                        required={!user}
                                    />
                                </div>
                            </div>
                            <div className="form-group">
                                <label>User Roles</label>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginTop: '8px' }}>
                                    {userRoles.filter(r => r.active).map(role => (
                                        <label key={role.id} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <input 
                                                type="checkbox"
                                                checked={formData.roles.includes(role.label)}
                                                onChange={() => toggleRole(role.label)}
                                            />
                                            {role.label}
                                        </label>
                                    ))}
                                </div>
                            </div>
                            <div className="form-group">
                                <label style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <input 
                                        type="checkbox"
                                        checked={formData.enabled}
                                        onChange={(e) => setFormData({...formData, enabled: e.target.checked})}
                                    />
                                    Account Enabled
                                </label>
                            </div>
                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save User
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // User Roles Component
        function UserRoles({ userRoles, setUserRoles }) {
            const [showModal, setShowModal] = useState(false);
            const [editingRole, setEditingRole] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');

            const filteredRoles = userRoles.filter(r => 
                r.label.toLowerCase().includes(searchTerm.toLowerCase()) ||
                r.handle.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const addRole = (role) => {
                if (editingRole) {
                    setUserRoles(userRoles.map(r => r.id === editingRole.id ? role : r));
                } else {
                    setUserRoles([...userRoles, { ...role, id: Date.now() }]);
                }
                setShowModal(false);
                setEditingRole(null);
            };

            const deleteRole = (id) => {
                if (confirm('Are you sure you want to delete this role?')) {
                    setUserRoles(userRoles.filter(r => r.id !== id));
                }
            };

            return (
                <div>
                    <div className="header" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <div>
                            <h2>üíº User Roles</h2>
                            <p>Manage user roles and permissions</p>
                        </div>
                        <button 
                            className="btn btn-primary"
                            onClick={() => {
                                setEditingRole(null);
                                setShowModal(true);
                            }}
                        >
                            ‚ûï Add Role
                        </button>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Start typing a name..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button className="btn btn-secondary">üíæ Save this search</button>
                        </div>

                        <table className="table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Label</th>
                                    <th>Handle</th>
                                    <th>Active?</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredRoles.map(role => (
                                    <tr key={role.id}>
                                        <td>{role.id}</td>
                                        <td style={{ color: 'var(--primary-teal)' }}>{role.label}</td>
                                        <td>{role.handle}</td>
                                        <td>
                                            <span className={`badge ${role.active ? 'badge-active' : 'badge-maintenance'}`}>
                                                {role.active ? 'Yes' : 'No'}
                                            </span>
                                        </td>
                                        <td>
                                            <div style={{ display: 'flex', gap: '5px' }}>
                                                <button 
                                                    className="btn btn-primary"
                                                    style={{ padding: '6px 12px', fontSize: '12px' }}
                                                    onClick={() => {
                                                        setEditingRole(role);
                                                        setShowModal(true);
                                                    }}
                                                >
                                                    ‚úèÔ∏è
                                                </button>
                                                <button 
                                                    className="btn btn-danger"
                                                    style={{ padding: '6px 12px', fontSize: '12px' }}
                                                    onClick={() => deleteRole(role.id)}
                                                >
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>

                        <div style={{ marginTop: '15px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                <span>Show</span>
                                <select style={{ padding: '5px', borderRadius: '4px', border: '1px solid #ddd' }}>
                                    <option>10</option>
                                    <option>25</option>
                                    <option>50</option>
                                </select>
                                <span>records</span>
                            </div>
                            <div style={{ color: '#666' }}>
                                Showing 1 to 5 of 5 entries
                            </div>
                            <div style={{ display: 'flex', gap: '5px' }}>
                                <button className="btn btn-secondary" style={{ padding: '6px 12px' }}>Previous</button>
                                <button className="btn btn-secondary" style={{ padding: '6px 12px' }}>Next</button>
                            </div>
                        </div>
                    </div>

                    {showModal && (
                        <RoleModal 
                            role={editingRole}
                            onSave={addRole}
                            onClose={() => {
                                setShowModal(false);
                                setEditingRole(null);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Role Modal Component
        function RoleModal({ role, onSave, onClose }) {
            const [formData, setFormData] = useState(role || {
                label: '',
                handle: '',
                active: true
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h3>{role ? 'Edit Role' : 'Add New Role'}</h3>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Role Label</label>
                                <input 
                                    type="text"
                                    className="form-control"
                                    value={formData.label}
                                    onChange={(e) => setFormData({...formData, label: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Handle (lowercase, no spaces)</label>
                                <input 
                                    type="text"
                                    className="form-control"
                                    value={formData.handle}
                                    onChange={(e) => setFormData({...formData, handle: e.target.value.toLowerCase().replace(/\s+/g, '_')})}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <input 
                                        type="checkbox"
                                        checked={formData.active}
                                        onChange={(e) => setFormData({...formData, active: e.target.checked})}
                                    />
                                    Active
                                </label>
                            </div>
                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save Role
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Access Control Component
        function AccessControl() {
            const [selectedRole, setSelectedRole] = useState('User');
            const [searchTerm, setSearchTerm] = useState('');
            const [permissions, setPermissions] = useState({
                User: {},
                Manager: {},
                Reservations: {},
                'Commission Partner': {},
                Administrator: {}
            });

            // Load permissions from storage
            useEffect(() => {
                const savedPermissions = storage.load('permissions');
                if (savedPermissions) {
                    setPermissions(savedPermissions);
                } else {
                    // Set default permissions
                    const defaultPermissions = {
                        Administrator: generateDefaultPermissions(true),
                        Manager: generateDefaultPermissions(true),
                        Reservations: generateReservationsPermissions(),
                        'Commission Partner': generateCommissionPartnerPermissions(),
                        User: generateDefaultPermissions(false)
                    };
                    setPermissions(defaultPermissions);
                    storage.save('permissions', defaultPermissions);
                }
            }, []);

            // Save permissions when changed
            useEffect(() => {
                storage.save('permissions', permissions);
            }, [permissions]);

            const roles = ['User', 'Manager', 'Reservations', 'Commission Partner', 'Administrator'];

            const permissionSections = [
                {
                    section: 'Car Rental',
                    permissions: [
                        { section: 'Reservations', action: 'Can view all Reservations', key: 'reservations_view_all' },
                        { section: 'Reservations', action: 'Can export Reservations', key: 'reservations_export' },
                        { section: 'Reservations', action: 'Can Download Reservations Agreement', key: 'reservations_download_agreement' },
                        { section: 'Reservations', action: 'Can Download Reservations Return Receipt', key: 'reservations_download_receipt' },
                        { section: 'Reservations', action: 'Can print Reservations Agreement', key: 'reservations_print_agreement' },
                        { section: 'Reservations', action: 'Can email Reservations Agreement', key: 'reservations_email_agreement' },
                        { section: 'Reservations', action: 'Can view Reservation attempts', key: 'reservations_view_attempts' },
                        { section: 'Reservations', action: 'Can view only assigned Reservations (Commission Partner)', key: 'reservations_view_commission' },
                        { section: 'Reservations', action: 'Can view only assigned Reservations (Road Agent)', key: 'reservations_view_road_agent' },
                        { section: 'Reservations', action: 'Can delete Reservations', key: 'reservations_delete' },
                        { section: 'Reservations', action: 'Can create Reservations (Step 1 to 5)', key: 'reservations_create_1_5' },
                        { section: 'Reservations', action: 'Can edit Reservations (Step 1 to 5)', key: 'reservations_edit_1_5' },
                        { section: 'Reservations', action: 'Can edit rates in step 3', key: 'reservations_edit_rates' },
                        { section: 'Reservations', action: 'Can edit the Security Deposit', key: 'reservations_edit_security_deposit' },
                        { section: 'Reservations', action: 'Can edit the Security Deposit Excess', key: 'reservations_edit_security_excess' },
                        { section: 'Reservations', action: 'Can Update Distance Limits in Summary', key: 'reservations_update_distance' },
                        { section: 'Reservations', action: 'Can create/edit Reservations (Step 6 to 9)', key: 'reservations_edit_6_9' },
                        { section: 'Reservations', action: 'Can view Reservations (Step 6 to 9)', key: 'reservations_view_6_9' },
                        { section: 'Reservations', action: 'Can add charges (step 6 and 8)', key: 'reservations_add_charges' },
                        { section: 'Reservations', action: 'Can edit Reservations (Step 10)', key: 'reservations_edit_10' },
                        { section: 'Vehicles', action: 'Can view all Vehicles', key: 'vehicles_view_all' },
                        { section: 'Vehicles', action: 'Can create Vehicles', key: 'vehicles_create' },
                        { section: 'Vehicles', action: 'Can edit Vehicles', key: 'vehicles_edit' },
                        { section: 'Vehicles', action: 'Can delete Vehicles', key: 'vehicles_delete' },
                        { section: 'Customers', action: 'Can view all Customers', key: 'customers_view_all' },
                        { section: 'Customers', action: 'Can create Customers', key: 'customers_create' },
                        { section: 'Customers', action: 'Can edit Customers', key: 'customers_edit' },
                        { section: 'Customers', action: 'Can delete Customers', key: 'customers_delete' },
                        { section: 'Payments', action: 'Can view all Payments', key: 'payments_view_all' },
                        { section: 'Payments', action: 'Can record Payments', key: 'payments_record' },
                        { section: 'Payments', action: 'Can delete Payments', key: 'payments_delete' },
                        { section: 'Reports', action: 'Can view Reports', key: 'reports_view' },
                        { section: 'Reports', action: 'Can export Reports', key: 'reports_export' },
                        { section: 'Maintenance', action: 'Can view Maintenance', key: 'maintenance_view' },
                        { section: 'Maintenance', action: 'Can schedule Maintenance', key: 'maintenance_schedule' },
                        { section: 'Documents', action: 'Can view Documents', key: 'documents_view' },
                        { section: 'Documents', action: 'Can upload Documents', key: 'documents_upload' },
                    ]
                }
            ];

            function generateDefaultPermissions(allowAll) {
                const perms = {};
                permissionSections[0].permissions.forEach(p => {
                    perms[p.key] = allowAll;
                });
                return perms;
            }

            function generateReservationsPermissions() {
                const perms = generateDefaultPermissions(false);
                // Reservations role gets most reservation permissions
                Object.keys(perms).forEach(key => {
                    if (key.startsWith('reservations_')) {
                        perms[key] = true;
                    }
                });
                perms['vehicles_view_all'] = true;
                perms['customers_view_all'] = true;
                perms['customers_create'] = true;
                perms['customers_edit'] = true;
                return perms;
            }

            function generateCommissionPartnerPermissions() {
                const perms = generateDefaultPermissions(false);
                perms['reservations_view_commission'] = true;
                perms['reservations_view_6_9'] = true;
                perms['customers_view_all'] = true;
                return perms;
            }

            const filteredPermissions = permissionSections[0].permissions.filter(p =>
                p.action.toLowerCase().includes(searchTerm.toLowerCase()) ||
                p.section.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const togglePermission = (key) => {
                setPermissions(prev => ({
                    ...prev,
                    [selectedRole]: {
                        ...prev[selectedRole],
                        [key]: !prev[selectedRole]?.[key]
                    }
                }));
            };

            const setAllPermissions = (value) => {
                const newPerms = {};
                permissionSections[0].permissions.forEach(p => {
                    newPerms[p.key] = value;
                });
                setPermissions(prev => ({
                    ...prev,
                    [selectedRole]: newPerms
                }));
            };

            return (
                <div>
                    <div className="header">
                        <h2>üîí Access Control</h2>
                        <p>Manage permissions for each user role</p>
                    </div>

                    {/* Role Tabs */}
                    <div style={{
                        backgroundColor: 'white',
                        padding: '15px 20px',
                        borderRadius: '12px',
                        marginBottom: '20px',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                        display: 'flex',
                        gap: '10px',
                        flexWrap: 'wrap'
                    }}>
                        {roles.map(role => (
                            <button
                                key={role}
                                onClick={() => setSelectedRole(role)}
                                style={{
                                    padding: '10px 20px',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer',
                                    backgroundColor: selectedRole === role ? 'var(--primary-teal)' : '#f0f0f0',
                                    color: selectedRole === role ? 'white' : 'var(--text-dark)',
                                    fontSize: '14px',
                                    fontWeight: selectedRole === role ? '600' : 'normal',
                                    transition: 'all 0.3s'
                                }}
                            >
                                {role}
                            </button>
                        ))}
                    </div>

                    <div className="card">
                        <div style={{ 
                            display: 'flex', 
                            justifyContent: 'space-between', 
                            alignItems: 'center',
                            marginBottom: '20px',
                            paddingBottom: '15px',
                            borderBottom: '2px solid #f0f0f0'
                        }}>
                            <input 
                                type="text"
                                className="search-box"
                                placeholder="Search..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                style={{ maxWidth: '300px' }}
                            />
                            <div style={{ display: 'flex', gap: '10px' }}>
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => setAllPermissions(false)}
                                    style={{ padding: '10px 20px' }}
                                >
                                    Not Set All
                                </button>
                                <button 
                                    className="btn btn-primary"
                                    onClick={() => setAllPermissions(true)}
                                    style={{ padding: '10px 20px', backgroundColor: 'var(--success)' }}
                                >
                                    Allow All
                                </button>
                                <button 
                                    className="btn btn-danger"
                                    onClick={() => setAllPermissions(false)}
                                    style={{ padding: '10px 20px' }}
                                >
                                    Deny All
                                </button>
                                <button 
                                    className="btn btn-primary"
                                    style={{ padding: '10px 20px' }}
                                >
                                    üë§
                                </button>
                            </div>
                        </div>

                        <div style={{
                            backgroundColor: '#f9f9f9',
                            padding: '15px 20px',
                            borderRadius: '8px',
                            marginBottom: '20px',
                            fontWeight: '600',
                            color: 'var(--text-dark)'
                        }}>
                            Car Rental
                        </div>

                        <table className="table">
                            <thead>
                                <tr>
                                    <th>Section</th>
                                    <th>Action</th>
                                    <th style={{ textAlign: 'center' }}>
                                        <div style={{ display: 'flex', justifyContent: 'center', gap: '80px' }}>
                                            <span style={{ color: '#999', fontSize: '12px' }}>Not Set</span>
                                            <span style={{ color: 'var(--success)', fontSize: '12px' }}>Allow</span>
                                            <span style={{ color: 'var(--danger)', fontSize: '12px' }}>Deny</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredPermissions.map((perm, idx) => {
                                    const isAllowed = permissions[selectedRole]?.[perm.key];
                                    const isSet = permissions[selectedRole]?.hasOwnProperty(perm.key);
                                    
                                    return (
                                        <tr key={idx}>
                                            <td>{perm.section}</td>
                                            <td>{perm.action}</td>
                                            <td>
                                                <div style={{ 
                                                    display: 'flex', 
                                                    justifyContent: 'center', 
                                                    gap: '10px',
                                                    alignItems: 'center'
                                                }}>
                                                    <button
                                                        onClick={() => {
                                                            setPermissions(prev => {
                                                                const newPerms = {...prev};
                                                                delete newPerms[selectedRole][perm.key];
                                                                return newPerms;
                                                            });
                                                        }}
                                                        style={{
                                                            padding: '6px 20px',
                                                            border: 'none',
                                                            borderRadius: '4px',
                                                            cursor: 'pointer',
                                                            backgroundColor: !isSet ? '#6c757d' : '#e0e0e0',
                                                            color: !isSet ? 'white' : '#999',
                                                            fontSize: '12px',
                                                            fontWeight: !isSet ? '600' : 'normal'
                                                        }}
                                                    >
                                                        Not Set
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            setPermissions(prev => ({
                                                                ...prev,
                                                                [selectedRole]: {
                                                                    ...prev[selectedRole],
                                                                    [perm.key]: true
                                                                }
                                                            }));
                                                        }}
                                                        style={{
                                                            padding: '6px 20px',
                                                            border: 'none',
                                                            borderRadius: '4px',
                                                            cursor: 'pointer',
                                                            backgroundColor: isSet && isAllowed ? 'var(--success)' : '#e0e0e0',
                                                            color: isSet && isAllowed ? 'white' : '#999',
                                                            fontSize: '12px',
                                                            fontWeight: isSet && isAllowed ? '600' : 'normal'
                                                        }}
                                                    >
                                                        Allow
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            setPermissions(prev => ({
                                                                ...prev,
                                                                [selectedRole]: {
                                                                    ...prev[selectedRole],
                                                                    [perm.key]: false
                                                                }
                                                            }));
                                                        }}
                                                        style={{
                                                            padding: '6px 20px',
                                                            border: 'none',
                                                            borderRadius: '4px',
                                                            cursor: 'pointer',
                                                            backgroundColor: isSet && !isAllowed ? 'var(--danger)' : '#e0e0e0',
                                                            color: isSet && !isAllowed ? 'white' : '#999',
                                                            fontSize: '12px',
                                                            fontWeight: isSet && !isAllowed ? '600' : 'normal'
                                                        }}
                                                    >
                                                        Deny
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // Settings Component
        function Settings({ settings, setSettings }) {
            const [activeTab, setActiveTab] = useState('general');
            const [formData, setFormData] = useState(settings);
            const [logoFile, setLogoFile] = useState(null);
            const [loginImageFile, setLoginImageFile] = useState(null);

            const tabs = [
                { id: 'general', label: 'General Settings', icon: '‚öôÔ∏è' },
                { id: 'email', label: 'Email Settings', icon: 'üìß' },
                { id: 'integrations', label: 'Integrations', icon: 'üîó' },
                { id: 'advanced', label: 'Advanced', icon: 'üîß' },
                { id: 'security', label: 'Security', icon: 'üîí' }
            ];

            const handleSave = () => {
                setSettings(formData);
                alert('Settings saved successfully!');
            };

            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setFormData({...formData, logo: reader.result});
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleLoginImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setFormData({...formData, loginImage: reader.result});
                    };
                    reader.readAsDataURL(file);
                }
            };

            const removeLanguage = (lang) => {
                setFormData({
                    ...formData,
                    supportedLanguages: formData.supportedLanguages.filter(l => l !== lang)
                });
            };

            return (
                <div>
                    <div className="header">
                        <h2>‚öôÔ∏è Settings</h2>
                        <p>Configure your Ketu Kakahala rental system</p>
                    </div>

                    {/* Settings Tabs */}
                    <div style={{
                        backgroundColor: 'white',
                        padding: '0',
                        borderRadius: '12px 12px 0 0',
                        marginBottom: '0',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                        display: 'flex',
                        borderBottom: '2px solid #f0f0f0'
                    }}>
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                style={{
                                    padding: '15px 25px',
                                    border: 'none',
                                    background: 'none',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: activeTab === tab.id ? '600' : 'normal',
                                    color: activeTab === tab.id ? 'var(--primary-teal)' : 'var(--text-dark)',
                                    borderBottom: activeTab === tab.id ? '3px solid var(--primary-teal)' : '3px solid transparent',
                                    transition: 'all 0.3s',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}
                            >
                                <span>{tab.icon}</span>
                                {tab.label}
                            </button>
                        ))}
                    </div>

                    <div className="card" style={{ borderRadius: '0 0 12px 12px', marginTop: '0' }}>
                        {activeTab === 'general' && (
                            <div>
                                <h3 className="card-title">General Settings</h3>
                                
                                <div className="form-row">
                                    <div className="form-group">
                                        <label>Company Name</label>
                                        <input 
                                            type="text"
                                            className="form-control"
                                            value={formData.companyName || ''}
                                            onChange={(e) => setFormData({...formData, companyName: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Country</label>
                                        <select 
                                            className="form-control"
                                            value={formData.country || 'Namibia'}
                                            onChange={(e) => setFormData({...formData, country: e.target.value})}
                                        >
                                            <option value="Namibia">Namibia</option>
                                            <option value="South Africa">South Africa</option>
                                            <option value="Botswana">Botswana</option>
                                            <option value="Zimbabwe">Zimbabwe</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="form-row">
                                    <div className="form-group">
                                        <label>SMS Sender</label>
                                        <input 
                                            type="text"
                                            className="form-control"
                                            value={formData.smsSender || 'ketu-kakahala-trading-enterprises'}
                                            onChange={(e) => setFormData({...formData, smsSender: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Timezone</label>
                                        <select 
                                            className="form-control"
                                            value={formData.timezone || 'Africa/Windhoek (CAT +02:00)'}
                                            onChange={(e) => setFormData({...formData, timezone: e.target.value})}
                                        >
                                            <option value="Africa/Windhoek (CAT +02:00)">Africa/Windhoek (CAT +02:00)</option>
                                            <option value="Africa/Johannesburg (SAST +02:00)">Africa/Johannesburg (SAST +02:00)</option>
                                            <option value="Africa/Harare (CAT +02:00)">Africa/Harare (CAT +02:00)</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="form-row">
                                    <div className="form-group">
                                        <label>Preferred Language Format</label>
                                        <select 
                                            className="form-control"
                                            value={formData.language || 'English'}
                                            onChange={(e) => setFormData({...formData, language: e.target.value})}
                                        >
                                            <option value="English">English</option>
                                            <option value="Afrikaans">Afrikaans</option>
                                            <option value="German">German</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>Supported Languages ‚ÑπÔ∏è</label>
                                        <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap', marginTop: '8px' }}>
                                            {(formData.supportedLanguages || ['English', 'Spanish', 'Portuguese']).map(lang => (
                                                <span 
                                                    key={lang}
                                                    style={{
                                                        display: 'inline-flex',
                                                        alignItems: 'center',
                                                        gap: '8px',
                                                        padding: '6px 12px',
                                                        backgroundColor: '#f0f0f0',
                                                        borderRadius: '6px',
                                                        fontSize: '14px'
                                                    }}
                                                >
                                                    {lang}
                                                    <button
                                                        onClick={() => removeLanguage(lang)}
                                                        style={{
                                                            background: 'none',
                                                            border: 'none',
                                                            cursor: 'pointer',
                                                            fontSize: '16px',
                                                            color: '#999'
                                                        }}
                                                    >
                                                        √ó
                                                    </button>
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="form-row">
                                    <div className="form-group">
                                        <label>Preferred Date Format</label>
                                        <select 
                                            className="form-control"
                                            value={formData.dateFormat || '16-12-2025 11:49 (eu)'}
                                            onChange={(e) => setFormData({...formData, dateFormat: e.target.value})}
                                        >
                                            <option value="16-12-2025 11:49 (eu)">16-12-2025 11:49 (eu)</option>
                                            <option value="12/16/2025 11:49 AM (us)">12/16/2025 11:49 AM (us)</option>
                                            <option value="2025-12-16 11:49 (iso)">2025-12-16 11:49 (iso)</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>Metric System</label>
                                        <select 
                                            className="form-control"
                                            value={formData.metricSystem || 'Metric (2.408,12)'}
                                            onChange={(e) => setFormData({...formData, metricSystem: e.target.value})}
                                        >
                                            <option value="Metric (2.408,12)">Metric (2.408,12)</option>
                                            <option value="Imperial (2,408.12)">Imperial (2,408.12)</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="form-row">
                                    <div className="form-group">
                                        <label>Tenant Logo</label>
                                        <div style={{ display: 'flex', gap: '10px', alignItems: 'center', marginTop: '10px' }}>
                                            {formData.logo && (
                                                <img src={formData.logo} alt="Logo" style={{ width: '100px', height: '60px', objectFit: 'contain', border: '1px solid #ddd', borderRadius: '8px', padding: '5px' }} />
                                            )}
                                            {!formData.logo && (
                                                <div style={{ width: '100px', height: '60px', backgroundColor: 'var(--primary-teal)', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '24px' }}>
                                                    üå¥
                                                </div>
                                            )}
                                            <input 
                                                type="file"
                                                accept="image/*"
                                                onChange={handleLogoUpload}
                                                style={{ display: 'none' }}
                                                id="logo-upload"
                                            />
                                            <label htmlFor="logo-upload" className="btn btn-secondary" style={{ cursor: 'pointer', marginBottom: '0' }}>
                                                ‚ûï Add Image
                                            </label>
                                            <button className="btn btn-primary">üì∑</button>
                                            <button className="btn btn-secondary">‚¨áÔ∏è</button>
                                        </div>
                                    </div>
                                    <div className="form-group">
                                        <label>Login Image</label>
                                        <div style={{ display: 'flex', gap: '10px', alignItems: 'center', marginTop: '10px' }}>
                                            <input 
                                                type="file"
                                                accept="image/*"
                                                onChange={handleLoginImageUpload}
                                                style={{ display: 'none' }}
                                                id="login-image-upload"
                                            />
                                            <label htmlFor="login-image-upload" className="btn btn-secondary" style={{ cursor: 'pointer', marginBottom: '0' }}>
                                                ‚ûï Add Image
                                            </label>
                                            <button className="btn btn-primary">üì∑</button>
                                            <button className="btn btn-secondary">‚¨áÔ∏è</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'email' && (
                            <div>
                                <h3 className="card-title">Email Settings</h3>
                                <div className="form-group">
                                    <label>SMTP Server</label>
                                    <input 
                                        type="text"
                                        className="form-control"
                                        placeholder="smtp.gmail.com"
                                        value={formData.smtpServer || ''}
                                        onChange={(e) => setFormData({...formData, smtpServer: e.target.value})}
                                    />
                                </div>
                                <div className="form-row">
                                    <div className="form-group">
                                        <label>SMTP Port</label>
                                        <input 
                                            type="number"
                                            className="form-control"
                                            placeholder="587"
                                            value={formData.smtpPort || ''}
                                            onChange={(e) => setFormData({...formData, smtpPort: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>Email From</label>
                                        <input 
                                            type="email"
                                            className="form-control"
                                            placeholder="rentals@ketukakahala.com"
                                            value={formData.emailFrom || ''}
                                            onChange={(e) => setFormData({...formData, emailFrom: e.target.value})}
                                        />
                                    </div>
                                </div>
                                <div className="form-row">
                                    <div className="form-group">
                                        <label>SMTP Username</label>
                                        <input 
                                            type="text"
                                            className="form-control"
                                            value={formData.smtpUsername || ''}
                                            onChange={(e) => setFormData({...formData, smtpUsername: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>SMTP Password</label>
                                        <input 
                                            type="password"
                                            className="form-control"
                                            value={formData.smtpPassword || ''}
                                            onChange={(e) => setFormData({...formData, smtpPassword: e.target.value})}
                                        />
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'integrations' && (
                            <div>
                                <h3 className="card-title">Integrations</h3>
                                <div className="empty-state">
                                    <div className="empty-state-icon">üîó</div>
                                    <p>No integrations configured</p>
                                    <button className="btn btn-primary" style={{ marginTop: '15px' }}>
                                        ‚ûï Add Integration
                                    </button>
                                </div>
                            </div>
                        )}

                        {activeTab === 'advanced' && (
                            <div>
                                <h3 className="card-title">Advanced Settings</h3>
                                <div className="form-group">
                                    <label>
                                        <input 
                                            type="checkbox"
                                            checked={formData.enableDebugMode || false}
                                            onChange={(e) => setFormData({...formData, enableDebugMode: e.target.checked})}
                                            style={{ marginRight: '10px' }}
                                        />
                                        Enable Debug Mode
                                    </label>
                                </div>
                                <div className="form-group">
                                    <label>
                                        <input 
                                            type="checkbox"
                                            checked={formData.enableApiAccess || false}
                                            onChange={(e) => setFormData({...formData, enableApiAccess: e.target.checked})}
                                            style={{ marginRight: '10px' }}
                                        />
                                        Enable API Access
                                    </label>
                                </div>
                                <div className="form-group">
                                    <label>API Key</label>
                                    <input 
                                        type="text"
                                        className="form-control"
                                        value={formData.apiKey || 'kk-' + Math.random().toString(36).substr(2, 9)}
                                        readOnly
                                    />
                                </div>
                            </div>
                        )}

                        {activeTab === 'security' && (
                            <div>
                                <h3 className="card-title">Security Settings</h3>
                                <div className="form-group">
                                    <label>
                                        <input 
                                            type="checkbox"
                                            checked={formData.requireTwoFactor || false}
                                            onChange={(e) => setFormData({...formData, requireTwoFactor: e.target.checked})}
                                            style={{ marginRight: '10px' }}
                                        />
                                        Require Two-Factor Authentication
                                    </label>
                                </div>
                                <div className="form-group">
                                    <label>
                                        <input 
                                            type="checkbox"
                                            checked={formData.enforceStrongPasswords || true}
                                            onChange={(e) => setFormData({...formData, enforceStrongPasswords: e.target.checked})}
                                            style={{ marginRight: '10px' }}
                                        />
                                        Enforce Strong Passwords
                                    </label>
                                </div>
                                <div className="form-group">
                                    <label>Session Timeout (minutes)</label>
                                    <input 
                                        type="number"
                                        className="form-control"
                                        value={formData.sessionTimeout || 30}
                                        onChange={(e) => setFormData({...formData, sessionTimeout: e.target.value})}
                                    />
                                </div>
                            </div>
                        )}

                        <div style={{ marginTop: '30px', paddingTop: '20px', borderTop: '1px solid #e0e0e0' }}>
                            <div style={{ display: 'flex', gap: '10px' }}>
                                <button className="btn btn-primary" onClick={handleSave}>
                                    üíæ Save
                                </button>
                                <button className="btn btn-secondary" onClick={() => setFormData(settings)}>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        try {
            console.log('Starting Ketu Kakahala Rental System...');
            ReactDOM.render(<App />, document.getElementById('root'));
            console.log('Application loaded successfully!');
        } catch (error) {
            console.error('Error loading application:', error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 40px; text-align: center; font-family: Arial;">
                    <h2 style="color: #e74c3c;">Error Loading Application</h2>
                    <p style="color: #666; margin: 20px 0;">${error.message}</p>
                    <p style="color: #999; font-size: 12px;">Please check the browser console for more details (F12)</p>
                </div>
            `;
        }
    </script>
</body>
</html>
